let cachedImages={petals:{live:{},indexed:{}},enemies:{},statBoxes:{petals:{},enemies:{}},statics:{reloadIcon:null,noStack:null,xp:null}},mouseMovement=localStorage.getItem("mouseMovement");null==mouseMovement?(mouseMovement=!0,localStorage.setItem("mouseMovement",!0)):mouseMovement="true"==mouseMovement;let damageFlash=localStorage.getItem("damageFlash");null==damageFlash?(damageFlash=!1,localStorage.setItem("damageFlash",!1)):damageFlash="true"==damageFlash;let noGrid=localStorage.getItem("noGrid");null==noGrid?(noGrid=!1,localStorage.setItem("noGrid",!1)):noGrid="true"==noGrid,window.noGrid=noGrid;let renderSquadPetals=localStorage.getItem("renderSquadPetals");null==renderSquadPetals?(renderSquadPetals=!0,localStorage.setItem("renderSquadPetals",!0)):renderSquadPetals="true"==renderSquadPetals,window.renderSquadPetals=renderSquadPetals,"undefined"!=typeof normalEnemyRenderMap&&(enemyRenderMap=normalEnemyRenderMap);let statBoxes=localStorage.getItem("statboxes");null===statBoxes?(statBoxes=!0,localStorage.setItem("statboxes",!0)):statBoxes="true"==statBoxes,window.statBoxes=statBoxes;let damageCounter=localStorage.getItem("damageCounter");null===damageCounter?(damageCounter=!1,localStorage.setItem("damageCounter",!1)):damageCounter="true"==damageCounter,window.damageCounter=damageCounter;let petalRain=localStorage.getItem("petalRain");null==petalRain?(petalRain=!1,localStorage.setItem("petalRain",!1)):petalRain="true"==petalRain,window.petalRain=petalRain;let usernames=!0;window.usernames=usernames,window.showCommunityBiomes=!1;let announcements=localStorage.getItem("announcements");null==announcements?(announcements=!0,localStorage.setItem("announcements",!0)):announcements="true"==announcements,window.announcements=announcements;let highQualityPetalContainers=localStorage.getItem("hqp");null===highQualityPetalContainers?(highQualityPetalContainers=!0,localStorage.setItem("hqp",!0)):highQualityPetalContainers="true"==highQualityPetalContainers,window.hqp=highQualityPetalContainers;let toRenderDebug=localStorage.getItem("toRenderDebug");null===toRenderDebug?(toRenderDebug=!1,localStorage.setItem("toRenderDebug",!1)):toRenderDebug="true"==toRenderDebug,window.toRenderDebug=toRenderDebug;let showWeatherEffects=localStorage.getItem("showWeatherEffects");null===showWeatherEffects?(showWeatherEffects=!0,localStorage.setItem("showWeatherEffects",!0)):showWeatherEffects="true"==showWeatherEffects,window.showWeatherEffects=showWeatherEffects;let noTrans=localStorage.getItem("noTrans");function changeToggleElVal(el,restore=!1){const trueIf=el.getAttribute("ev-enabled-if");if(trueIf){try{eval(trueIf)?(el.innerHTML=el.getAttribute("ev-enabled-val"),el.classList.contains("enabled")||el.classList.add("enabled")):(el.innerHTML=el.getAttribute("ev-disabled-val"),el.classList.contains("enabled")&&el.classList.remove("enabled"))}catch(e){}return}const toggled=el.getAttribute("ev-enabled-option");if(null!=toggled){let i=parseInt(eval(toggled)),ni=restore?i:i+1,oc=el.getAttribute(`ev-option-${i}-class`),nextAtt=el.getAttribute(`ev-option-${ni}-val`);nextAtt||(ni=0,nextAtt=el.getAttribute(`ev-option-${ni}-val`));let nc=el.getAttribute(`ev-option-${ni}-class`);return el.innerHTML=nextAtt,el.classList.contains(oc)&&el.classList.remove(oc),el.classList.contains(nc)||el.classList.add(nc),ni}}function closeSquadUI(){window.squadUICloseTime=performance.now(),changeReady(!1),document.querySelector(".play-text").setAttribute("stroke","Play"),document.querySelector(".play-btn").style.backgroundColor="#1dd129",delete window.squadTimer,send({leaveRoom:!0})}function sendRoomRequest(e){void 0!==e&&send(e),send({name:document.querySelector(".nickname").value}),send({updatePetals:menuInventory.pack()}),void 0!==window.characterSelector&&0!==window.characterSelector.selectedIndex&&window.characterSelector.send(),window.lastRoomSentTime=performance.now(),changeReady(!1),squadUI.removeAllClients(),menuInventory.sendQueuedChangedPetalsImmediately(),squadUI.sendSavedStartingWave()}null===noTrans?(noTrans=!1,localStorage.setItem("noTrans",!1)):noTrans="true"==noTrans,window.noTrans=noTrans,document.querySelectorAll(".toggleEl").forEach(e=>{changeToggleElVal(e,!0)}),window.lastRoomSentTime=0,window.onmousedown=e=>{if(window.mobile&&!e.mobile)return;if(mouse.clickPosition="down",mouse.lastDownData={time:performance.now(),x:e.pageX,y:e.pageY},"undefined"==typeof squadUI)return;!0===squadUI.hoveringOverX&&0===e.button&&closeSquadUI();const n=mouse.x*canvas.w/window.innerWidth,t=mouse.y*canvas.h/window.innerHeight,a=t;if("menu"===window.state&&0===e.button&&squadUI.intersectingSliderBound({x:n,y:t})&&squadUI.startSliderDrag(n),!0===window.connected){if(performance.now()-window.lastRoomSentTime>300){const t=squadUI.getButtonAtPosition(n,a);if(0===e.button&&t){if("public"===t)sendRoomRequest({findPublic:!0,biome:biomeManager.getCurrentBiomeData().current});else if("new"===t)sendRoomRequest({newSquad:!0,biome:biomeManager.getCurrentBiomeData().current});else if("private"===t){const e=prompt("Enter Private Squad Code");null!==e&&sendRoomRequest({private:e,biome:biomeManager.getCurrentBiomeData().current})}}else!0===squadUI.hoveringOverJoinMainPvp&&0===e.button&&(sendRoomRequest({newSquad:!0,biome:biomeManager.getCurrentBiomeData().current}),send({joinMainPvp:!0}),window.inMainPvpRoom=!0)}let o=!1;if(!0===globalInventory.menuActive){const e=130+globalInventory.w-7.5-30,t=canvas.h-globalInventory.h-20+7.5;n>e-3&&n<e+30+3&&a>t-3&&a<t+30+3&&(o=!0)}if(!o&&!0===specialGlobalInventory.menuActive){const e=130+specialGlobalInventory.w-7.5-30,t=canvas.h-specialGlobalInventory.h-20+7.5;n>e-3&&n<e+30+3&&a>t-3&&a<t+30+3&&(o=!0)}if(!o&&!0===craftingMenu.menuActive){const e=130+craftingMenu.w-7.5-30,t=canvas.h-craftingMenu.h-20+7.5;n>e-3&&n<e+30+3&&a>t-3&&a<t+30+3&&(o=!0)}if(!o&&!0===mobGallery.menuActive){const e=130+mobGallery.w-7.5-30,t=canvas.h-mobGallery.h-20+7.5;n>e-3&&n<e+30+3&&a>t-3&&a<t+30+3&&(o=!0)}o&&(!0===globalInventory.menuActive?globalInventory.toggleMenu():!0===specialGlobalInventory.menuActive?specialGlobalInventory.toggleMenu():!0===craftingMenu.menuActive?craftingMenu.toggleMenu():!0===mobGallery.menuActive&&mobGallery.toggleMenu());const s=20,l=80,i=e=>a>=e&&a<=e+l;0===e.button&&n>=s&&n<=s+l&&(i(canvas.h-100)?mobGallery.toggleMenu():i(canvas.h-200)?craftingMenu.toggleMenu():i(canvas.h-300)?globalInventory.toggleMenu():i(canvas.h-400)&&specialGlobalInventory.toggleMenu()),settingsMenu.mouseDown({mouseX:n,mouseY:t,x:n,y:t});let r=!1;const u=(e,a=!1)=>{if(!e||!e.menuActive)return!1;let o,s,l,i;return a&&e.dimensions?(o=e.dimensions.x,s=e.dimensions.y,l=e.dimensions.w,i=e.dimensions.h):void 0!==e.x&&void 0!==e.y?(o=e.x,s=e.y,l=e.w,i=e.h):(o=130,s=canvas.h-e.h-20,l=e.w,i=e.h),n>o&&n<o+l&&t>s&&t<s+i};(u(globalInventory)||u(specialGlobalInventory)||u(craftingMenu)||u(mobGallery,!0))&&(r=!0),r||menuInventory.mouseDown({mouseX:n,mouseY:t,menuInventory},menuInventory),mobGallery.mouseDown({x:mouse.canvasX,y:mouse.canvasY}),!0===specialGlobalInventory.menuActive?specialGlobalInventory.mouseDown():!0===globalInventory.menuActive&&null===draggingPetalContainer?globalInventory.mouseDown({mouseX:n,mouseY:t},menuInventory):!0===craftingMenu.menuActive&&craftingMenu.mouseDown({mouseX:n,mouseY:t},e)}if("menu"===window.state){biomeManager.mouseDown({mouseX:n,mouseY:t},e);for(let e=0;e<menuEnemies.length;e++){const a=menuEnemies[e];Math.sqrt((n-a.render.x)**2+(t-a.render.y)**2)<a.radius&&!0!==a.dead&&(a.hp<=0?a.dead=!0:(a.hp-=1+Math.min(10,maxRarityObtained),a.updateRenderDamage()))}if(streakMenu.mouseDown({mouseX:n,mouseY:t}),void 0!==window.characterSelector&&window.characterSelector.onmousedown(n,t),(n-window.clickLoc.x)**2+(t-window.clickLoc.y)**2<225){window.clicks++;let e=window.clicks;window.clicks>1e3?e="But Rita left Theta...":window.clicks>400&&Math.random()<.1?e="Thoita!":window.clicks>300&&Math.random()<.1?e="So dev name is Thita!":window.clicks>200&&Math.random()<.1?e="Theta!":window.clicks>100&&Math.random()<.1?e="Rita!":window.clicks>50&&Math.random()<.1&&(e="Lemme tell you why this game called Thoita?"),window.activeClicks.push({t:0,n:e,x:0,xv:.2*(Math.random()-.5),y:0,yv:-.1-.2*Math.random()})}}void 0!==room&&null!==selfId&&!0===window.isDead?!0===deadMenu.hoveringOverButton?(deadMenu.rematchRequested=!1,!0===deadMenu.acceptedDeath||!0===window.is3D?send({leaveGame:!0,real:!0}):deadMenu.acceptedDeath=!0):!0===deadMenu.hoveringOverRematchButton&&(deadMenu.rematchRequested=!0,send({rematchRequested:!0})):void 0!==room&&null!==selfId&&!0!==window.isDead&&(window.mobile?mobileControls.handleMousePress(e):(0==e.button?send(["a",!0]):2==e.button?send(["d",!0]):1==e.button&&send(["middle",!0]),"game"===window.state&&inputHandler.updateChat()))},window.onmouseout=e=>{"menu"===window.state&&inputHandler.handleMouse({...e,button:0,x:-1e99,y:-1e99,pageX:-1e99,pageY:-1e99})};let fov=1,renderFov=fov;document.addEventListener("wheel",e=>{if("game"===window.state){fov/=1/(1-e.deltaY/700);const n=window.currentWeather?.visionRange&&window.currentWeather.visionRange<1?.2/window.currentWeather.visionRange:.2;fov<n&&(fov=n),fov>3&&(fov=3)}const n=mouse.x*canvas.w/window.innerWidth,t=mouse.y*canvas.h/window.innerHeight;globalInventory.updateScroll({x:e.deltaX,y:e.deltaY},{mouseX:n,mouseY:t}),"undefined"!=typeof craftingMenu&&craftingMenu.updateScroll({x:e.deltaX,y:e.deltaY},{mouseX:n,mouseY:t}),mobGallery.updateScroll({x:e.deltaX,y:e.deltaY},{mouseX:n,mouseY:t})}),window.onmouseup=e=>{if(window.mobile&&!e.mobile)return;mouse.clickPosition="up","undefined"!=typeof room&&null!==selfId&&!0!==window.isDead&&(window.mobile?mobileControls.releaseControls(e):0==e.button?send(["a",!1]):2==e.button?send(["d",!1]):1==e.button&&send(["middle",!1]));const n=mouse.x*canvas.w/window.innerWidth,t=mouse.y*canvas.h/window.innerHeight;"menu"===window.state&&!0===squadUI.hoveringOverSlider&&0===e.button&&squadUI.endSliderDrag(n),!0===window.connected&&(globalInventory.mouseUp({mouseX:n,mouseY:t},menuInventory),mobGallery.mouseUp({mouseX:n,mouseY:t}),!0===craftingMenu.menuActive&&craftingMenu.mouseUp({mouseX:n,mouseY:t}),specialGlobalInventory.mouseUp()),"game"===window.state&&inputHandler.updateChat()},document.onvisibilitychange=()=>{"undefined"!=typeof room&&null!==selfId&&!0!==window.isDead&&(!0===room.flowers[selfId].attacking&&send(["a",!1]),!0===room.flowers[selfId].defending&&send(["d",!1]))};const nickname=localStorage.getItem("nickname");"string"==typeof nickname&&(document.querySelector(".nickname").value=nickname),document.querySelector(".nickname").oninput=()=>{send({name:document.querySelector(".nickname").value}),localStorage.setItem("nickname",document.querySelector(".nickname").value)};let petalSearch=document.getElementById("petalsearch");function changeReady(e,n=!0){n&&(!0===e&&1===squadUI.clients.filter(e=>!1===e.ready).length&&send({changePetals:!0,...menuInventory.pack()}),send({ready:e,updateSpeedCircle:menuInventory.speedCircle.reload})),window.ready=e,document.querySelector(".play-btn").style.backgroundColor=window.ready?"#1dd129":"#d11d1d"}petalSearch.addEventListener("input",()=>{globalInventory.currentSearchTerm=petalSearch.value}),petalSearch.addEventListener("blur",()=>{globalInventory.textBoxActive=!1}),window.ready=!1,document.getElementById("settingsButton").onclick=()=>{settingsMenu.toggle()};const fullscreenButton=document.getElementById("fullscreenButton");fullscreenButton&&(fullscreenButton.onclick=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(()=>{})},document.addEventListener("fullscreenchange",()=>{document.fullscreenElement,fullscreenButton.querySelector("span").textContent="â›¶"})),window.multiPetals={Light:!0,Pollen:!0,Dandelion:!0};const multiPetals=window.multiPetals;function levelPerXp(e){return 11.18213*Math.log(.000480827337943866*(2080+e))}function xpPerLevel(e){return Math.exp(e/11.18213)/.000480827337943866-2080}window.basePetalSlots=5,window.petalSlotThresholds=[15,30,45,60,75,1e3];const basePetalSlots=window.basePetalSlots,petalSlotThresholds=window.petalSlotThresholds;function setCursor(e){null!==window.cursorResetTimeout&&clearTimeout(window.cursorResetTimeout),"auto"!==e&&(window.cursorResetTimeout=setTimeout(()=>{document.body.style.cursor="auto"},50)),document.body.style.cursor=e}window.cursorResetTimeout=null;var mobileDiv=document.querySelector(".mobile"),chatDiv=document.querySelector(".chatContainer"),chatMsgContainer=document.querySelector(".chat-div"),chatInput=document.querySelector(".chat");let mobileAttackingState=!1,mobileDefendingState=!1;function appendChatMessage(e,n="#ffffff",t){const a=document.createElement("div");a.innerText=e,a.className="chat-message","admin"==n?"ruby"==t?a.classList.add("animated-text-ruby"):"devdevd"==t?a.classList.add("animated-text-peterpeterp"):a.classList.add("animated-text"):a.style.color=n,chatMsgContainer.prepend(a),setTimeout(()=>{a.animate([{opacity:1},{transform:"rotateZ(2deg)","font-size":"0rem",opacity:0}],{duration:1e3,iterations:1}),setTimeout(()=>{a.remove()},950)},3e4)}function appendChatAnnouncement(e,n){const t=document.createElement("div");t.innerText=e,t.className="chat-announcement",t.style.color=n,chatMsgContainer.prepend(t),setTimeout(()=>{t.animate([{opacity:1},{transform:"rotateZ(2deg)","font-size":"0rem",opacity:0}],{duration:1e3,iterations:1}),setTimeout(()=>{t.remove()},950)},3e4)}window.mobile=!1,(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))&&(window.mobile=!0),document.addEventListener("touchmove",e=>{const n=e.changedTouches[0],t=e.target;if("BUTTON"===t.tagName||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.classList.contains("play-btn")||t.classList.contains("play-text")||t.classList.contains("btn")||t.closest(".play-btn")||t.closest("button")||t.closest(".btn")||t.closest("#settingsButton")||t.closest("#fullscreenButton"))return;const a=n.pageX*canvas.w/window.innerWidth,o=n.pageY*canvas.h/window.innerHeight;mouse.x=n.pageX,mouse.y=n.pageY,mouse.canvasX=a,mouse.canvasY=o,globalInventory.menuActive&&a>165&&a<130+globalInventory.w-50&&o>canvas.h-globalInventory.h-20+45&&o<canvas.h-globalInventory.h-20+80||e.preventDefault(),inputHandler.handleMouse({x:n.pageX,y:n.pageY,pageX:n.pageX,pageY:n.pageY,button:0}),"menu"===window.state&&"undefined"!=typeof squadUI&&!0===squadUI.draggingSlider&&squadUI.updateSliderDrag(mouse.canvasX)},{passive:!1}),document.addEventListener("touchstart",e=>{const n=e.changedTouches[0],t=e.target;if("BUTTON"===t.tagName||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.classList.contains("play-btn")||t.classList.contains("play-text")||t.classList.contains("btn")||t.closest(".play-btn")||t.closest("button")||t.closest(".btn")||t.closest("#settingsButton")||t.closest("#fullscreenButton"))return;const a=n.pageX*canvas.w/window.innerWidth,o=n.pageY*canvas.h/window.innerHeight;mouse.x=n.pageX,mouse.y=n.pageY,mouse.canvasX=a,mouse.canvasY=o,inputHandler.handleMouse({x:n.pageX,y:n.pageY,pageX:n.pageX,pageY:n.pageY,button:0}),window.onmousedown({...e,x:n.pageX,y:n.pageY,pageX:n.pageX,pageY:n.pageY,button:0,mobile:!0}),!0===globalInventory.menuActive&&null===draggingPetalContainer&&globalInventory.handleIOSMouseDown(a,o)},{passive:!1}),document.addEventListener("touchend",e=>{const n=e.changedTouches[0],t=e.target;if("BUTTON"===t.tagName||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||t.classList.contains("play-btn")||t.classList.contains("play-text")||t.classList.contains("btn")||t.closest(".play-btn")||t.closest("button")||t.closest(".btn")||t.closest("#settingsButton")||t.closest("#fullscreenButton"))return;const a=n.pageX*canvas.w/window.innerWidth,o=n.pageY*canvas.h/window.innerHeight;mouse.x=n.pageX,mouse.y=n.pageY,mouse.canvasX=a,mouse.canvasY=o,e.preventDefault(),inputHandler.handleMouse({x:n.pageX,y:n.pageY,pageX:n.pageX,pageY:n.pageY,button:0}),"menu"===window.state&&"undefined"!=typeof squadUI&&!0===squadUI.draggingSlider&&squadUI.endSliderDrag(a),window.onmouseup({...e,x:n.pageX,y:n.pageY,pageX:n.pageX,pageY:n.pageY,button:0,mobile:!0})}),document.addEventListener("touchcancel",e=>{const n=e.changedTouches[0],t=n.pageX*canvas.w/window.innerWidth,a=n.pageY*canvas.h/window.innerHeight;mouse.x=n.pageX,mouse.y=n.pageY,mouse.canvasX=t,mouse.canvasY=a,"menu"===window.state&&"undefined"!=typeof squadUI&&!0===squadUI.draggingSlider&&squadUI.endSliderDrag(t),inputHandler.handleMouse({x:n.pageX,y:n.pageY,pageX:n.pageX,pageY:n.pageY,button:0}),window.onmouseup({...e,x:n.pageX,y:n.pageY,pageX:n.pageX,pageY:n.pageY,button:0,mobile:!0})}),window.chatMessages=[],window.chatMsgFadeTimes=[],window.mobile&&chatInput.addEventListener("click",()=>{chatDiv.classList.remove("hidden"),chatInput.focus(),inputHandler.chatOpen=!0,chatInput.style.opacity="1";let e=prompt("Send a chat message");if(0!==e.length)if("/clear"==e){for(let e=0;e<chatDiv.children[1].children.length;e++)chatDiv.children[1].children.item(0).remove();chatDiv.children[1].children.item(0).remove()}else send(["c",e]);inputHandler.chatOpen=!1,chatInput.value="",chatInput.blur(),chatInput.style.opacity="0"});