let initBiomeIndex=localStorage.getItem("lastBiome");null===initBiomeIndex&&(initBiomeIndex=0);class BiomeManager{constructor(){const t=["deepzoo","zoo","swamp","beach","savanna","trench"];this.biomeOrder=[...Object.keys(Colors.biomes)].filter(i=>!t.includes(i)),this.currentBiome=parseInt(initBiomeIndex)??0,this.currentBiome>=this.biomeOrder.length&&(this.currentBiome=0),this.arrowOscilTimer=0,this.drawLeftArrow=void 0!==this.biomeOrder[this.currentBiome-1],this.drawRightArrow=void 0!==this.biomeOrder[this.currentBiome+1],window.showCommunityBiomes||(this.drawRightArrow=this.currentBiome+1<officialBiomes.length),this.hoveringLeftArrow=!1,this.hoveringRightArrow=!1,this.transitionTime=400,this.transitionAnimationTimer=this.transitionTime,this.lastDirectionPressed="right",this.arrowMargin=11,this.arrowSize=1773*.032,this.updateArrowDimensions(),this.fadeTimer=1,this.fadeState="in"}fadeOut(){this.fadeState="out"}fadeIn(){this.fadeState="in"}updateArrowDimensions(){this.rightArrow={x:canvas.w-.03*canvas.w-.032*canvas.w,y:canvas.h/2-.032*canvas.w/2,w:.032*canvas.w,h:.032*canvas.w},this.leftArrow={x:.03*canvas.w,y:canvas.h/2-.032*canvas.w/2,w:.032*canvas.w,h:.032*canvas.w}}draw(){!0===window.loaded&&("in"===this.fadeState?(this.fadeTimer+=dt/160,this.fadeTimer>1&&(this.fadeTimer=1)):"out"===this.fadeState&&(this.fadeTimer-=dt/100,this.fadeTimer<0&&(this.fadeTimer=0)),!0===window.squadUIEnabled&&"in"===this.fadeState?this.fadeOut():!0!==window.squadUIEnabled&&"out"===this.fadeState&&this.fadeIn(),this.drawBiomeSwitchArrows(smoothstep(this.fadeTimer)))}drawBiomeSwitchArrows(t=1){if(this.transitionAnimationTimer+=dt,"out"===this.fadeState&&(this.hoveringRightArrow=!1,this.hoveringLeftArrow=!1),0===t)return;ctx.globalAlpha=t,this.arrowOscilTimer+=dt;let i=6*Math.sin(this.arrowOscilTimer/200);const r=(this.currentBiome+1)%this.biomeOrder.length;let e=(this.currentBiome-1)%this.biomeOrder.length;e<0&&(e+=this.biomeOrder.length);const o=this.biomeOrder[r],s=this.biomeOrder[e];ctx.strokeStyle="#b8b8b8",ctx.lineWidth=12,!0===this.drawRightArrow&&(ctx.save(),ctx.beginPath(),ctx.moveTo(i+this.rightArrow.x+this.rightArrow.w,this.rightArrow.y+this.rightArrow.h/2),ctx.lineTo(i+this.rightArrow.x,this.rightArrow.y),ctx.lineTo(i+this.rightArrow.x,this.rightArrow.y+this.rightArrow.h),ctx.lineTo(i+this.rightArrow.x+this.rightArrow.w,this.rightArrow.y+this.rightArrow.h/2),ctx.clip(),ctx.closePath(),ctx.fillStyle=Colors.biomes[o].background,ctx.strokeStyle=Colors.biomes[o].grid,renderBg(),ctx.restore(),ctx.globalAlpha=.4*t,ctx.setLineDash([30,30]),ctx.lineDashOffset=-performance.now()/12,ctx.beginPath(),ctx.moveTo(i+this.rightArrow.x+this.rightArrow.w,this.rightArrow.y+this.rightArrow.h/2),ctx.lineTo(i+this.rightArrow.x,this.rightArrow.y),ctx.lineTo(i+this.rightArrow.x,this.rightArrow.y+this.rightArrow.h),ctx.lineTo(i+this.rightArrow.x+this.rightArrow.w,this.rightArrow.y+this.rightArrow.h/2),ctx.stroke(),ctx.closePath(),ctx.setLineDash([]),ctx.globalAlpha=t),!0===this.drawLeftArrow&&(ctx.save(),ctx.globalAlpha=t,ctx.beginPath(),ctx.moveTo(-i+this.leftArrow.x,this.leftArrow.y+this.leftArrow.h/2),ctx.lineTo(-i+this.leftArrow.x+this.leftArrow.w,this.leftArrow.y),ctx.lineTo(-i+this.leftArrow.x+this.leftArrow.w,this.leftArrow.y+this.leftArrow.h),ctx.lineTo(-i+this.leftArrow.x,this.leftArrow.y+this.leftArrow.h/2),ctx.clip(),ctx.closePath(),ctx.fillStyle=Colors.biomes[s].background,ctx.strokeStyle=Colors.biomes[s].grid,renderBg(),ctx.restore(),ctx.globalAlpha=.4*t,ctx.setLineDash([30,30]),ctx.lineDashOffset=-performance.now()/12,ctx.beginPath(),ctx.moveTo(-i+this.leftArrow.x,this.leftArrow.y+this.leftArrow.h/2),ctx.lineTo(-i+this.leftArrow.x+this.leftArrow.w,this.leftArrow.y),ctx.lineTo(-i+this.leftArrow.x+this.leftArrow.w,this.leftArrow.y+this.leftArrow.h),ctx.lineTo(-i+this.leftArrow.x,this.leftArrow.y+this.leftArrow.h/2),ctx.stroke(),ctx.closePath(),ctx.setLineDash([]),ctx.globalAlpha=t),ctx.globalAlpha=1}mouseDown({mouseX:t,mouseY:i}){0!==this.fadeTimer&&(this.drawRightArrow&&!0===mouseInBox({x:t,y:i},this.rightArrow)?(this.lastBiome=this.currentBiome,this.currentBiome++,this.lastDirectionPressed="right",this.updateBiome()):this.drawLeftArrow&&!0===mouseInBox({x:t,y:i},this.leftArrow)&&(this.lastBiome=this.currentBiome,this.currentBiome--,this.lastDirectionPressed="left",this.updateBiome()))}switchToBiome(t){if(t===this.biomeOrder[this.currentBiome])return;let i=null;for(let r=0;r<this.biomeOrder.length;r++)if(this.biomeOrder[r]===t){i=r;break}null!==i&&(this.lastBiome=this.currentBiome,this.currentBiome=i,this.lastDirectionPressed=this.current>this.lastBiome?"right":"left",this.updateBiome())}mouseMove({mouseX:t,mouseY:i}){0!==this.fadeTimer&&(this.hoveringRightArrow=!1,this.hoveringLeftArrow=!1,this.drawRightArrow&&!0===mouseInBox({x:t,y:i},this.rightArrow)?this.hoveringRightArrow=!0:this.drawLeftArrow&&!0===mouseInBox({x:t,y:i},this.leftArrow)&&(this.hoveringLeftArrow=!0))}updateBiome(){mobGallery.toRegenerate=!0,this.transitionAnimationTimer=0,this.drawLeftArrow=void 0!==this.biomeOrder[this.currentBiome-1],this.drawRightArrow=void 0!==this.biomeOrder[this.currentBiome+1],window.showCommunityBiomes||(this.drawRightArrow=this.currentBiome+1<officialBiomes.length);for(let t=0;t<menuEnemies.length;t++)menuEnemies[t].updatedBiome=!1;menuInventory.updateBiome(),is1v1="1v1"===this.biomeOrder[this.currentBiome],localStorage.setItem("lastBiome",this.currentBiome)}getCurrentBiomeData(){return{ratio:Math.min(1,this.transitionAnimationTimer/this.transitionTime),last:this.biomeOrder[this.lastBiome],current:this.biomeOrder[this.currentBiome],direction:this.lastDirectionPressed}}getCurrentBiome(){return this.biomeOrder[this.currentBiome]}}const biomeManager=new BiomeManager;