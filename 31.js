let canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");const tileSize=50,menu=document.querySelector(".menu"),fullscreen={ratio:9/16,zoom:1200};let renderScale=1;function resize(){const e=window.devicePixelRatio;if(canvas.style.width=Math.ceil(window.innerWidth)+"px",canvas.style.height=Math.ceil(window.innerHeight)+"px",canvas.width=Math.ceil(window.innerWidth)*e,canvas.height=Math.ceil(window.innerHeight)*e,canvas.zoom=Math.max(.1,Math.round(Math.max(canvas.height,canvas.width*fullscreen.ratio)/fullscreen.zoom*renderScale*100)/100),canvas.w=canvas.width/canvas.zoom,canvas.h=canvas.height/canvas.zoom,ctx.scale(canvas.zoom,canvas.zoom),ctx.lineJoin="round",ctx.lineCap="round",menu.style.width=Math.ceil(window.innerWidth)/canvas.zoom*e/1.65+"px",menu.style.height=Math.ceil(window.innerHeight)/canvas.zoom*e/1.65+"px",menu.style.transform=`scale(${canvas.zoom/e*1.65})`,menu.style.transformOrigin="0px 0px","account"===window.state){const t=document.querySelector(".login-menu");t.style.width=Math.ceil(window.innerWidth)/canvas.zoom*e/1.65+"px",t.style.height=Math.ceil(window.innerHeight)/canvas.zoom*e/1.65+"px",t.style.transform=`scale(${canvas.zoom/e*1.65})`,t.style.transformOrigin="0px 0px"}try{menuInventory&&menuInventory.positionPetalSlots()}catch(e){}try{inventory&&inventory.positionPetalSlots()}catch(e){}"undefined"!=typeof levelBar&&levelBar.calculateDimensions(),"undefined"!=typeof GraceBar&&GraceBar.calculateDimensions("grace"),"undefined"!=typeof TimeBar&&TimeBar.calculateDimensions("time"),"undefined"!=typeof DivergenceBar&&DivergenceBar.calculateDimensions("divergence"),"undefined"!=typeof biomeManager&&biomeManager.updateArrowDimensions(),void 0!==globalInventory&&globalInventory.resizeScroll(),"undefined"!=typeof changelog&&changelog.resizeScroll(),!0===window.is3D&&window.resize3D()}window.addEventListener("resize",function(){resize()});const menuEnemyIncrementRadii=[3.6,4.8,6.6,7.2,8,12,18];let lastTime=performance.now();dt=0;let time=performance.now();function render(){requestAnimationFrame(render),draw(),window.flowrMod&&window.flowrMod.rarities&&(window.flowrMod.rarities=Colors.rarities)}function draw(){if(time=performance.now(),dt=time-lastTime,lastTime=time,dt>1e3&&(dt=0),"account"===window.state?renderAccountMenu(dt):"menu"===window.state?renderMenu(dt):(renderGame(dt),"disconnected"===window.state&&null==window.connectOtherServerId&&renderDisconnectedText(dt)),!0===window.toRenderDebug){if(window.framesRendered++,window.framesRendered>10){const e=performance.now();window.fps=Math.floor(window.framesRendered/(e-window.lastFramesRenderedResetTime)*1e3),window.lastFramesRenderedResetTime=e,window.framesRendered=0}renderDebug()}}window.fps=0,window.interpolateCalls=0,window.framesRendered=0,window.lastFramesRenderedResetTime=performance.now(),window.clicks=0,window.clickLoc={},window.activeClicks=[];const globalInventory=new GlobalInventory,specialGlobalInventory=new SpecialGlobalInventory;window.specialGlobalInventory=specialGlobalInventory;let maxRarityObtained=0;const menuInventory=new Inventory(savedSlotAmount);menuInventory.initChangePetalsQueue();let squadUI=new SquadUI;const craftingMenu=new CraftingMenu;let connectingTextAnimationCompletion=1,particles=[];function renderMenu(e){const{ratio:t,last:n,current:a,direction:i}=biomeManager.getCurrentBiomeData();if(1!==t){"right"===i?(ctx.fillStyle=Colors.biomes[n].background,ctx.strokeStyle=Colors.biomes[n].grid):(ctx.fillStyle=Colors.biomes[a].background,ctx.strokeStyle=Colors.biomes[a].grid),renderBg(),ctx.save(),ctx.beginPath(),"right"===i?ctx.rect(0,0,smoothstep(smoothstep(t))*canvas.w,canvas.h):ctx.rect(0,0,(1-smoothstep(smoothstep(t)))*canvas.w,canvas.h),ctx.clip(),ctx.closePath(),"right"===i?(ctx.fillStyle=Colors.biomes[a].background,ctx.strokeStyle=Colors.biomes[a].grid):(ctx.fillStyle=Colors.biomes[n].background,ctx.strokeStyle=Colors.biomes[n].grid),renderBg(),ctx.restore();for(let e=0;e<menuEnemies.length;e++)if(void 0!==menuEnemies[e].updatedBiome&&("right"===i&&menuEnemies[e].render.x<=smoothstep(smoothstep(t))*canvas.w||"left"===i&&menuEnemies[e].render.x>=(1-smoothstep(smoothstep(t)))*canvas.w)){delete menuEnemies[e].updatedBiome;const t=biomeEnemyMap[a]??[];menuEnemies[e].type=t[Math.floor(Math.random()*t.length)],menuEnemies[e]=new Enemy(menuEnemies[e])}}else ctx.fillStyle=Colors.biomes[a].background,ctx.strokeStyle=Colors.biomes[a].grid,renderBg();if(biomeManager.draw(),renderMenuEnemies(),window.fireworks||(window.fireworks=[]),Math.random()<e/16*.06){let e=5*Math.random()+5,t={x:Math.random()*canvas.w,y:canvas.h,yVel:10*-Math.random()-55,xVel:50*Math.random()-25,radius:e,maxRadius:e,main:!0,color:["#5ccefa","#f4a9b7","#ffffff","#ff0000","#00ff00","#0000ff","#ffff00","#00ffff","#ff00ff"][9*Math.random()|0]};window.fireworks.push(t)}for(let t of window.fireworks){if(Math.random()<e/16&&particles.push({x:t.x,y:t.y,radius:t.radius,maxRadius:t.maxRadius,main:t.main,color:t.main?"#555555":t.color}),t.main&&t.y<canvas.h-canvas.h/1.25){let e=4*Math.random()+5|0;for(let n=0;n<e;n++){let a=n*Math.PI*2/e,i=5*Math.random()+2,o={x:t.x,y:t.y,yVel:Math.sin(a)*(10*Math.random()+10),xVel:Math.cos(a)*(10*Math.random()+10),radius:i,maxRadius:i,color:t.color};window.fireworks.push(o)}}t.x+=t.xVel*(e/16),t.y+=t.yVel*(e/16),t.yVel+=e/16*.98,t.radius-=.03*t.radius*(e/16),t.radius/t.maxRadius<.5&&(t.toDelete=!0)}for(let t of particles)ctx.fillStyle=t.color,ctx.globalAlpha=Math.max(0,t.radius/t.maxRadius),ctx.beginPath(),ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.globalAlpha/=2,ctx.beginPath(),ctx.arc(t.x,t.y,1.75*t.radius,0,2*Math.PI),ctx.fill(),ctx.globalAlpha*=2,ctx.closePath(),ctx.globalAlpha=1,t.radius-=t.radius*(t.main?.1:.03)*(e/16),t.radius/t.maxRadius<.1&&(t.toDelete=!0);window.fireworks=window.fireworks.filter(e=>{if(!e.toDelete)return!0}),particles=particles.filter(e=>{if(!e.toDelete)return!0}),settingsMenu.draw(),changelog.draw(),(!1===window.connected||time-window.connectedTime<800)&&(connectingTextAnimationCompletion=!1===window.connected?1:1-easeOutCubic((time-window.connectedTime)/800),ctx.globalAlpha=1,ctx.font="900 42px 'Ubuntu'",ctx.fillStyle="#f0f0f0",ctx.strokeStyle="black",ctx.lineWidth=5,ctx.textAlign="center",ctx.textBaseline="middle",ctx.strokeText("Connecting...",canvas.w/2,.5*canvas.h*connectingTextAnimationCompletion-.03*canvas.h),ctx.fillText("Connecting...",canvas.w/2,.5*canvas.h*connectingTextAnimationCompletion-.03*canvas.h));let o=!1;if(time-window.connectedTime<1e3){o=!0;const e=easeOutCubic(smoothstep((time-window.connectedTime)/1e3));var r=0*e+(1-e)*(-canvas.h/2-140);ctx.translate(0,r)}ctx.font="900 91px Ubuntu",ctx.textAlign="center",ctx.textBaseline="middle",ctx.letterSpacing="-1px",ctx.lineWidth=10,ctx.strokeStyle="black",ctx.strokeText("thoita.com",canvas.w/2,canvas.h/2-140),ctx.fillStyle="white",ctx.fillText("thoita.com",canvas.w/2,canvas.h/2-140);let c=canvas.w/2-ctx.measureText("thoita.com").width/2+ctx.measureText("thoita").width+ctx.measureText(".").width/2;ctx.strokeStyle="black",ctx.strokeText(".",c,canvas.h/2-140),window.clicks>0?ctx.fillStyle=`hsl(${10*window.clicks%360} 100 50)`:ctx.fillStyle="white",ctx.fillText(".",c,canvas.h/2-140),window.clickLoc={x:c,y:canvas.h/2-130},window.activeClicks=window.activeClicks.filter(e=>e.t<=500),ctx.save(),ctx.translate(window.clickLoc.x,window.clickLoc.y);let l=1+window.clicks**.5/10;ctx.scale(l,l);for(let t=0;t<window.activeClicks.length;t++)window.activeClicks[t].t+=e,window.activeClicks[t].x+=window.activeClicks[t].xv*e,window.activeClicks[t].y+=window.activeClicks[t].yv*e,window.activeClicks[t].yv+=.001*e,renderClickCounter({radius:50,timeAlive:window.activeClicks[t].t,totalDamage:window.activeClicks[t].n,x:window.activeClicks[t].x,y:window.activeClicks[t].y});if(ctx.restore(),ctx.letterSpacing="0px",!0===o&&ctx.translate(0,-r),levelBar.draw(),!0===window.connected){const t=menuInventory.topPetalSlots[0].size,n=menuInventory.bottomPetalSlots[0].size,a=t+t*paddingRatio+n+n*paddingRatio-2,i=-canvas.h/2+1.5*a;if(time-window.connectedTime<1e3){const e=easeOutCubic(smoothstep((time-window.connectedTime)/1e3)),t=i*e+(1-e)*a;menuInventory.translateY=t,menuInventory.draw(e)}else!0===window.squadUIEnabled?(menuInventory.translateY=i+.95*squadUI.h,menuInventory.draw(),squadUI.render(e)):(menuInventory.translateY=i,menuInventory.draw());null!==draggingPetalContainer&&draggingPetalContainer.draw()}craftingMenu.drawIcon(),specialGlobalInventory.drawIcon(),globalInventory.drawIcon(),mobGallery.drawIcon(),craftingMenu.draw(),specialGlobalInventory.draw(),globalInventory.draw(),mobGallery.draw(),void 0===window.ascendUI||disableAscendedAsk||window.ascendUI.draw(),void 0!==window.characterSelector&&window.characterSelector.draw(),streakMenu.draw()}function renderBg(){if(ctx.fillRect(0,0,canvas.w,canvas.h),!0!==window.noGrid){const e=-time/20%50;ctx.lineWidth=2,ctx.globalAlpha=.6;for(let t=e-ctx.lineWidth;t<=canvas.w+ctx.lineWidth;t+=50)ctx.beginPath(),ctx.moveTo(t,0),ctx.lineTo(t,canvas.h),ctx.stroke(),ctx.closePath();for(let t=-e-ctx.lineWidth;t<=canvas.h+ctx.lineWidth;t+=50)ctx.beginPath(),ctx.moveTo(0,t),ctx.lineTo(canvas.w,t),ctx.stroke(),ctx.closePath()}ctx.globalAlpha=1}function easeOutCubic(e){return 1-Math.pow(1-e,3)}function renderAccountMenu(e){if(ctx.fillStyle="#1ea761",ctx.fillRect(0,0,canvas.w,canvas.h),!0!==window.noGrid){const e=-time/20%50;ctx.strokeStyle="#1c8c54",ctx.lineWidth=2,ctx.globalAlpha=.6;for(let t=e-ctx.lineWidth;t<=canvas.w+ctx.lineWidth;t+=50)ctx.beginPath(),ctx.moveTo(t,0),ctx.lineTo(t,canvas.h),ctx.stroke(),ctx.closePath();for(let t=-e-ctx.lineWidth;t<=canvas.h+ctx.lineWidth;t+=50)ctx.beginPath(),ctx.moveTo(0,t),ctx.lineTo(canvas.w,t),ctx.stroke(),ctx.closePath()}void 0!==window.loginMessage&&(ctx.fillStyle="white",ctx.strokeStyle="black",ctx.font="900 28px 'Ubuntu'",ctx.textAlign="center",ctx.textBaseline="top",ctx.lineWidth=5,ctx.globalAlpha=1,performance.now()-window.lastLoginMessageChangeTime<500&&(ctx.globalAlpha=(performance.now()-window.lastLoginMessageChangeTime)/500),ctx.strokeText(window.loginMessage,canvas.w/2,canvas.h-40),ctx.fillText(window.loginMessage,canvas.w/2,canvas.h-40),ctx.globalAlpha=1,ctx.textBaseline="middle")}const enemyTypes=Object.keys(enemyRenderMap).filter(e=>"Square"!==e&&"default"!==e&&!1===noRenderingUi.includes(e)),biomeEnemyMap={garden:["Hornet","Bee","Centipede","Evil Centipede","Ant Burrow","Dandelion","DandelionMissile","Ladybug","Rock","Spider","Worker Ant","Baby Ant","Soldier Ant","Dark Ladybug","Queen Ant","Missile","DandelionMissile","Tree","Root"],desert:["Scorpion","Fire Ant Burrow","Beetle","Desert Centipede","Shiny Ladybug","Soldier Fire Ant","Sandstorm","Cactus","Locust","Queen Fire Ant","Desert Moth","Sandstone","Tarantula","Moonlit Frog","Sunlit Frog","ScorpionMissile","Worker Fire Ant","Baby Fire Ant"],ocean:["Bubble","Shell","Jellyfish","Starfish","Leech","Crab","Sponge","Sea Urchin","UrchinMissile","Sea Floor Burrow","Coral","Electric Eel"],"1v1":["1v1text","Agar.io Cell"]},rareBiomeEnemyMap={garden:["Soil"],desert:["FireMissile","Shiny Ant Burrow","Shiny Beetle","Shiny Cactus"],ocean:["Plastic","Ocean Ladybug","Dark Electric Eel","Shiny Electric Eel"]},secretBiomeEnemyMap={desert:["Evil Desert Centipede","Queen Shiny Ant","Soldier Shiny Ant","Ruby Frog","Termite Mound","Queen Termite","Soldier Termite","Worker Termite","Baby Termite","Tick","Whirlpool","Grasshopper","Stickbug","Mushroom"],ocean:["Shiny Plastic","Lilypad","Shiny Lilypad","Carrion Spire","Flowering Lilypad","Poison Dart Frog","Fly","Firefly","Whirlpool","Dark Beetle","Pufferfish","Brisingida","Neuroflare","Swampy Moth","Dauber","Gloomcrawler","Gnat","Gnat Swarm"],garden:["Termite Mound","Queen Termite","Carrion Spire","Soldier Termite","Worker Termite","Baby Termite","Tick","Soldier Shiny Ant","Lilypad","Shiny Lilypad","Flowering Lilypad","Poison Dart Frog","Fly","Firefly","Grasshopper","Stickbug","Swampy Moth","Dauber","Gloomcrawler","Gnat","Gnat Swarm","Mushroom"]};window.enemyStats={};let menuEnemies=[];function initMenuEnemies(){for(let e=0;e<26+6*maxRarityObtained/8;e++)spawnMenuEnemy(),menuEnemies[menuEnemies.length-1].x=Math.random()*window.innerHeight}let menuEnemyTimer=400;function renderMenuEnemies(){Math.random()<.02+.005*maxRarityObtained/8*dt/16.67&&spawnMenuEnemy();const e=time;for(let t=0;t<menuEnemies.length;t++){const n=menuEnemies[t],a=mouse.canvasX,i=mouse.canvasY;Math.sqrt((a-n.render.x)**2+(i-n.render.y)**2)<2*n.radius+100&&!0!==n.dead?n.isHovered=!0:n.isHovered=!1,n.draw(),n.sinTimer+=dt/16.67,n.angle+=1*n.angleVel+Math.abs(Math.sin(e/1e4))/200*dt/16.67,n.x+=n.xVel*dt/16.67,n.y+=(n.yVel+Math.sin(n.sinTimer/n.maxSinTimer*2*Math.PI)*n.sinVel)*dt/16.67,n.x>canvas.w+2*n.radius+100&&(n.toRemove=!0)}menuEnemies=menuEnemies.filter(e=>!0!==e.toRemove),ctx.lastTransform7=ctx.getTransform(),ctx.setTransform(ctx.lastTransform7),delete ctx.lastTransform7}function spawnMenuEnemy(){if("undefined"==typeof biomeManager)return;const e=biomeManager.getCurrentBiomeData().current,t=void 0!==rareBiomeEnemyMap[e]&&Math.random()<.01?rareBiomeEnemyMap[e]:biomeEnemyMap[e]??[],n=Math.random()<1e-4?360:8.7*Math.sqrt(menuEnemyIncrementRadii[Math.floor(Math.random()*menuEnemyIncrementRadii.length)]*(.1*Math.random()+.95));menuEnemies.push(new Enemy({x:3*-n,y:-n+Math.random()*(canvas.h+2*n),radius:n,hp:100,maxHp:100,id:Math.random(),type:t[Math.floor(Math.random()*t.length)],rarity:0,angle:Math.random()*Math.PI*2,angleVel:.04*Math.random()-.02,xVel:Math.random()<.001?20:(5.8+Math.random()**3*1.5)/2,yVel:(Math.random()>.5?1:-1)*Math.random()**3*1,sinTimer:(212+46*Math.random())*Math.random(),sinVel:.8*Math.random(),maxSinTimer:212+46*Math.random(),toRenderUi:!1,isMenuEnemy:!0}))}function renderClickCounter({radius:e,timeAlive:t,totalDamage:n,x:a,y:i}){t<500&&0!==n&&(ctx.fillStyle=`hsl(${10*window.clicks%360} 100 50)`,ctx.strokeStyle=`hsl(${10*window.clicks%360} 100 20)`,ctx.lineWidth=7,ctx.font=.4*e<25?"600 25px 'Ubuntu'":.4*e>100?"600 100px 'Ubuntu'":`600 ${.4*e}px 'Ubuntu'`,ctx.textAlign="center",ctx.textBaseline="middle",ctx.globalAlpha=.7*(1-t/500),ctx.strokeText(n,a,i),ctx.fillText(n,a,i),ctx.globalAlpha=1,ctx.letterSpacing="0px")}function renderDebug(){ctx.font="900 15px 'Ubuntu'",ctx.textAlign="right",ctx.textBaseline="bottom",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=2;let e="";"game"==window.state&&(e=`Room: ${Object.keys(room.enemies).length} enemies, ${Object.keys(window.enemiesSent??{}).length} server enemies, ${Object.keys(room.flowers).length} flowers, ${Object.keys(room.petalContainers).length} petal containers`,ctx.strokeText(e,canvas.w-2,canvas.h-17),ctx.fillText(e,canvas.w-2,canvas.h-17)),e=`FPS: ${window.fps}, Client Version: ${ver||"undetected"}, Server: ${servers[ws.url]}`,ctx.strokeText(e,canvas.w-2,canvas.h-2),ctx.fillText(e,canvas.w-2,canvas.h-2)}requestAnimationFrame(render);