function calculateManaCost(i,n,s){let t=i;if(t<240&&(t=240),"grace"==n){return 1.014**(t-240)*500*((s-1)/3*.7+.3)}if("time"==n){return 1.014**(t-240)*400*Math.max(.5,1-s/2)}if("divergence"==n)return 1.014**(t-240)*250}class ManaBar{constructor(i){this.maxMana=0,this.mana=0,this.type=i,this.calculateDimensions(i),this.hasInit=!1,this.render={xp:this.xp,level:this.level,initAnimation:0}}calculateDimensions(i){this.dimensions={x:canvas.w*(.8+.05),y:.85*canvas.h,w:.14*canvas.w,h:.03*canvas.h,roundness:canvas.w,innerPadding:4},"grace"==i&&(this.dimensions.y=.81*canvas.h),"time"==i&&(this.dimensions.y=.77*canvas.h)}init(i,n){this.mana=n,this.maxMana=i,this.hasInit=!0,this.render.mana=this.mana}updateMana(i){this.mana=i}draw(i,n){let s,t=!1;if(!0===this.hasInit&&(this.render.initAnimation=interpolate(this.render.initAnimation,1,.04)),this.render.initAnimation<.999&&ctx.translate(0,(1-this.render.initAnimation)*canvas.h*.18),this.render.mana=interpolate(this.render.mana,this.mana,.04),!(this.dimensions.w<this.dimensions.h)){if(ctx.beginPath(),ctx.fillStyle="#333333",ctx.beginPath(),ctx.roundRect(this.dimensions.x,this.dimensions.y,this.dimensions.w,this.dimensions.h,this.dimensions.roundness),ctx.fill(),ctx.closePath(),this.mana/this.maxMana<.05&&(ctx.globalAlpha=Math.max(0,this.mana/this.maxMana*19+.05)),ctx.fillStyle=Colors.mana[this.type],ctx.beginPath(),ctx.roundRect(this.dimensions.x+this.dimensions.innerPadding,this.dimensions.y+this.dimensions.innerPadding,this.dimensions.h+(this.dimensions.w-this.dimensions.h)*(this.mana/this.maxMana)-2*this.dimensions.innerPadding,this.dimensions.h-2*this.dimensions.innerPadding,this.dimensions.roundness),ctx.fill(),ctx.closePath(),"grace"==this.type&&n>1&&!(bosses.length>0)&&(t=!0),"time"!=this.type||room.globalWebActive||(t=!0),"divergence"==this.type&&n>1&&!(bosses.length>0)&&(t=!0),t&&(s=this.mana-calculateManaCost(i,this.type,n),s<0?s=0:(ctx.globalAlpha=.2,ctx.fillStyle="#000000",ctx.beginPath(),ctx.roundRect(this.dimensions.x+1.1*this.dimensions.innerPadding,this.dimensions.y+1.1*this.dimensions.innerPadding,this.dimensions.h+(this.dimensions.w-this.dimensions.h)*(s/this.maxMana)-2.2*this.dimensions.innerPadding,this.dimensions.h-2.2*this.dimensions.innerPadding,this.dimensions.roundness),ctx.fill(),ctx.closePath(),ctx.globalAlpha=1)),ctx.globalAlpha=1,mouse.canvasX>this.dimensions.x&&mouse.canvasY>this.dimensions.y&&mouse.canvasX<this.dimensions.x+this.dimensions.w&&mouse.canvasY<this.dimensions.y+this.dimensions.h){ctx.fillStyle="#f0f0f0",ctx.strokeStyle="black",ctx.lineWidth=2.25,ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=`900 ${Math.round(.0088*canvas.w)}px Ubuntu`;let i="";t&&(ctx.font=`900 ${Math.round(.006*canvas.w)}px Ubuntu`,i=`; ${formatAmountHighPrecision(s)} if used`);let n=`${formatAmountHighPrecision(this.mana)}/${formatAmountHighPrecision(this.maxMana)} mana${i}`;ctx.strokeText(n,this.dimensions.x+this.dimensions.w/2,this.dimensions.y+this.dimensions.h/2),ctx.fillText(n,this.dimensions.x+this.dimensions.w/2,this.dimensions.y+this.dimensions.h/2)}this.render.initAnimation<.999&&ctx.translate(0,-(1-this.render.initAnimation)*canvas.h*.18)}}}let GraceBar=new ManaBar("grace"),TimeBar=new ManaBar("time"),DivergenceBar=new ManaBar("divergence");