class StreakMenu{constructor(){const t={x:canvas.w+20,visibleX:canvas.w-240-16,y:20,w:240,h:205};this.referenceW=canvas.w,this.originalX=this.x=t.x,this.visibleX=t.visibleX,this.y=t.y,this.w=t.w,this.h=t.h,this.dimensions=t,this.visibleAnimationTimer=0,this.visible=!1,this.claimPetalContainer=null,this.claimButton={x:this.w/2-29,y:this.y+23+30+45+44+16,w:58,h:34.375},this.claimButtonHovered=!1,this.streak=0,this.xpToClaim=0,this.showType="claim",this.timer=0}init(t){if(t.streakLost)this.showType="lost",this.timer=1e4,this.h=this.dimensions.h/2.5,this.show();else if(t.streakTime)this.streak=t.streak,this.streakTime=t.streakTime,this.showType="timer",this.timer=1e4,this.h=this.dimensions.h/2.5,this.show();else{this.streak=t.streak;const i=[];for(let s=0;s<t.pc.petalAmount;s++)i.push(new Petal(t.pc.petal));this.h=this.dimensions.h,this.pc=new PetalContainer(i,{...t.pc},-1,1,0),this.pc.angleOffset=0,this.pc.toSkipCulling=!0,this.xpToClaim=Math.floor(t.xp),this.showType="claim",this.show()}}show(){this.visible=!0}hide(){this.visible=!1}resize(){const t={x:canvas.w+20,visibleX:canvas.w-240-20};this.referenceW=canvas.w,this.originalX=t.x,this.visibleX=t.visibleX}draw(){if(!0===this.visible?(this.visibleAnimationTimer=interpolate(this.visibleAnimationTimer,1,.1),this.x=interpolate(this.originalX,this.visibleX,this.visibleAnimationTimer)):(this.visibleAnimationTimer=interpolate(this.visibleAnimationTimer,0,.1),this.x=interpolate(this.originalX,this.visibleX,this.visibleAnimationTimer)),canvas.w!==this.referenceW&&this.resize(),this.visibleAnimationTimer<.01)return;ctx.fillStyle="#895adb",ctx.strokeStyle="#6f49b1",ctx.lineWidth=6,ctx.beginPath(),ctx.roundRect(this.x,this.y,this.w,this.h,3),ctx.fill(),ctx.stroke(),ctx.closePath();const t=ctx.letterSpacing;if("claim"==this.showType&&this.drawLightCones(),"lost"!=this.showType?(ctx.font="900 22px Ubuntu",ctx.letterSpacing="-.05px",ctx.textBaseline="middle",ctx.textAlign="center",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=3,0==this.streak?(ctx.strokeText("No streak",this.x+this.w/2,this.y+23),ctx.fillText("No streak",this.x+this.w/2,this.y+23)):1==this.streak?(ctx.strokeText(`Streak: ${this.streak} Day!`,this.x+this.w/2,this.y+23),ctx.fillText(`Streak: ${this.streak} Day!`,this.x+this.w/2,this.y+23)):(this.streak%10==0&&(ctx.fillStyle=`hsl(${time/10%360}, 60%, 60%)`),ctx.strokeText(`Streak: ${this.streak} Days!`,this.x+this.w/2,this.y+23),ctx.fillText(`Streak: ${this.streak} Days!`,this.x+this.w/2,this.y+23),ctx.fillStyle="white")):(ctx.font="900 22px Ubuntu",ctx.letterSpacing="-.05px",ctx.textBaseline="middle",ctx.textAlign="top",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=3,ctx.strokeText("Streak Lost!",this.x+this.w/2,this.y+this.h/2),ctx.fillText("Streak Lost!",this.x+this.w/2,this.y+this.h/2),this.timer-=dt,this.timer<0&&this.hide()),"timer"==this.showType){ctx.font="900 24px Ubuntu";let t=new Date(0),i=864e5;if((i-(Date.now()-this.streakTime))/1e3>0){t.setSeconds((i-(Date.now()-this.streakTime))/1e3);let s=t.toISOString().substring(11,19);ctx.strokeText(s,this.x+this.w/2,this.y+this.h-23),ctx.fillText(s,this.x+this.w/2,this.y+this.h-23)}else ctx.strokeText("Reload to claim!",this.x+this.w/2,this.y+this.h-23),ctx.fillText("Reload to claim!",this.x+this.w/2,this.y+this.h-23);this.timer-=dt,this.timer<0&&this.hide()}"claim"==this.showType&&(ctx.font="900 18px Ubuntu",ctx.strokeText("Reward:",this.x+this.w/2,this.y+23+28),ctx.fillText("Reward:",this.x+this.w/2,this.y+23+28),this.pc.render.x=this.pc.x=this.x+this.w/2,this.pc.render.y=this.pc.y=this.y+23+30+20+25,this.pc.draw(),ctx.fillStyle="#00ff00",ctx.font="900 14px Ubuntu",ctx.strokeText(`+${formatAmount(this.xpToClaim)} xp`,this.x+this.w/2,this.y+23+30+45+44),ctx.fillText(`+${formatAmount(this.xpToClaim)} xp`,this.x+this.w/2,this.y+23+30+45+44),mouseInBox({x:mouse.canvasX,y:mouse.canvasY},{x:this.x+this.claimButton.x,y:this.claimButton.y,w:this.claimButton.w,h:this.claimButton.h})?(this.claimButtonHovered=!0,setCursor("pointer")):this.claimButtonHovered=!1,ctx.fillStyle="#55bb55",ctx.strokeStyle="#459745",!0===this.claimButtonHovered&&(ctx.fillStyle=blendColor(ctx.fillStyle,"#FFFFFF",.1),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#FFFFFF",.1)),ctx.lineWidth=5,ctx.beginPath(),ctx.roundRect(this.x+this.claimButton.x,this.claimButton.y,this.claimButton.w,this.claimButton.h,2),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.font="900 14px Ubuntu",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=2.15,ctx.strokeText("Claim",this.x+this.claimButton.x+this.claimButton.w/2,this.claimButton.y+this.claimButton.h/2),ctx.fillText("Claim",this.x+this.claimButton.x+this.claimButton.w/2,this.claimButton.y+this.claimButton.h/2),ctx.fillStyle="#895adb",ctx.strokeStyle="#6f49b1",ctx.lineWidth=6,ctx.beginPath(),ctx.roundRect(this.x,this.y,this.w,this.h,3),ctx.stroke(),ctx.closePath()),ctx.letterSpacing=t}mouseDown(){if("claim"==this.showType){if(!1===this.claimButtonHovered)return;send({collectStreak:!0}),this.hide()}}drawLightCones(){ctx.save(),ctx.beginPath(),ctx.rect(this.x,this.y,this.w,this.h),ctx.clip(),ctx.closePath();const t=this.x+this.w/2,i=this.y+23+30+20+25,s=300,e=ctx.createRadialGradient(t,i,0,t,i,s);e.addColorStop(0,"rgba(255, 255, 255, 0.3)"),e.addColorStop(1,"rgba(255, 255, 255, 0)"),ctx.fillStyle=e;const h=Date.now()/1e3*.26%(2*Math.PI);for(let e=h;e<2*Math.PI+h-.01;e+=2*Math.PI/24*2){const h=e+2*Math.PI/24;ctx.beginPath(),ctx.moveTo(t,i),ctx.lineTo(t+Math.cos(e)*s*2,i+Math.sin(e)*s*2),ctx.lineTo(t+Math.cos(h)*s*2,i+Math.sin(h)*s*2),ctx.lineTo(t,i),ctx.fill(),ctx.closePath()}ctx.restore()}}const streakMenu=new StreakMenu;