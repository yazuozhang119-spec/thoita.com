class Shop{constructor(){this.offers=[],this.shopItems=[],this.tokens=0,this.petalContainers=[],this.menu={color:"#8e6bb5",border:"#735793",y:{val:-500,target:-500},active:!1}}initShopItems(){"undefined"!=typeof send&&send({getShopItems:!0})}updateShopItems(t){this.shopItems=t||[],this.petalContainers=[],this.offers=this.shopItems.map((t,e)=>{let s=[],i="Light",o=0;if("petal"===t.type&&t.data.petal){const e=Stats.petals[t.data.petal.type]?.[t.data.petal.rarity];if(e){for(let i=0;i<e.petalLayout.length;i++)s.push(new Petal({x:0,y:0,angle:0,radius:10,type:t.data.petal.type,rarity:t.data.petal.rarity,damage:0,offset:0,distance:0,dv:0,id:Math.random(),subId:0,subStackedId:0,dead:!1,hp:1,maxHp:1,reload:1,maxReload:1,angleOffset:0,petalContainerId:-1}));i=t.data.petal.type,o=t.data.petal.rarity}}const n=20+e%4*(115+100/3)+57.5,c=65+123*Math.floor(e/4)+35;if("petal"===t.type&&s.length>0){const t=new PetalContainer(s,{x:n,y:c,w:57,h:57,originalX:n,originalY:c,toOscillate:!1},`shop_${e}`,1,null);this.petalContainers.push(t)}else this.petalContainers.push(null);return{price:t.cost,itemId:t.itemId,itemName:t.nameCN,itemType:t.type,rarity:o,type:i,skillPoint:t.data.skillPoint||0}})}draw(){if(this.menu.y.val=interpolate(this.menu.y.val,this.menu.y.target,.03*dt),!0===this.menu.active?this.menu.y.target=20:this.menu.y.target=-500,this.menu.y.val>-500){const t=130,e=this.menu.y.val,s=600,i=500;ctx.fillStyle=this.menu.color,ctx.strokeStyle=this.menu.border,ctx.lineWidth=8,ctx.beginPath(),ctx.roundRect(t,e,s,i,3),ctx.fill(),ctx.stroke(),ctx.closePath(),mouse.canvasX>t+s-50&&mouse.canvasY>e+17.5&&mouse.canvasX<t+s-20&&mouse.canvasY<e+17.5+30?(ctx.fillStyle="#c16666",setCursor("pointer"),this.hoveringOverX=!0):(this.hoveringOverX=!1,ctx.fillStyle="#c1565e"),ctx.strokeStyle="#90464b",ctx.lineWidth=5,ctx.beginPath(),ctx.roundRect(t+s-50,e+17.5,30,30,6),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.lineWidth=4.75,ctx.lineCap="round",ctx.strokeStyle="#cccccc",ctx.beginPath(),ctx.moveTo(t+s-50+7.5,e+17.5+7.5),ctx.lineTo(t+s-50+22.5,e+17.5+22.5),ctx.stroke(),ctx.beginPath(),ctx.moveTo(t+s-50+22.5,e+17.5+7.5),ctx.lineTo(t+s-50+7.5,e+17.5+22.5),ctx.stroke(),ctx.closePath(),ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="900 30px 'Ubuntu'",ctx.lineWidth=4,ctx.fillStyle="#ffffff",ctx.strokeStyle="#000000",ctx.strokeText("Shop",t+s/2,e+32.5),ctx.fillText("Shop",t+s/2,e+32.5),this.offers[0]&&this.drawOffers();const o=120,n=50,c=t+s-20-o/2,l=e+i-20-n/2;ctx.fillStyle="rgba(0, 0, 0, 0.3)",ctx.beginPath(),ctx.roundRect(c-o/2,l-n/2,o,n,8),ctx.fill(),ctx.closePath();const a=20,x=6;ctx.font="900 16px 'Ubuntu'";const r=c-(a+x+ctx.measureText(formatAmountHighPrecision(this.tokens)).width)/2;ctx.font="900 20px 'Segoe UI Emoji', 'Apple Color Emoji', sans-serif",ctx.textAlign="left",ctx.textBaseline="middle",ctx.fillStyle="#ffffff",ctx.fillText("ğŸ’°",r,l),ctx.font="900 16px 'Ubuntu'",ctx.textAlign="left",ctx.textBaseline="middle",ctx.lineWidth=2,ctx.fillStyle="#ffffff",ctx.strokeStyle="#000000",ctx.strokeText(formatAmountHighPrecision(this.tokens),r+a+x,l),ctx.fillText(formatAmountHighPrecision(this.tokens),r+a+x,l)}ctx.lineWidth=500}drawOffers(){const t=130,e=this.menu.y.val;ctx.save(),ctx.translate(t,e);const s=100/3;this.offerAreas=[];for(let i=0;i<this.offers.length;i++){const o=20+i%4*(115+s),n=65+123*Math.floor(i/4),c=80,l=28,a=o+(115-c)/2,x=n+70+0+(38-l)/2;this.offerAreas.push({x:a+t,y:x+e,width:c,height:l,index:i});const r=mouse.canvasX>a+t&&mouse.canvasX<a+t+c&&mouse.canvasY>x+e&&mouse.canvasY<x+e+l;r&&setCursor("pointer"),ctx.fillStyle="rgba(0, 0, 0, 0.3)",ctx.beginPath(),ctx.roundRect(o,n,115,108,8),ctx.fill(),ctx.closePath();const f=this.offers[i];if("skillPoint"===f.itemType){ctx.font="900 36px 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle="#FFD700",ctx.strokeStyle="#B8860B",ctx.lineWidth=3;const t=o+57.5,e=n+35;ctx.strokeText("â­",t,e),ctx.fillText("â­",t,e),ctx.font="700 12px 'Ubuntu'",ctx.fillStyle="#ffffff",ctx.fillText("+"+f.skillPoint,t,n+70-10)}else{const t=this.petalContainers[i];t&&(t.x=o+57.5,t.y=n+35,t.draw())}ctx.fillStyle=r?"#FFE44D":"#FFD700",ctx.strokeStyle=r?"#D4A017":"#B8860B",ctx.lineWidth=2,ctx.beginPath(),ctx.roundRect(a,x,c,l,6),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.textBaseline="middle",ctx.font="900 15px 'Ubuntu'";const h=18,u=4,d=a+(c-(h+u+ctx.measureText(f.price).width))/2;ctx.font="900 18px 'Segoe UI Emoji', 'Apple Color Emoji', sans-serif",ctx.textAlign="left",ctx.fillStyle="#4a3c00",ctx.fillText("ğŸ’°",d,x+l/2),ctx.font="900 15px 'Ubuntu'",ctx.fillText(f.price,d+h+u,x+l/2)}ctx.restore();for(let s=0;s<this.offers.length;s++){const i=this.petalContainers[s];if(!i)continue;const o=4,n=65,c=n+50,l=(560-o*c)/(o-1),a=70,x=a+0+38+15,r=t+(600-(o*c+(o-1)*l))/2+s%o*(c+l),f=e+65+Math.floor(s/o)*x,h=r+(c-n)/2,u=f,d=r+c/2,m=f+a/2;mouse.canvasX>h&&mouse.canvasX<h+n&&mouse.canvasY>u&&mouse.canvasY<u+n&&(i.isHovered=!0),i.drawStatsBox(!1,!1,d,m)}}handleClick(){if(this.menu.active&&this.offerAreas)for(const t of this.offerAreas)if(mouse.canvasX>t.x&&mouse.canvasX<t.x+t.width&&mouse.canvasY>t.y&&mouse.canvasY<t.y+t.height){const e=this.offers[t.index];return void(this.tokens>=e.price?"undefined"!=typeof send&&send({purchaseItem:{itemId:e.itemId}}):alert("ç§¯åˆ†ä¸è¶³ï¼éœ€è¦ "+e.price+" ç§¯åˆ†"))}}toggle(){!0===settingsMenu.active&&(settingsMenu.active=!1,settingsMenu.targetOffset=-settingsMenu.h-40),this.menu.active=!this.menu.active,this.menu.active&&this.initShopItems()}}const shop=new Shop;