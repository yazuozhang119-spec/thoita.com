const savedSlotAmount=localStorage.getItem("savedSlotAmount")??5;let petalReloadData={},petalHpData={},bosses=[];var totalBossHealth=0;let bossCount=0,augmentedBiomes=["trench"];function darkenColor(e,t){const o=parseInt(e.slice(1),16);return`rgb(${(o>>16&255)*t}, ${(o>>8&255)*t}, ${(255&o)*t})`}let disconnectedText,inventory=new Inventory(savedSlotAmount),deadMenu=new DeadMenu,mobileControls=new MobileControls,draggingPetalContainer=null,waveBarY=85,enemyBoxSize=75,enemyBoxBoundSize=80,enemyBoxOverlapSize=20,enemyBoxBaseX=0,enemyBoxBaseY=105;function waveLengthFunc(e){return e<10?e**.2*18.9287+30:60}function renderConnectingText(){connectingTextSizeMult*=1.003,connectingTextSizeMult>4.2&&(connectingTextSizeMult=1),ctx.font=`900 ${38*connectingTextSizeMult}px 'Ubuntu`,ctx.fillStyle="#f0f0f0",ctx.strokeStyle="black",ctx.lineWidth=6*connectingTextSizeMult,ctx.textAlign="center",ctx.textBaseline="middle",ctx.translate(canvas.w/2,canvas.h/2);const e=time;ctx.globalAlpha=1,ctx.rotate(.18*Math.sin(e/300)),ctx.strokeText("Connecting...",0,0),ctx.fillText("Connecting...",0,0),ctx.rotate(.18*-Math.sin(e/300)),ctx.translate(-canvas.w/2,-canvas.h/2)}function renderDisconnectedText(){if(ctx.font="900 46px Ubuntu",void 0===disconnectedText){disconnectedText={x:Math.random()*canvas.w,y:Math.random()*canvas.h};const e=Math.random()*Math.PI*2;disconnectedText.xv=3*Math.cos(e)*165/60,disconnectedText.yv=3*Math.sin(e)*165/60;const t=ctx.measureText("Disconnected");disconnectedText.w=t.width,disconnectedText.h=t.actualBoundingBoxAscent+t.actualBoundingBoxDescent}disconnectedText.x+=disconnectedText.xv,disconnectedText.y+=disconnectedText.yv,disconnectedText.x<0?(disconnectedText.x=0,disconnectedText.xv*=-1):disconnectedText.x+disconnectedText.w>canvas.w&&(disconnectedText.x=canvas.w-disconnectedText.w,disconnectedText.xv*=-1),disconnectedText.y<0?(disconnectedText.y=0,disconnectedText.yv*=-1):disconnectedText.y+disconnectedText.h>canvas.h&&(disconnectedText.y=canvas.h-disconnectedText.h,disconnectedText.yv*=-1),ctx.fillStyle="#f0f0f0",ctx.strokeStyle="black",ctx.lineWidth=5,ctx.textAlign="left",ctx.textBaseline="top",ctx.strokeText("Disconnected",disconnectedText.x,disconnectedText.y),ctx.fillText("Disconnected",disconnectedText.x,disconnectedText.y)}window.camera={x:"pass",y:0};let connectingTextSizeMult=1;window.cameraShake={intensity:0,duration:0,remaining:0},window.addCameraShake=(e,t)=>{window.cameraShake||(window.cameraShake={intensity:0,duration:0,remaining:0}),e>window.cameraShake.intensity&&(window.cameraShake.intensity=e,window.cameraShake.duration=t,window.cameraShake.remaining=t)};let _renderGame=e=>{if((null===window.selfId||void 0===room.flowers[window.selfId])&&!0!==window.isDead&&!0!==window.spectating){if("disconnected"===window.state&&"undefined"!=typeof biomeManager){const{ratio:e,last:t,current:o,direction:a}=biomeManager.getCurrentBiomeData();ctx.fillStyle=Colors.biomes[o].background,ctx.strokeStyle=Colors.biomes[o].grid}else room&&"undefined"!=typeof Colors?(room.biome||(room.biome="1v1"),ctx.fillStyle=Colors.biomes[room.biome].background,ctx.strokeStyle=Colors.biomes[room.biome].grid):(ctx.fillStyle="white",ctx.strokeStyle="#1c8c54");if(ctx.fillRect(0,0,canvas.w,canvas.h),!0!==window.noGrid){const e=-time/20%50;ctx.lineWidth=2,ctx.globalAlpha=.6;for(let t=e-ctx.lineWidth;t<=canvas.w+ctx.lineWidth;t+=tileSize)ctx.beginPath(),ctx.moveTo(t,0),ctx.lineTo(t,canvas.h),ctx.stroke(),ctx.closePath();for(let t=-e-ctx.lineWidth;t<=canvas.h+ctx.lineWidth;t+=tileSize)ctx.beginPath(),ctx.moveTo(0,t),ctx.lineTo(canvas.w,t),ctx.stroke(),ctx.closePath()}return ctx.globalAlpha=1,renderMenuEnemies(),void renderConnectingText()}if(menuEnemies=[],connectingTextSizeMult=1,ctx.fillStyle=Colors.biomes[room.biome].background,room&&null!=room.waveTimer&&augmentedBiomes.includes(room.biome)){const e=1-.8*Math.min(room.waveTimer/36e3,1);ctx.fillStyle=darkenColor(ctx.fillStyle,e),ctx.strokeStyle=darkenColor(ctx.strokeStyle,e)}ctx.fillRect(0,0,canvas.w,canvas.h);const t=window.isDead||null===window.selfId||void 0===room.flowers[window.selfId]||1==window.spectating?(()=>{let e=null,t=1e99;for(let o in room.flowers)o<t&&(t=o,e=room.flowers[o]);return null===e?{render:{headX:0,headY:0,x:0,y:0}}:e})():room.flowers[window.selfId];!0!==window.isDead&&0==window.spectating?t.updateInterpolate():(petalReloadData={},petalHpData={}),renderFov=interpolate(renderFov,fov,.04),window.camera={x:t.render.headX,y:t.render.headY-(!0===window.isDead?24/renderFov:0)};let o=0,a=0;if(window.cameraShake&&window.cameraShake.remaining>0)if(window.cameraShake.remaining-=e,window.cameraShake.remaining<=0)window.cameraShake.intensity=0,window.cameraShake.offsetX=0,window.cameraShake.offsetY=0;else{const e=window.cameraShake.remaining/window.cameraShake.duration,t=window.cameraShake.intensity*e;o=(Math.random()-.5)*t*2,a=(Math.random()-.5)*t*2,window.cameraShake.offsetX=o,window.cameraShake.offsetY=a}if(ctx.lineWidth=2*canvas.w+2*canvas.h,ctx.beginPath(),ctx.strokeStyle="black",ctx.globalAlpha=.08,ctx.arc(canvas.w/2-t.render.headX*renderFov,canvas.h/2-t.render.headY*renderFov,room.radius*renderFov+ctx.lineWidth/2,0,2*Math.PI),ctx.stroke(),ctx.closePath(),ctx.globalAlpha=1,!0!==window.noGrid){const e={x:(-t.render.headX+canvas.w/2/renderFov)%tileSize,y:(-t.render.headY+canvas.h/2/renderFov)%tileSize};if(ctx.strokeStyle=Colors.biomes[room.biome].grid,room&&null!=room.waveTimer&&augmentedBiomes.includes(room.biome)){const e=1-.8*Math.min(room.waveTimer/36e3,1);ctx.fillStyle=darkenColor(ctx.fillStyle,e),ctx.strokeStyle=darkenColor(ctx.strokeStyle,e)}ctx.lineWidth=renderFov,ctx.globalAlpha=1,ctx.beginPath();for(let t=(e.x-ctx.lineWidth)*renderFov;t<=canvas.w+ctx.lineWidth;t+=tileSize*renderFov)ctx.moveTo(t,0),ctx.lineTo(t,canvas.h);for(let t=(e.y-ctx.lineWidth)*renderFov;t<=canvas.h+ctx.lineWidth;t+=tileSize*renderFov)ctx.moveTo(0,t),ctx.lineTo(canvas.w,t);ctx.stroke(),ctx.closePath()}if(ctx.globalAlpha=1,"pass"!==window.camera.x&&ctx.translate(canvas.w/2-camera.x*renderFov+o,canvas.h/2-camera.y*renderFov+a),ctx.scale(renderFov,renderFov),void 0!==biomeManager&&"1v1"===biomeManager.getCurrentBiome()&&!0!==window.inMainPvpRoom&&(Object.keys(room.flowers).length>=2?window.canWinPvp=!0:1===Object.keys(room.flowers).length&&!0!==window.isDead&&window.canWinPvp&&(window.hasWonPvp=!0,delete window.canWinPvp)),!0===window.hasWonPvp){ctx.fillStyle="white",ctx.strokeStyle="black",ctx.globalAlpha=.3,ctx.textAlign="center",ctx.textBaseline="middle",ctx.lineWidth=1.55*room.radius/20,ctx.font=`600 ${1.55*room.radius}px Ubuntu`;const e=ctx.measureText("W"),t=(e.actualBoundingBoxDescent-e.actualBoundingBoxAscent)/2;ctx.fillText("W",0,-t),ctx.strokeText("W",0,-t),ctx.globalAlpha=1}window.Perf&&window.Perf.mark("draw_petalContainers");for(let e in room.petalContainers)room.petalContainers[e].draw();window.Perf&&window.Perf.end("draw_petalContainers"),window.Perf&&window.Perf.mark("draw_projectiles");for(let e in room.flowers)room.flowers[e].drawProjectiles();window.Perf&&window.Perf.end("draw_projectiles"),window.Perf&&window.Perf.mark("draw_pets");for(let e in room.flowers)room.flowers[e].drawPets();window.Perf&&window.Perf.end("draw_pets"),window.Perf&&window.Perf.mark("draw_enemies");for(let e in room.enemies)room.enemies[e].draw();window.Perf&&window.Perf.end("draw_enemies"),window.Perf&&window.Perf.mark("draw_flowers");for(let e in room.flowers)room.flowers[e].draw();if(window.Perf&&window.Perf.end("draw_flowers"),ctx.scale(1/renderFov,1/renderFov),"pass"!==window.camera.x){const e=window.cameraShake?.offsetX||0,t=window.cameraShake?.offsetY||0;ctx.translate(-(canvas.w/2-camera.x*renderFov+e),-(canvas.h/2-camera.y*renderFov+t))}if(ctx.globalAlpha=1,room.globalWeb>0&&(ctx.beginPath(),ctx.globalAlpha*=room.globalWeb/1800*.25,ctx.fillStyle="#2200ff",ctx.rect(0,0,canvas.w,canvas.h),ctx.fill(),ctx.globalAlpha/=room.globalWeb/1800*.25,ctx.closePath()),room&&null!=room.waveTimer&&augmentedBiomes.includes(room.biome)){let e=ctx.globalAlpha;const t=Math.min(room.waveTimer/36e3,1);ctx.globalAlpha=.4*t,ctx.fillStyle="#000000",ctx.rect(0,0,canvas.w,canvas.h),ctx.fill(),ctx.globalAlpha=e}ctx.translate(canvas.w/2,0);for(let e=0;e<room.enemyBoxes.length;e++){let t=room.enemyBoxes[e];if(t.update(),window.hiEnemyBoxRarities||(window.hiEnemyBoxRarities={}),window.hiEnemyBoxRarities[t.type]||(window.hiEnemyBoxRarities[t.type]=t.rarity),window.hiEnemyBoxRarities[t.type]=Math.max(window.hiEnemyBoxRarities[t.type],t.rarity),t.isBoss?ctx.strokeStyle=`hsl(${time/10%360}, 50%, 40%)`:(ctx.strokeStyle=Colors.rarities[t.rarity].border,1==window.hqp&&void 0!==Colors.rarities[t.rarity].fancy&&(ctx.strokeStyle=Colors.rarities[t.rarity].fancy.border)),t.isBoss)ctx.fillStyle=`hsl(${time/10%360}, 30%, 60%)`;else if(ctx.fillStyle=Colors.rarities[t.rarity].color,staticGradients[t.rarity+"_"]&&(ctx.fillStyle=staticGradients[t.rarity+"_"]),1==window.hqp&&void 0!==Colors.rarities[t.rarity].fancy&&1==window.hqp){let e;e=t.rarity<=23?ctx.createLinearGradient(t.x-t.w/2,t.y,t.x+t.w/2,t.y+t.h):t.rarity<=25?ctx.createLinearGradient(t.x+t.w/2,t.y+t.h,t.x-t.w/2,t.y):t.rarity<=29?ctx.createRadialGradient(t.x,t.y+t.h/2,0,t.x,t.y+t.h/2,t.w/2):ctx.createRadialGradient(t.x,t.y+t.h/2,t.w/2,t.x,t.y+t.h/2,0),createFancyGradient(e,t.rarity),ctx.fillStyle=e}let o=.92,a=(1-o)/2;if(ctx.translate(t.x-t.w/2+t.w*a,t.y+t.h*a),ctx.beginPath(),ctx.roundRect(0,0,t.w*o,t.h*o,2.5),ctx.fill(),ctx.closePath(),ctx.translate(-(t.x-t.w/2+t.w*a),-(t.y+t.h*a)),1==window.hqp&&!t.isBoss&&void 0!==Colors.rarities[t.rarity].fancy&&void 0!==Colors.rarities[t.rarity].fancy.stars&&1==window.hqp){if(ctx.save(),ctx.translate(t.x,t.y+t.h/2),ctx.scale(t.w/50,t.w/50),!t.stars){t.stars=[];for(let e=0;e<Colors.rarities[t.rarity].fancy.stars;e++)t.stars.push({x:50*Math.random()-25,y:50*Math.random()-25})}ctx.fillStyle="#ffffff";for(let e of t.stars)if(e.x+=.1,e.y+=.1,(e.x>30||e.y>30)&&(e.x=800*Math.random()-20-30,e.y=-30),!(e.x<-30||e.x>30||e.y<-30||e.y>30)){ctx.beginPath();var i=ctx.createRadialGradient(e.x,e.y,15,e.x,e.y,0);i.addColorStop(0,"transparent"),i.addColorStop(.8,`rgba(255,255,255,${.8*(Math.cos(Date.now()/600+e.x/30+e.y/30)+1)})`),i.addColorStop(1,"white"),ctx.fillStyle=i,ctx.globalAlpha=.3,ctx.fillRect(-20.5,-20.5,41,41),ctx.globalAlpha=1,e.x<20.5&&e.x>-20.5&&e.y<20.5&&e.y>-20.5&&(ctx.fillStyle="#fff",ctx.arc(e.x,e.y,1,0,2*Math.PI),ctx.fill()),ctx.closePath()}ctx.restore()}if(!cachedImages.enemies[`${t.type}`]){const e=new PetalContainer({},{x:0,y:0,w:1,h:1});e.type=t.type,e.generateEnemyImage()}if(ctx.beginPath(),ctx.roundRect(t.x-t.w/2+t.w*a,t.y+t.h*a,t.w*o,t.h*o,2.5),ctx.lineWidth=5.25,ctx.stroke(),ctx.closePath(),1==window.hqp&&(ctx.save(),ctx.beginPath(),ctx.globalAlpha=.5,ctx.roundRect(t.x-t.w/2+t.w*a-2.625,t.y+t.h*a-2.625,t.w*o+5.25,t.h*o+5.25,5),ctx.fill(),ctx.closePath(),ctx.restore()),t.image||(t.image=cachedImages.enemies[`${t.type}`]),t.image){t.imageScale||(t.imageScale=t.w*(82.5/t.w)/(1.15*t.image.width));let e=ctx.getTransform();ctx.translate(t.x,t.y+t.w/2),ctx.scale(t.imageScale,t.imageScale),ctx.drawImage(t.image,-t.image.width/2,-t.image.width/2),ctx.setTransform(e)}if(t.isBoss?ctx.strokeStyle=`hsl(${time/10%360}, 50%, 40%)`:(ctx.strokeStyle=Colors.rarities[t.rarity].border,void 0!==Colors.rarities[t.rarity].fancy&&(ctx.strokeStyle=Colors.rarities[t.rarity].fancy.border)),t.amount>1&&(time-t.lastAmountChangedTime<100&&(ctx.globalAlpha=smoothstep((time-t.lastAmountChangedTime)/100)),ctx.lineWidth=3,ctx.font="900 16px 'Ubuntu'",ctx.textAlign="right",ctx.textBaseline="middle",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.translate(t.x+t.w/2-7,t.y+18),ctx.rotate(.34),ctx.strokeText("x"+t.amount,0,0),ctx.fillText("x"+t.amount,0,0),ctx.rotate(-.34),ctx.translate(-(t.x+t.w/2-7),-(t.y+18)),ctx.globalAlpha=1),1==t.delete){let e=!1;for(let o=0;o<room.enemyBoxes.length;o++){let a=room.enemyBoxes[o];a.type==t.type&&a.rarity!=t.rarity&&(e=!0)}if(e)for(let e=0;e<room.enemyBoxes.length;e++){let o=room.enemyBoxes[e];o.type==t.type&&o.rarity>t.rarity&&(o.targetY-=enemyBoxOverlapSize)}else alignEnemyBoxes(t);window.hiEnemyBoxRarities={}}}ctx.translate(-canvas.w/2,0);for(let e of room.enemyBoxes){if(e.isBoss)continue;const t=mouse.x*canvas.w/window.innerWidth,o=mouse.y*canvas.h/window.innerHeight;mouseInBox({x:t,y:o},{x:e.x-e.w/2+canvas.w/2,y:e.y,w:e.w,h:e.rarity!==window.hiEnemyBoxRarities[e.type]?e.w/5:e.w})&&(e.ec||(e.ec=mobGallery.generateEnemyPc(e.type,e.rarity,1)),Stats.enemies[e.type]?(e.ec.isHovered=!0,e.ec.drawStatsBox(!0,!0,canvas.w/2+e.x,e.y+e.w/2+3*e.w/5)):calculateStats())}room.enemyBoxes=room.enemyBoxes.filter(e=>!e.delete);let n=void 0!==biomeManager&&"1v1"===biomeManager.getCurrentBiome()?"Fight!":"Wave "+room.wave;if(window.currentWeather){const e=window.currentWeather.displayName||window.currentWeather.name;e&&(n+=" - "+e)}if(augmentedBiomes.includes(room.biome)){let e=room.waveTimer/1800;n+=" • Depth: "+formatAmountHighPrecision(1e3*e)+"m",ctx.lineWidth=24,ctx.lineCap="round",ctx.strokeStyle="black",ctx.beginPath(),ctx.lineTo(canvas.w/2-140,waveBarY),ctx.lineTo(canvas.w/2+140,waveBarY),ctx.stroke()}else if(bosses.length>0){let e=0;for(let t of bosses)room.enemies[t.id]?e+=Math.max(Math.min(room.enemies[t.id].render.hp,room.enemies[t.id].maxHp),0):bosses=bosses.filter(e=>e.id!==t.id);let t=1,o=1,a="";const i=[{limit:1e3,first:1,second:1,suffix:""},{limit:1e4,first:10,second:100,suffix:"k"},{limit:1e5,first:100,second:10,suffix:"k"},{limit:1e6,first:1e3,second:1,suffix:"k"},{limit:1e7,first:1e4,second:100,suffix:"m"},{limit:1e8,first:1e5,second:10,suffix:"m"},{limit:1e9,first:1e6,second:1,suffix:"m"},{limit:1e10,first:1e7,second:100,suffix:"b"},{limit:1e11,first:1e8,second:10,suffix:"b"},{limit:1e12,first:1e9,second:1,suffix:"b"},{limit:1e13,first:1e10,second:100,suffix:"t"},{limit:1e14,first:1e11,second:10,suffix:"t"},{limit:1e15,first:1e12,second:1,suffix:"t"},{limit:1e16,first:1e13,second:100,suffix:"Qd"},{limit:1e17,first:1e14,second:10,suffix:"Qd"},{limit:1e18,first:1e15,second:1,suffix:"Qd"},{limit:1e19,first:1e16,second:100,suffix:"Qt"},{limit:1e20,first:1e17,second:10,suffix:"Qt"},{limit:1e21,first:1e18,second:1,suffix:"Qt"}];for(const e of i)if(totalBossHealth<e.limit){t=e.first,o=e.second,a=e.suffix;break}n+=" • "+Math.round(e/t)/o+a+"/"+Math.round(totalBossHealth/t)/o+a,ctx.lineWidth=24,ctx.lineCap="round",ctx.strokeStyle="black",ctx.beginPath(),ctx.lineTo(canvas.w/2-140,waveBarY),ctx.lineTo(canvas.w/2+140,waveBarY),ctx.stroke(),e>0&&(ctx.lineWidth=18,ctx.lineCap="round",ctx.strokeStyle="#75dd34",ctx.beginPath(),ctx.lineTo(canvas.w/2-140,waveBarY),ctx.lineTo(canvas.w/2-140+e/totalBossHealth*280,waveBarY),ctx.stroke())}else{let e=30*waveLengthFunc(room.wave);room.waveTimer<e?(ctx.lineWidth=24,ctx.lineCap="round",ctx.strokeStyle="black",ctx.beginPath(),ctx.lineTo(canvas.w/2-140,waveBarY),ctx.lineTo(canvas.w/2+140,waveBarY),ctx.stroke(),ctx.lineCap="round",ctx.lineWidth=18*Math.min(1,room.waveTimer/e*10),void 0!==biomeManager&&"1v1"===biomeManager.getCurrentBiome()||(room.shinyWave?ctx.strokeStyle=`hsl(${Date.now()/5%360}, 50%, 50%)`:ctx.strokeStyle=blendColor(Colors.biomes[room.biome].background,"#ffffff",.4),ctx.beginPath(),ctx.lineTo(canvas.w/2-140,waveBarY),ctx.lineTo(canvas.w/2-140+room.waveTimer/e*280,waveBarY),ctx.stroke())):(ctx.lineWidth=24,ctx.lineCap="round",ctx.strokeStyle="black",ctx.beginPath(),ctx.lineTo(canvas.w/2-140,waveBarY),ctx.lineTo(canvas.w/2+140,waveBarY),ctx.stroke(),void 0!==biomeManager&&"1v1"===biomeManager.getCurrentBiome()||(ctx.lineWidth=18,ctx.strokeStyle=blendColor(Colors.biomes[room.biome].background,"#ffffff",.4),ctx.beginPath(),ctx.lineTo(canvas.w/2-140,waveBarY),ctx.lineTo(canvas.w/2+140,waveBarY),ctx.stroke(),ctx.lineWidth=15.5*Math.min(1,(room.waveTimer-e)/e*10),ctx.globalAlpha=Math.min(room.waveTimer/e/1.5,1),ctx.strokeStyle="red",ctx.beginPath(),ctx.lineTo(canvas.w/2-140,waveBarY),ctx.lineTo(canvas.w/2-140+280*Math.min(1,(room.waveTimer-e)/(2*e)),waveBarY),ctx.stroke()),ctx.globalAlpha=1)}let r=!1;window.mania&&room.tick<window.mania.timeLimit&&(r=!0),r?1==window.mania.passed?(ctx.letterSpacing="1px",ctx.strokeStyle="black",ctx.fillStyle="#03fc49",ctx.lineWidth=6,ctx.font="900 37px 'Ubuntu'",ctx.textAlign="center",ctx.textBaseline="middle",ctx.strokeText("Mania • "+window.mania.message+" • Passed!",canvas.w/2,50),ctx.fillText("Mania • "+window.mania.message+" • Passed!",canvas.w/2,50)):(ctx.letterSpacing="1px",ctx.strokeStyle="black",ctx.fillStyle="#ed5c81",ctx.lineWidth=6,ctx.font="900 37px 'Ubuntu'",ctx.textAlign="center",ctx.textBaseline="middle",ctx.strokeText("Mania • "+window.mania.message+" • "+Math.round((window.mania.timeLimit-room.tick)/3)/10+"s",canvas.w/2,50),ctx.fillText("Mania • "+window.mania.message+" • "+Math.round((window.mania.timeLimit-room.tick)/3)/10+"s",canvas.w/2,50)):window.killTime?room.tick<window.killTime.timeLimit&&(ctx.letterSpacing="1px",ctx.strokeStyle="black",ctx.fillStyle="#e3365f",ctx.lineWidth=6,ctx.font="900 37px 'Ubuntu'",ctx.textAlign="center",ctx.textBaseline="middle",ctx.strokeText("Kill the boss within "+Math.floor((window.killTime.timeLimit-room.tick)/3)/10+" seconds or die!",canvas.w/2,50),ctx.fillText("Kill the boss within "+Math.floor((window.killTime.timeLimit-room.tick)/3)/10+" seconds or die!",canvas.w/2,50)):(ctx.letterSpacing="1px",ctx.strokeStyle="black",ctx.fillStyle="white",ctx.lineWidth=6,ctx.font="900 37px 'Ubuntu'",ctx.textAlign="center",ctx.textBaseline="middle",ctx.strokeText(room.biomeDisplay,canvas.w/2,50),ctx.fillText(room.biomeDisplay,canvas.w/2,50)),room.shinyWave?(ctx.fillStyle=`hsl(${Date.now()/5%360}, 60%, 80%)`,n=room.shinyWave>1?"Super ".repeat(room.shinyWave-1)+"Lucky "+n:"Lucky "+n):ctx.fillStyle="white",ctx.lineWidth=3,ctx.letterSpacing="0.5px",ctx.font="900 17px 'Ubuntu'",ctx.textAlign="center",ctx.textBaseline="top",ctx.strokeText(n,canvas.w/2,waveBarY-8),ctx.fillText(n,canvas.w/2,waveBarY-8),ctx.letterSpacing="0px",ctx.textBaseline="middle";let c=100,l=65,s=room.flowers[window.selfId],x=c;!s&&spectating&&(x-=90);for(let e in room.squadMembers){let t;if(room.flowers[e]&&!room.flowers[e].dead?t=room.flowers[e]:(t=room.squadMembers[e],t.render={hp:0,shield:0,beforeStreakHp:0},t.maxHp=100,t.drawFlower=Flower.drawDeadFlower),e==window.selfId&&!0!==spectating){let e=35;if(renderHpBar({x:l+4*e,y:c-3.6*e,radius:1.8*e,hp:t.render.hp,maxHp:t.maxHp,shield:t.render.shield,beforeStreakHp:t.render.beforeStreakHp,givenAlpha:1},t),t.drawFlower(l,c,e,t.character),ctx.font=`900 ${.75*e}px Ubuntu`,ctx.strokeStyle="black",ctx.fillStyle="white",ctx.textBaseline="middle",ctx.textAlign="center",ctx.strokeText(t.name,l+4*e,c),ctx.fillText(t.name,l+4*e,c),ctx.font=`900 ${.5*e}px Ubuntu`,ctx.strokeStyle="black",ctx.fillStyle="#aaaaaa",ctx.textBaseline="middle",ctx.textAlign="left",ctx.lineWidth=3,ctx.strokeText(t.username,l+e,c+.75*e),ctx.fillText(t.username,l+e,c+.75*e),t.mana){let o=0,a=0;for(let e in t.mana)t.mana[e]>0&&o++;for(let i in t.mana)if(t.mana[i]>0){let n=(6.5*e-.5*e*o)/o;ctx.lineWidth=.35*e,ctx.strokeStyle="#333333",ctx.beginPath(),ctx.moveTo(l+e+a*n+.5*e*a,c-.75*e),ctx.lineTo(l+e+(a+1)*n+.5*e*a,c-.75*e),ctx.stroke(),ctx.closePath(),ctx.lineWidth=.25*e,ctx.strokeStyle=Colors.mana[i],ctx.beginPath(),ctx.moveTo(l+e+a*n+.5*e*a,c-.75*e),ctx.lineTo(l+e+(a+t.mana[i]/t.maxMana[i])*n+.5*e*a,c-.75*e),ctx.stroke(),ctx.closePath(),a++}}}else if("1v1"!==room.biome){let o=30;if(x+=90,renderHpBar({x:l+4*o,y:x-3.6*o,radius:1.8*o,hp:t.render.hp,maxHp:t.maxHp,shield:t.render.shield,beforeStreakHp:t.render.beforeStreakHp,givenAlpha:1},t),t.drawFlower(l,x,o,t.character),ctx.font=`900 ${.75*o}px Ubuntu`,ctx.strokeStyle="black",ctx.fillStyle="white",ctx.textBaseline="middle",ctx.textAlign="center",ctx.strokeText(t.name,l+4*o,x),ctx.fillText(t.name,l+4*o,x),ctx.font=`900 ${.5*o}px Ubuntu`,ctx.strokeStyle="black",ctx.fillStyle="#aaaaaa",ctx.textBaseline="middle",ctx.textAlign="left",ctx.lineWidth=3,ctx.strokeText(t.username,l+o,x+.75*o),ctx.fillText(t.username,l+o,x+.75*o),ctx.lineWidth=1,s&&room.flowers[e]){ctx.lineWidth=o/7;let e=Math.atan2(t.render.headY-s.render.headY,t.render.headX-s.render.headX);ctx.translate(l,x),ctx.strokeStyle="black",ctx.fillStyle="white",ctx.rotate(e),ctx.beginPath(),ctx.lineTo(1.15*o,.4*-o),ctx.lineTo(1.45*o,0),ctx.lineTo(1.15*o,.4*o),ctx.lineTo(1.15*o,.4*-o),ctx.stroke(),ctx.fill(),ctx.rotate(-e),ctx.translate(-65,-x)}if(t.mana){let e=0,a=0;for(let o in t.mana)t.mana[o]>0&&e++;for(let i in t.mana)if(t.mana[i]>0){let n=(6.5*o-.5*o*e)/e;ctx.lineWidth=.35*o,ctx.strokeStyle="#333333",ctx.beginPath(),ctx.moveTo(l+o+a*n+.5*o*a,x-.75*o),ctx.lineTo(l+o+(a+1)*n+.5*o*a,x-.75*o),ctx.stroke(),ctx.closePath(),ctx.lineWidth=.25*o,ctx.strokeStyle=Colors.mana[i],ctx.beginPath(),ctx.moveTo(l+o+a*n+.5*o*a,x-.75*o),ctx.lineTo(l+o+(a+t.mana[i]/t.maxMana[i])*n+.5*o*a,x-.75*o),ctx.stroke(),ctx.closePath(),a++}}}}if(!0===globalInventory.fadingOut&&globalInventory.draw(),!0===mobGallery.fadingOut&&mobGallery.draw(),inventory.draw(),window.mobile&&mobileControls.draw(),levelBar.draw(),!0===window.isDead)window.deadMenuTime+=e,deadMenu.draw();else{if(window.deadMenuTime=0,"1v1"==room.biome){ctx.translate(canvas.w-320,20),ctx.fillStyle="#333333",ctx.strokeStyle="#292929",ctx.lineWidth=10,ctx.beginPath(),ctx.roundRect(0,0,300,430,2),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.fillStyle="#39b54a",ctx.strokeStyle="#2e933c",ctx.beginPath(),ctx.roundRect(0,0,300,50,2),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="900 25px 'Ubuntu'",ctx.lineWidth=4,ctx.fillStyle="#ffffff",ctx.strokeStyle="#000000",ctx.strokeText("Leaderboard",150,27),ctx.fillText("Leaderboard",150,27);for(let e=1;e<=11;e++)ctx.strokeStyle="#292929",ctx.lineWidth=25,ctx.beginPath(),ctx.moveTo(25,32.5*e+45),ctx.lineTo(275,32.5*e+45),ctx.stroke(),ctx.closePath();let e=0,t=0,o=[];for(let e in room.flowers)flower=room.flowers[e],o.push({username:flower.username,score:flower.score});o.sort((e,t)=>e.score>t.score?-1:e.score<t.score?1:void 0),o=o.slice(0,11);for(let a of o)t++,a.score>e&&(e=a.score),ctx.strokeStyle="#39b54a",a.score==e&&(ctx.strokeStyle="#dbd74b"),a.username==room.flowers[window.selfId].username&&(ctx.strokeStyle="#5a9fdb"),"ruby"==a.username&&(ctx.strokeStyle="#fa87b7"),"haha0201"==a.username&&(ctx.strokeStyle=`hsl(${236+68*Math.sin(Date.now()/1e3)}, 50%, 60%)`),"devdevd"==a.username&&(ctx.strokeStyle=`hsl(${130+110*Math.sin(Date.now()/1e3)}, 90%, 60%)`),ctx.lineWidth=17.5,ctx.beginPath(),ctx.moveTo(25,32.5*t+45),ctx.lineTo(25+a.score/e*250,32.5*t+45),ctx.stroke(),ctx.closePath(),ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="900 20px 'Ubuntu'",ctx.lineWidth=4,ctx.fillStyle="#ffffff",ctx.strokeStyle="#000000",ctx.strokeText(a.username+" - "+formatAmountHighPrecision(a.score),150,32.5*t+45),ctx.fillText(a.username+" - "+formatAmountHighPrecision(a.score),150,32.5*t+45);ctx.translate(320-canvas.w,-20)}window.spectating&&collectedMenu.draw()}let d=!1;if(d=mouse.canvasX>10&&55>mouse.canvasX&&mouse.canvasY>10&&55>mouse.canvasY,ctx.strokeStyle="#90464b",ctx.fillStyle=!0===d?"#c16666":"#c1565e",ctx.lineWidth=5,ctx.beginPath(),ctx.roundRect(10,10,45,45,6),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.lineWidth=7.5,ctx.lineCap="round",ctx.strokeStyle="#cccccc",ctx.beginPath(),ctx.moveTo(22.5,22.5),ctx.lineTo(42.5,42.5),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(42.5,22.5),ctx.lineTo(22.5,42.5),ctx.stroke(),ctx.closePath(),!0===d&&mouse.lastDownData.x>10&&55>mouse.lastDownData.x&&mouse.lastDownData.y>10&&55>mouse.lastDownData.y&&mouse.lastDownData.time>100&&(!window.lastLeaveGameTime||time-window.lastLeaveGameTime>500)&&(window.lastLeaveGameTime=time,send({leaveGame:!0,real:!0}),petalReloadData={},petalHpData={},d=!1),"undefined"!=typeof weatherUI&&weatherUI.renderEffects(ctx,canvas,time),"undefined"!=typeof weatherUI&&weatherUI.renderLightningStrike(ctx,canvas,time),window.scorchedUltimateEffects&&window.scorchedUltimateEffects.length>0){const e=performance.now();window.scorchedUltimateEffects=window.scorchedUltimateEffects.filter(t=>e-t.startTime<t.duration);for(const e of window.scorchedUltimateEffects){const t=room&&room.flowers&&room.flowers[e.playerId];if(!t)continue;const o=t.headX,a=t.headY;if(!isFinite(o)||!isFinite(a))continue;if(!window.camera)continue;const i=(o-window.camera.x)*renderFov+canvas.w/2,n=(a-window.camera.y)*renderFov+canvas.h/2,r=(time-e.startTime)/e.duration,c=1-r,l=3;for(let t=0;t<l;t++){const o=(r+.2*t)%1,a=o*e.maxRadius*renderFov,l=(1-o)*c*.6;ctx.beginPath(),ctx.arc(i,n,a,0,2*Math.PI),ctx.strokeStyle=`rgba(255, 150, 50, ${l})`,ctx.lineWidth=8*renderFov,ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.arc(i,n,.85*a,0,2*Math.PI),ctx.strokeStyle=`rgba(255, 200, 100, ${.8*l})`,ctx.lineWidth=4*renderFov,ctx.stroke(),ctx.closePath()}const s=50*renderFov*(1-r);if(s>0){const e=ctx.createRadialGradient(i,n,0,i,n,s);e.addColorStop(0,`rgba(255, 180, 50, ${.5*c})`),e.addColorStop(1,"rgba(255, 150, 50, 0)"),ctx.fillStyle=e,ctx.beginPath(),ctx.arc(i,n,s,0,2*Math.PI),ctx.fill(),ctx.closePath()}}}};function renderHitbox({x:e,y:t,radius:o,angle:a,rarity:i=0}){ctx.strokeStyle=Colors.rarities[i].color,ctx.lineWidth=.75/renderFov,ctx.beginPath(),ctx.arc(e,t,o,0,2*Math.PI),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(e+o*Math.cos(a),t+o*Math.sin(a)),ctx.stroke(),ctx.closePath()}let renderGame=function(e){window.Perf?(window.Perf.mark("renderGame"),_renderGame(e),window.Perf.end("renderGame")):_renderGame(e)};