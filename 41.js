class WeatherUI{constructor(){this.particles=[],this.lastParticleTime=0}update(){}renderEffects(t,e,r){const a=window.currentWeather;if(!a||!a.id)return;if(!room.flowers[window.selfId])return;e.w,e.h;switch(a.id){case"snow":this.renderSnow(t,e,r);break;case"rain":this.renderRain(t,e,r);break;case"fog":case"toxic_fog":this.renderFog(t,e,"toxic_fog"===a.id);break;case"fire":this.renderFireEffect(t,e,r);break;case"darkness":case"night":this.renderDarkness(t,e,"darkness"===a.id?.9:.5);break;case"sandstorm":this.renderSandstorm(t,e,r);break;case"thunderstorm":this.renderThunderstorm(t,e,r);break;case"frozen":this.renderFrozenEffect(t,e)}this.renderStunEffect(t,e,r)}renderSnow(t,e,r){if(r-this.lastParticleTime>100){for(let t=0;t<3;t++)this.particles.push({x:Math.random()*e.w,y:-10,vx:.5*(Math.random()-.5),vy:1+2*Math.random(),size:2+3*Math.random(),type:"snow"});this.lastParticleTime=r}t.fillStyle="rgba(255, 255, 255, 0.8)";for(let r=this.particles.length-1;r>=0;r--){const a=this.particles[r];"snow"===a.type&&(a.x+=a.vx,a.y+=a.vy,t.beginPath(),t.arc(a.x,a.y,a.size,0,2*Math.PI),t.fill(),a.y>e.h+10&&this.particles.splice(r,1))}}renderRain(t,e,r){if(r-this.lastParticleTime>50){for(let t=0;t<5;t++)this.particles.push({x:Math.random()*e.w,y:-10,vx:-1,vy:8+4*Math.random(),length:10+10*Math.random(),type:"rain"});this.lastParticleTime=r}t.strokeStyle="rgba(150, 200, 255, 0.6)",t.lineWidth=1;for(let r=this.particles.length-1;r>=0;r--){const a=this.particles[r];"rain"===a.type&&(a.x+=a.vx,a.y+=a.vy,t.beginPath(),t.moveTo(a.x,a.y),t.lineTo(a.x+2*a.vx,a.y+a.length),t.stroke(),a.y>e.h+20&&this.particles.splice(r,1))}}renderFog(t,e,r){const a=r?"rgba(100, 150, 50, 0.3)":"rgba(200, 200, 200, 0.4)",i=t.createRadialGradient(e.w/2,e.h/2,0,e.w/2,e.h/2,.7*e.w);i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(.5,a),i.addColorStop(1,a),t.fillStyle=i,t.fillRect(0,0,e.w,e.h),r&&(t.fillStyle="rgba(100, 200, 50, 0.1)",t.fillRect(0,0,e.w,e.h))}renderFireEffect(t,e,r){const a=.1+.05*Math.sin(r/200);t.strokeStyle=`rgba(255, ${Math.floor(100+50*Math.sin(r/100))}, 0, ${a})`,t.lineWidth=20,t.strokeRect(0,0,e.w,e.h),t.fillStyle=`rgba(255, 100, 0, ${.5*a})`,t.fillRect(0,0,e.w,e.h)}renderDarkness(t,e,r){const a=t.createRadialGradient(e.w/2,e.h/2,0,e.w/2,e.h/2,.4*e.w);a.addColorStop(0,"rgba(0, 0, 0, 0)"),a.addColorStop(.5,`rgba(0, 0, 0, ${.5*r})`),a.addColorStop(1,`rgba(0, 0, 0, ${r})`),t.fillStyle=a,t.fillRect(0,0,e.w,e.h)}renderSandstorm(t,e,r){if(r-this.lastParticleTime>30){for(let t=0;t<10;t++)this.particles.push({x:e.w+10,y:Math.random()*e.h,vx:-5-5*Math.random(),vy:2*(Math.random()-.5),size:1+2*Math.random(),type:"sand"});this.lastParticleTime=r}t.fillStyle="rgba(210, 180, 100, 0.6)";for(let e=this.particles.length-1;e>=0;e--){const r=this.particles[e];"sand"===r.type&&(r.x+=r.vx,r.y+=r.vy,t.beginPath(),t.arc(r.x,r.y,r.size,0,2*Math.PI),t.fill(),r.x<-10&&this.particles.splice(e,1))}t.fillStyle="rgba(210, 180, 100, 0.15)",t.fillRect(0,0,e.w,e.h)}renderThunderstorm(t,e,r){Math.random()<.005&&(t.fillStyle="rgba(255, 255, 255, 0.8)",t.fillRect(0,0,e.w,e.h),setTimeout(()=>{},50)),this.renderRain(t,e,r),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,e.w,e.h)}renderFrozenEffect(t,e){t.fillStyle="rgba(150, 200, 255, 0.2)",t.fillRect(0,0,e.w,e.h),t.strokeStyle="rgba(200, 230, 255, 0.5)",t.lineWidth=10,t.strokeRect(0,0,e.w,e.h)}renderLightningStrike(t,e,r){if(window.thunderstormEffects&&0!==window.thunderstormEffects.length&&window.camera){window.thunderstormEffects=window.thunderstormEffects.filter(t=>r<t.startTime+t.duration);for(const a of window.thunderstormEffects){const i=r-a.strikeTime,o=(a.x-window.camera.x)*renderFov+e.w/2,n=(a.y-window.camera.y)*renderFov+e.h/2;if(i<200){const r=1-i/200;t.fillStyle=`rgba(255, 255, 255, ${.8*r})`,t.fillRect(0,0,e.w,e.h),this.drawLightningBolt(t,o,n-800,o,n,r)}else if(i<500){const e=(500-i)/300;this.drawLightningBolt(t,o,n-800,o,n,e);const r=t.createRadialGradient(o,n,0,o,n,100);r.addColorStop(0,`rgba(200, 220, 255, ${.8*e})`),r.addColorStop(.5,`rgba(100, 150, 255, ${.3*e})`),r.addColorStop(1,"rgba(100, 150, 255, 0)"),t.fillStyle=r,t.fillRect(o-100,n-100,200,200)}else if(i<a.duration){const e=.3*Math.random()*(1-i/a.duration);e>.05&&this.drawLightningBolt(t,o,n-400,o,n,.5*e);const r=(a.duration-i)/(a.duration-500)*.3,s=t.createRadialGradient(o,n,0,o,n,60);s.addColorStop(0,`rgba(150, 180, 255, ${r})`),s.addColorStop(1,"rgba(150, 180, 255, 0)"),t.fillStyle=s,t.fillRect(o-60,n-60,120,120)}}}}drawLightningBolt(t,e,r,a,i,o){t.save(),t.strokeStyle=`rgba(200, 220, 255, ${o})`,t.lineWidth=3,t.shadowColor="#00ffff",t.shadowBlur=15,t.lineCap="round",t.lineJoin="round";const n=[{x:e,y:r}];for(let t=1;t<8;t++){const o=t/8,s=e+(a-e)*o+40*(Math.random()-.5),l=r+(i-r)*o;n.push({x:s,y:l})}n.push({x:a,y:i}),t.beginPath(),t.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.stroke(),t.strokeStyle=`rgba(150, 200, 255, ${.6*o})`,t.lineWidth=1.5;for(let o=2;o<n.length-2;o++){if(Math.random()>.5)continue;const s=30+50*Math.random(),l=Math.atan2(i-r,a-e)+(Math.random()-.5)*Math.PI*.8;t.beginPath(),t.moveTo(n[o].x,n[o].y),t.lineTo(n[o].x+Math.cos(l)*s,n[o].y+Math.sin(l)*s),t.stroke()}t.restore()}renderStunEffect(t,e,r){if(window.stunEffects&&0!==window.stunEffects.length&&window.camera){window.stunEffects=window.stunEffects.filter(t=>r<t.startTime+t.duration);for(const a of window.stunEffects){const i=r-a.startTime,o=(a.x-window.camera.x)*renderFov+e.w/2,n=(a.y-window.camera.y)*renderFov+e.h/2;let s;s=i<500?i/500:1-(i-500)/(a.duration-500),s=Math.max(0,Math.min(1,s)),this.drawElectricCircle(t,o,n,50,s,i)}}}drawElectricCircle(t,e,r,a,i,o){t.save();const n=Math.PI/3;for(let s=0;s<6;s++){const l=s/6*Math.PI*2+.003*o,d=.3*Math.random();t.strokeStyle=`rgba(255, 255, 0, ${i*(.7+d)})`,t.lineWidth=3,t.shadowColor="#ffff00",t.shadowBlur=15,t.lineCap="round",t.beginPath();const h=10;for(let i=0;i<=h;i++){const o=l+i/h*n,s=a+10*(Math.random()-.5),d=e+Math.cos(o)*s,c=r+Math.sin(o)*s;0===i?t.moveTo(d,c):t.lineTo(d,c)}t.stroke()}t.restore()}clearParticles(){this.particles=[]}}const weatherUI=new WeatherUI;