class Room{constructor(){this.flowers={},this.squadMembers={},this.enemies={},this.petalContainers={},this.wave=1,this.waveTimer=0,this.tick=0,this.enemyBoxes=[],this.radius=500,this._syncInProgress=!1,this._lastSyncTime=0,this._syncCooldown=3e3,this.compassGlowCache={},this.biome="garden",this.biomeDisplay=this.biome[0].toUpperCase()+this.biome.slice(1),"1v1"===this.biomeDisplay&&!0===window.inMainPvpRoom&&(this.biomeDisplay="Arena")}processInit(e){try{this.flowers={},this.squadMembers={},this.enemies={},this.petalContainers={},this.radius=e.radius,this.wave=e.wave,this.waveTimer=e.waveTimer,this.biome=e.biome,this.shinyWave=e.shinyWave,this.biomeDisplay=this.biome[0].toUpperCase()+this.biome.slice(1),this.globalWeb=e.globalWeb,this.tick=e.tick,"1v1"===this.biomeDisplay&&!0===window.inMainPvpRoom&&(this.biomeDisplay="Arena");let s=0,t=[];for(let i in e.flowers){const n=e.flowers[i],o=n.id;if(t.push(o),this.flowers[o]){if(n.hp>0){const e=this.flowers[o];e.hp=n.hp,e.maxHp=n.maxHp,e.shield=n.shield||0,e.headX=n.x,e.headY=n.y,e.radius=n.radius;const s=n.petals?n.petals.length:0;if(e.petals.length!==s){e.petals=[];for(let t=0;t<s;t++)e.petals.push(new Petal(n.petals[t]))}const t=n.projectiles?n.projectiles.length:0;e.projectiles.length!==t&&(e.projectiles=new Array(t).fill(null));const i=n.pets?n.pets.length:0;if(e.pets.length!==i){e.pets=[];for(let s=0;s<i;s++)e.pets.push(new Enemy(n.pets[s]))}}}else n.hp>0?(this.flowers[o]=new Flower(o),this.flowers[o].init(n),s++,this.squadMembers[o]={isDead:!1,name:this.flowers[o].name,username:this.flowers[o].username}):this.squadMembers[o]={isDead:!0,name:n.name,username:n.username,dev:n.username}}}catch(e){}try{for(let s in e.enemies){if(e.enemies[s].isBoss){let t=!0;"Leech"!=e.enemies[s].type&&"BudLeech"!=e.enemies[s].type&&"Electric Eel"!=e.enemies[s].type&&"Dark Electric Eel"!=e.enemies[s].type&&"Shiny Electric Eel"!=e.enemies[s].type||e.enemies[s].isHead||(t=!1),t&&(bosses.push({id:e.enemies[s].id,maxHp:e.enemies[s].maxHp}),totalBossHealth+=e.enemies[s].maxHp,bossCount+=1)}const t=e.enemies[s].id;this.enemies[t]=new Enemy(e.enemies[s]);let i=!(noEnemyBox.includes(e.enemies[s].type)||e.enemies[s].type.includes("Missile"));"Leech"!=e.enemies[s].type&&"BudLeech"!=e.enemies[s].type&&"Electric Eel"!=e.enemies[s].type&&"Dark Electric Eel"!=e.enemies[s].type&&"Shiny Electric Eel"!=e.enemies[s].type||e.enemies[s].isHead||(i=!1),"1v1"===room.biome&&1==!e.enemies[s].boss&&e.enemies[s].rarity<6&&(i=!1),i&&createEnemyBox(e.enemies[s],this)}}catch(e){}}processBiomeChange(e){this.biome=e,this.biomeDisplay=this.biome[0].toUpperCase()+this.biome.slice(1),"deepzoo"==this.biome&&(this.biomeDisplay="Deep Zoo")}processUpdate(e){let s;if(window.Perf&&window.Perf.mark("processUpdate"),this.waveTimer=e[1],this.globalWeb=e[2],this.tick=e[3],e.length>4&&.5!==e[4]&&(!this.flowers||0===Object.keys(this.flowers).length))return this.requestStateSync(),void(window.Perf&&window.Perf.end("processUpdate"));if(!this.flowers||0===Object.keys(this.flowers).length)return void(window.Perf&&window.Perf.end("processUpdate"));window.Perf&&window.Perf.mark("updateFlowers");let t=4;for(;t<e.length;){if(.5===e[t]){s=t+1;break}if(void 0===this.flowers[e[t]]){this.requestStateSync();break}{this.flowers[e[t]].update(e,t);const s=this.flowers[e[t]];t+=flowerPackKeys.length+s.petals.length+2*s.projectiles.length+s.pets.length*enemyPackKeys.length}}function i(){var e=["4160058CQlVek","133518qHvwzm","410QdgIBB","120fxqdJf","8qXiIht","8nEQaRW","15112RtbqAT","34913jTssKU","10224351xvcJYS","1457868XehmVB","5530868cdWZZD"];return(i=function(){return e})()}function n(e,s){var t=i();return(n=function(e){return t[e-=428]})(e,s)}function o(e,s){var t=r();return o=function(s,i){var n=t[s-=407];void 0===o.Mahzct&&(o.srnxET=function(e){for(var s,t,i="",n="",o=0,r=0;t=e.charAt(r++);~t&&(s=o%4?64*s+t:t,o++%4)?i+=String.fromCharCode(255&s>>(-2*o&6)):0)t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(t);for(var a=0,l=i.length;a<l;a++)n+="%"+("00"+i.charCodeAt(a).toString(16)).slice(-2);return decodeURIComponent(n)},e=arguments,o.Mahzct=!0);var r=s+t[0],a=e[r];return a?n=a:(n=o.srnxET(n),e[r]=n),n},o(e,s)}function r(){var e=["mteYnZG2m09UqLjKyG","mJi2mZvjzunPAwq","nJK4ngf0EMjvyW","mJe1nhfLB0njrq","mJe3odK1ohjoBLnRDG","mtu4mJmZoe5bs051Ca","mta2mZG3odjVtgTdwxe","mJvcv0r2tuq","mtiZmNb6D2fVvq","mtbnyvfvBhO","nZu4nJq1A0zlsu5e"];return(r=function(){return e})()}window.Perf&&window.Perf.end("updateFlowers"),function(e){for(var s=o,t=e();;)try{if(883128==parseInt(s(414))/1+parseInt(s(408))/2+-parseInt(s(407))/3*(parseInt(s(417))/4)+-parseInt(s(411))/5*(-parseInt(s(409))/6)+-parseInt(s(410))/7+parseInt(s(412))/8*(parseInt(s(416))/9)+-parseInt(s(413))/10*(-parseInt(s(415))/11))break;t.push(t.shift())}catch(e){t.push(t.shift())}}(r),function(e){for(var s=n,t=e();;)try{if(589454==parseInt(s(436))/1*(parseInt(s(434))/2)+-parseInt(s(438))/3+parseInt(s(435))/4*(parseInt(s(432))/5)+parseInt(s(429))/6+parseInt(s(428))/7+-parseInt(s(433))/8*(parseInt(s(437))/9)+-parseInt(s(431))/10*(-parseInt(s(430))/11))break;t.push(t.shift())}catch(e){t.push(t.shift())}}(i),Math.random()<.01&&ws.onclose.toString().includes("SuperReload()")&&send({imput2:!0}),void 0===s&&this.requestStateSync(),window.Perf&&window.Perf.mark("updateEnemies");for(let t=s;t<e.length;t+=enemyPackKeys.length){const s=e[t];void 0!==this.enemies[s]&&this.enemies[s].update(e,t)}window.Perf&&window.Perf.end("updateEnemies"),window.Perf&&window.Perf.end("processUpdate")}updateWave(e){this.wave=e.wave,void 0!==e.waveTimer&&(this.waveTimer=e.waveTimer),this.radius=e.roomRadius,this.shinyWave=e.shinyWave}addNewEnemy(e){this.enemies[e.id]=new Enemy(e);let s=!(noEnemyBox.includes(e.type)||e.type.includes("Missile"));return"Leech"!=e.type&&"BudLeech"!=e.type&&"Electric Eel"!=e.type&&"Dark Electric Eel"!=e.type&&"Shiny Electric Eel"!=e.type||e.isHead||(s=!1),"1v1"===room.biome&&1==!e.boss&&e.rarity<6&&(s=!1),s&&!0!==window.isEditor&&createEnemyBox(e,this),!0===window.isEditor||e.isBoss||addDiscoveredEnemy(this.enemies[e.id].customType??this.enemies[e.id].type,this.enemies[e.id].rarity),this.enemies[e.id]}addNewFlower(e){this.squadMembers||(this.squadMembers={}),this.flowers[e.id]=new Flower(e.id),this.flowers[e.id].init(e);const s=this.squadMembers[e.id];return this.squadMembers[e.id]={isDead:s?.isDead||!1,name:this.flowers[e.id].name,username:this.flowers[e.id].username},this.flowers[e.id]}addNewPetalContainer(e){try{const s=new PetalContainer([new Petal(e.petal)],{x:e.x,y:e.y,w:e.w,h:e.h,originalX:e.originalX,originalY:e.originalY,radius:e.radius,toOscillate:!0},e.id,e.amount??1);this.petalContainers[e.id]=s}catch(e){}}collectPetalContainer(e,s=!1,t){if(void 0!==this.petalContainers[e])if(!1===s&&performance.now()-this.petalContainers[e].creationTime<360)setTimeout(()=>{this.collectPetalContainer(e,!0)},360-(performance.now()-this.petalContainers[e].creationTime));else{if(!0!==window.isEditor){let s=this.petalContainers[e].amount??1;t&&(s*=2),collectedMenu.addPetalContainer(new PetalContainer(this.petalContainers[e].petals,{...this.petalContainers[e],toOscillate:!1},Math.random(),s))}this.petalContainers[e].collectTime=performance.now(),null!=room.flowers[window.selfId]&&(this.petalContainers[e].x=room.flowers[window.selfId].render.x,this.petalContainers[e].y=room.flowers[window.selfId].render.y),setTimeout(()=>{delete this.petalContainers[e]},200)}}collectAllPetalContainers(){for(let e in this.petalContainers)this.collectPetalContainer(e)}removePetalContainer(e){this.petalContainers[e].collectTime=performance.now(),setTimeout(()=>{delete this.petalContainers[e]},200)}disconnectFlower(e){delete this.squadMembers[e],delete this.flowers[e],e==window.selfId&&(window.isDead=!0)}deadFlower(e,s){this.squadMembers[e].isDead=!0,this.squadMembers[e].name=this.flowers[e].name,this.squadMembers[e].dev=this.flowers[e].dev,delete this.flowers[e],e==window.selfId&&(window.lastHitBy=s,window.isDead=!0,window.state="dead")}removeEnemy(e){room.enemies[e].dead=!0;let s=!(noEnemyBox.includes(room.enemies[e].type)||room.enemies[e].type.includes("Missile"));if("Leech"!=room.enemies[e].type&&"BudLeech"!=room.enemies[e].type&&"Electric Eel"!=room.enemies[e].type&&"Dark Electric Eel"!=room.enemies[e].type&&"Shiny Electric Eel"!=room.enemies[e].type||room.enemies[e].isHead||(s=!1),s){let s=room.enemies[e],t=!1,i=!0,n=null,o=s.rarity;s.isBoss&&(o+=125);for(let e of this.enemyBoxes)e.type==(s.customType??s.type)&&e.rarity==o?(e.amount--,e.lastAmountChangedTime=performance.now(),n=e,e.amount<=0&&(i=!1)):e.type==(s.customType??s.type)&&(t=!0);0==i&&(n.toDelete=!0,0==t?(n.targetW=0,n.targetH=0):(n.targetH=0,n.targetW=0))}}changePlayerPetals(e,s){const t=this.flowers[e];if(t)if(Array.isArray(s)){const i={},n=["Compass","Dark Compass","Waterlogged Compass","Waterlogged Dark Compass"];for(let e=0;e<t.petals.length;e++)n.includes(t.petals[e].type)&&void 0!==t.petals[e].glow&&(i[e]=t.petals[e].glow);t.petals=s.map(e=>new Petal(e));const o=this.compassGlowCache[e]||{};for(let s=0;s<t.petals.length;s++)if(n.includes(t.petals[s].type)){const n=void 0!==i[s]?i[s]:o[s];void 0!==n&&(t.petals[s].glow=n,this.compassGlowCache[e]||(this.compassGlowCache[e]={}),this.compassGlowCache[e][s]=n)}}else{const i=t.petals.find(e=>e.id===s.id);if(i){const n=i.dv,o=!0===i.dead&&!1===s.dead?void 0:i.distance;for(let e in s)i[e]=s[e];i.dv=n,void 0!==o&&(i.distance=o);const r=t.petals.indexOf(i);-1!==r&&["Compass","Dark Compass","Waterlogged Compass","Waterlogged Dark Compass"].includes(i.type)&&this.compassGlowCache[e]&&void 0!==this.compassGlowCache[e][r]&&(i.glow=this.compassGlowCache[e][r])}else{const i=new Petal(s);if(["Compass","Dark Compass","Waterlogged Compass","Waterlogged Dark Compass"].includes(i.type)){const s=t.petals.length;this.compassGlowCache[e]&&void 0!==this.compassGlowCache[e][s]&&(i.glow=this.compassGlowCache[e][s])}t.petals.push(i)}}}swapPlayerPetals(e,s,t,i,n){const o=this.flowers[e];for(let e=0;e<o.petals.length;e++)!0===s.includes(e)&&(o.petals[e].toRemove=!0);if(o.petals=o.petals.filter(e=>!0!==e.toRemove),void 0!==t){for(let e=0;e<i.length;e++)i[e].isSwappedPetal=!0;this.flowers[e].petals.splice(t,0,...i.map(e=>new Petal(e)))}for(let e=0;e<o.petals.length;e++)o.petals[e].angleOffset=n[e],o.petals[e].id=e}addProjectile(e,s,t,i){const n=this.flowers[t].projectiles[e]=new Petal(s),o=this.flowers[t].petals[s.id];n.isProjectile=!0,"WebProjectileWeb"!=n.type&&o&&(n.render.x=o.render.x,n.render.y=o.render.y),void 0!==i&&(n.selfAngle=i),n.render.selfAngle=n.selfAngle,o&&(n.selfAngle=o.selfAngle,o.shotFlag=!0)}addPet(e,s,t){this.flowers[t].pets[e]=new Enemy(s)}removeProjectile(e,s){if(!this.flowers[s])return;const t=this.flowers[s].projectiles;if(!t||void 0===t[e])return;const i=t[e];t[e]=null,i.update({dead:!0},this.flowers[s]),this.flowers[s].deadProjectiles.push(i)}removePet(e,s){const t=this.flowers[s].pets.splice(e,1)[0];t.dead=!0,this.flowers[s].deadPets.push(t)}requestStateSync(){const e=Date.now();this._syncInProgress||e-this._lastSyncTime<this._syncCooldown||(this._syncInProgress=!0,this._lastSyncTime=e,send({requestStateSync:!0,reconnectId:window.reconnectId}),setTimeout(()=>{this._syncInProgress=!1},5e3))}checkStateConsistency(){for(const[e,s]of Object.entries(this.squadMembers)){const t=!!this.flowers[e];if(s.isDead&&t)return this.requestStateSync(),!0}for(const e of Object.keys(this.flowers))if(!this.squadMembers[e])return this.requestStateSync(),!0;return!1}}