const numberOfRarities=35;class GlobalInventory{constructor(){this.icon=new Image,"https://flowrclient.serum0017.repl.co"===location.origin?this.icon.src="https://flowr.fun/gfx/youdontownthisiconzert.png":this.icon.src="gfx/youdontownthisiconzert.png",this.hoveringOverButton=!1,this.hoveringOverX=!1,this.menuActive=!1,this.petalContainers={},this.w=445,this.h=665,this.scroll=5,this.render={scroll:this.scroll},this.menuHeights={beginning:0,end:this.h},this.scrollbar={top:0,bottom:0,renderTop:0,renderBottom:0,length:150};const t=canvas.h-this.h-20+.5*this.scrollbar.length+60;canvas.h,this.scrollbar.length;this.scrollbar.top=this.scrollbar.bottom=t+this.scrollbar.length,this.scrollbar.renderBottom=this.scrollbar.bottom,this.scrollbar.renderTop=this.scrollbar.top,this.draggingScrollBar=!1,this.totalPetalHeight=0,this.hoveringOverScrollbar=!1,this.scrollBarActive=!1,this.currentSearchTerm=void 0,this.textBoxActive=!1}resizeScroll(){if(void 0!==this.resizeFlag)return;const t=canvas.h-this.h-20+.5*this.scrollbar.length+60;canvas.h,this.scrollbar.length;this.scrollbar.top=this.scrollbar.bottom=t+this.scrollbar.length,this.resizeFlag=!0}drawIcon(t=1){1!==t&&(ctx.globalAlpha=t),ctx.fillStyle="#5a9fdb",ctx.strokeStyle="#4981b1",mouse.canvasX+6>20&&mouse.canvasY+6>canvas.h-20-80-100-100&&mouse.canvasX-6<100&&mouse.canvasY-6<canvas.h-20-80+80-100-100?(ctx.fillStyle="#6aa8df",setCursor("pointer"),this.hoveringOverButton=!0):this.hoveringOverButton=!1,ctx.lineWidth=6,ctx.beginPath(),ctx.roundRect(20,canvas.h-20-80-100-100,80,80,3),ctx.fill(),ctx.stroke(),ctx.closePath(),this.icon.complete&&this.icon.naturalWidth>0?ctx.drawImage(this.icon,35,canvas.h-20-80+15-100-100,50,50):(ctx.font="900 30px Ubuntu",ctx.fillStyle="#ffffff",ctx.strokeStyle="#000000",ctx.lineWidth=2,ctx.textAlign="center",ctx.textBaseline="middle",ctx.strokeText("ðŸŽ’",60,canvas.h-20-40-100-100),ctx.fillText("ðŸŽ’",60,canvas.h-20-40-100-100)),ctx.fillStyle="#f0f0f0",ctx.strokeStyle="black",ctx.lineWidth=2.25,ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="900 14px Ubuntu";const e=ctx.letterSpacing;ctx.letterSpacing="0px",ctx.strokeText("[X]",82.5,canvas.h-20-80+15-100-100),ctx.fillText("[X]",82.5,canvas.h-20-80+15-100-100),ctx.letterSpacing=e,ctx.globalAlpha=1}draw(){let t=!0===this.fadingOut?1-(time-this.originalFadeOutTime)/100:1;!0===this.menuActive||time-this.lastCloseTime<140?this.drawInventory(t):this.hoveringOverX=!1}fadeOut(){this.fadingOut=!0,this.originalFadeOutTime=time,setTimeout(()=>{delete this.fadingOut,!0===this.menuActive&&this.toggleMenu()},100)}initInventory(t){this.petalContainers={},craftingMenu.petalContainers={},craftingMenu.fillerPetalSlots={},craftingMenu.recalculateTypeIndexes();for(let e=0;e<t.length;e++){const{x:i,y:n,w:a,h:r,originalX:s,originalY:l,radius:o}=t[e];"Token"===t[e].petal.type&&0===t[e].rarity&&(shop.tokens+=t[e].petalAmount),this.addPetalContainer(new PetalContainer(Array(t[e].petalAmount).fill(new Petal(t[e].petal)),{x:i,y:n,w:65,h:65,originalX:s,originalY:l,radius:o,toOscillate:!1,petalStats:t[e].petalStats,customBiome:t[e].customBiome},t[e].id,t[e].petalAmount,t[e].attempt),!1,!1)}for(let t in this.petalContainers)t>maxRarityObtained&&(maxRarityObtained=parseInt(t)),this.petalContainers[t].sort((t,e)=>{let i=t.type,n=e.type;return petalOverrides[t.type]?.[0]?.customName&&(i=petalOverrides[t.type][0].customName),petalOverrides[e.type]?.[0]?.customName&&(n=petalOverrides[e.type][0].customName),i.localeCompare(n)})}addPetalContainer(t,e=!1,i=!0){if(!showCommunityBiomes&&!petalRenderMap[t.type])return;if(isSpecialPetal(t))return void specialGlobalInventory.addPetalContainer(t,e,i);let n=t.rarity;"Shattered Relic of Wrath"!==t.type&&"Reinforced Relic of Wrath"!==t.type&&"Subset Relic of the Guardian"!==t.type&&"Division Relic of the Guardian"!==t.type&&"Guard Relic of the Guardian"!==t.type&&"Knight Relic of the Guardian"!==t.type&&"Aid Relic of Serenity"!==t.type&&"Subliminal Relic of Serenity"!==t.type&&"Barrier Relic of Serenity"!==t.type&&"Token"!==t.type||0!=t.rarity||(n="Unique"),craftingMenu.addPetalContainer(new PetalContainer(t.petals,{...t},t.id,t.amount,t.attempt)),void 0===this.petalContainers[n]&&(this.petalContainers[n]=[]);let a=this.petalContainers[n].find(e=>e.type===t.type);if(void 0!==a)return a.amount+=t.amount,void(a.lastAmountChangedTime=time);t.w=62,t.h=62,this.petalContainers[n].unshift(t),i&&this.petalContainers[n].sort((t,e)=>{let i=t.type,n=e.type;return petalOverrides[t.type]?.[0]?.customName&&(i=petalOverrides[t.type][0].customName),petalOverrides[e.type]?.[0]?.customName&&(n=petalOverrides[e.type][0].customName),i.localeCompare(n)})}removeByRarityAndType(t,e){if(void 0!==this.petalContainers[t]?.length){for(let i=0;i<this.petalContainers[t].length;i++)if(this.petalContainers[t][i].type===e)return this.removePetalContainer(t,i),!0;return!1}}ReturnRarityAndType(t,e){if(void 0===this.petalContainers[t]?.length)return!1;for(let i=0;i<this.petalContainers[t].length;i++)if(this.petalContainers[t][i].type===e)return this.petalContainers[t][i];return!1}removeByRarityAndTypeAndReturn(t,e){if(void 0===this.petalContainers[t]?.length)return!1;for(let i=0;i<this.petalContainers[t].length;i++)if(this.petalContainers[t][i].type===e)return this.removePetalContainer(t,i);return!1}removePetalContainer(t,e){const i=this.petalContainers[t][e];return isSpecialPetal(i)||craftingMenu.removePetalContainer(i.type,i.rarity),i.amount>=2?(i.amount--,i.lastAmountChangedTime=time):this.petalContainers[t].splice(e,1),i}removePetalContainerAmount(t,e,i){const n=this.petalContainers[t][e];n.amount>=i+1?(n.amount-=i,n.lastAmountChangedTime=time):this.petalContainers[t].splice(e,1),craftingMenu.removePetalContainerAmount(n.type,n.rarity,i)}mouseDown({mouseX:t,mouseY:e},i){this.removeDraggingAnim&&(clearTimeout(this.removeDraggingAnim),draggingPetalContainer=null,delete this.removeDraggingAnim);for(let i in this.petalContainers)if(void 0!==this.petalContainers[i])for(let n=0;n<this.petalContainers[i].length;n++){const a=this.petalContainers[i][n];if(!this.filteredOutBySearch(a)&&(!0!==a.greyed&&t>130+a.x-a.w/2&&t<130+a.x+a.w/2&&e>canvas.h-this.h-20+a.y-a.h/2&&e<canvas.h-this.h-20+a.y+a.h/2)){const a=this.removePetalContainer(i,n);draggingPetalContainer=new PetalContainer(a.petals,{...a,isDragging:!0},Math.random(),1),draggingPetalContainer.x+=130,draggingPetalContainer.render.x+=130,draggingPetalContainer.y+=canvas.h-this.h-20,draggingPetalContainer.render.y+=canvas.h-this.h-20,draggingPetalContainer.amount=1,draggingPetalContainer.mouseOffset={x:draggingPetalContainer.x-t,y:draggingPetalContainer.y-e},draggingPetalContainer.w=85,draggingPetalContainer.h=85}}t<this.w-16+12+130&&t>this.w-16-12+130&&e>this.scrollbar.bottom&&e<this.scrollbar.top&&(this.draggingScrollBar=!0),mouse.canvasX=t,mouse.canvasY=e,this.mouseInTextBox()?(this.textBoxActive=!0,setTimeout(()=>petalSearch.focus(),10)):this.textBoxActive=!1}handleIOSMouseDown(t,e){mouse.canvasX=t,mouse.canvasY=e,this.mouseInTextBox()?(this.textBoxActive=!0,petalSearch.focus()):this.textBoxActive=!1}mouseUp({mouseX:t,mouseY:e},i,n=!1){if(this.draggingScrollBar=!1,this.removeDraggingAnim&&(clearTimeout(this.removeDraggingAnim),draggingPetalContainer=null,delete this.removeDraggingAnim),null!==draggingPetalContainer){if(!1===n&&time-mouse.lastDownData.time<300&&Math.sqrt((mouse.lastDownData.x-mouse.x)**2+(mouse.lastDownData.y-mouse.y)**2)<20){if(void 0!==draggingPetalContainer.lastPetalSlot&&-1!==draggingPetalContainer.lastPetalSlot.index){if(!0===draggingPetalContainer.lastPetalSlot.top){if(void 0===i.bottomPetalContainers[draggingPetalContainer.lastPetalSlot.index])return void this.mouseUp(...arguments,!0)}else if(void 0===i.topPetalContainers[draggingPetalContainer.lastPetalSlot.index])return void this.mouseUp(...arguments,!0);return i.addPetalContainer(draggingPetalContainer,draggingPetalContainer.lastPetalSlot.top,draggingPetalContainer.lastPetalSlot.index),i.swapPetals(draggingPetalContainer.lastPetalSlot.index,!1),void(draggingPetalContainer=null)}if(!0===i.addInFirstAvailableSlot(draggingPetalContainer))return void(draggingPetalContainer=null)}if(!0===i.addClosest(draggingPetalContainer,this))draggingPetalContainer=null;else{const t=window.structuredClone(draggingPetalContainer.render),e={x:draggingPetalContainer.mouseOffset.x,y:draggingPetalContainer.mouseOffset.y};this.addPetalContainer(draggingPetalContainer),draggingPetalContainer=new PetalContainer(draggingPetalContainer.petals,{...draggingPetalContainer,isDragging:!0},Math.random(),draggingPetalContainer.amount);for(let e in t)draggingPetalContainer[e]=t[e];draggingPetalContainer.mouseOffset=e,draggingPetalContainer.x=t.x,draggingPetalContainer.y=t.y,draggingPetalContainer.spawnAnimation=1,draggingPetalContainer.collectTime=time,this.removeDraggingAnim=setTimeout(()=>{draggingPetalContainer=null,delete this.removeDraggingAnim},150)}}}drawInventory(t=1){this.render.scroll=interpolate(this.render.scroll,this.scroll,.007*dt),1!==t&&(ctx.globalAlpha=t);let e=0;time-this.lastCloseTime<160&&(e+=this.h*easeOutCubic((time-this.lastCloseTime)/160)),time-this.lastOpenTime<160&&(e+=this.h+40-(this.h+40)*easeOutCubic((time-this.lastOpenTime)/160)),0!==e&&ctx.translate(0,e),!0!==this.hoveringOverScrollbar&&!0!==this.draggingScrollBar||setCursor("pointer"),ctx.translate(130,canvas.h-this.h-20),ctx.fillStyle="#5a9fdb",ctx.strokeStyle="#4981b1",ctx.lineWidth=8,ctx.save(),ctx.beginPath(),ctx.roundRect(0,0,this.w,this.h,3),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.save(),ctx.font="600 25px 'Ubuntu'",ctx.lineWidth=4,ctx.lineWidth,ctx.fillStyle="#ffffff",ctx.strokeStyle="#000000",ctx.strokeText("Inventory",this.w/2,25),ctx.fillText("Inventory",this.w/2,25),this.drawTextInput(),ctx.restore();const i=100,n=65;ctx.beginPath(),ctx.roundRect(0,i,this.w,this.h-i,3),ctx.clip(),ctx.closePath();let a=null,r=null,s=0;for(let t of Object.values(this.petalContainers).reverse())for(let e of t)this.filteredOutBySearch(e)||(e.x=67.5+s%5/4*(this.w-n-35-50),e.y=132.5+77*Math.floor(s/5)+this.render.scroll,e.renderIndex=s,null===a&&(a=e),r=e,e.relativeY=77*Math.floor(s/5)+32.5+this.render.scroll,e.relativeY-e.y+e.render.y<this.h-i+n&&e.relativeY-e.y+e.render.y>-30?(void 0!==e.lastOutTime&&(delete e.lastOutTime,e.lastInTime=time),e.draw()):e.updateInterpolate(),s++);if(ctx.restore(),ctx.fillStyle="#5a9fdb",ctx.strokeStyle="#4981b1",ctx.lineWidth=8,ctx.save(),ctx.beginPath(),ctx.roundRect(0,0,this.w,this.h,3),ctx.stroke(),ctx.closePath(),null!==a&&Object.keys(this.petalContainers).length>0)if(this.menuHeights={beginning:a.relativeY,end:r.relativeY},this.menuHeights.end-this.menuHeights.beginning<this.h-77)this.scrollBarActive=!1,this.scroll=5;else{this.menuHeights.end-this.menuHeights.beginning<this.h?this.scrollBarActive=!1:this.scrollBarActive=!0,this.menuHeights.end+this.scroll-this.render.scroll<this.h-n-i?this.scroll=this.menuHeights.beginning-this.menuHeights.end+this.h-n-i-5:this.menuHeights.beginning+this.scroll-this.render.scroll>i&&(this.scroll=5);const t={top:canvas.h-this.h-20+.5*this.scrollbar.length+60,bottom:canvas.h-20-.5*this.scrollbar.length+30};this.totalPetalHeight=this.menuHeights.beginning-this.menuHeights.end;const e=this.scroll/this.totalPetalHeight/(1+this.h/this.totalPetalHeight);this.scrollbar.bottom=interpolate(t.top,t.bottom,e)-this.scrollbar.length/2,this.scrollbar.top=this.scrollbar.bottom+this.scrollbar.length/2}this.scrollbar.renderTop=interpolate(this.scrollbar.renderTop,this.scrollbar.top,this.draggingScrollBar?.28:.08),this.scrollbar.renderBottom=interpolate(this.scrollbar.renderBottom,this.scrollbar.bottom,this.draggingScrollBar?.28:.08),!1!==this.scrollBarActive&&Object.keys(this.petalContainers).length>0&&(ctx.translate(0,-(canvas.h-this.h-20)),ctx.strokeStyle="#4981b1",ctx.lineWidth=8,ctx.lineCap="round",ctx.beginPath(),ctx.moveTo(this.w-16,this.scrollbar.renderTop),ctx.lineTo(this.w-16,this.scrollbar.renderBottom),ctx.stroke(),ctx.closePath(),ctx.translate(0,canvas.h-this.h-20)),!0===this.menuActive&&0===e?mouse.canvasX>130+this.w-7.5-30-3&&mouse.canvasY>canvas.h-this.h-20+7.5+3&&mouse.canvasX<130+this.w-7.5-3&&mouse.canvasY<canvas.h-this.h-20+7.5+30+3?(ctx.fillStyle="#c16666",setCursor("pointer"),this.hoveringOverX=!0):(this.hoveringOverX=!1,ctx.fillStyle="#c1565e"):(ctx.fillStyle="#c1565e",this.hoveringOverX=!1),ctx.translate(-3,3),ctx.strokeStyle="#90464b",ctx.lineWidth=5,ctx.beginPath(),ctx.roundRect(this.w-7.5-30,7.5,30,30,6),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.lineWidth=4.75,ctx.lineCap="round",ctx.strokeStyle="#cccccc",ctx.beginPath(),ctx.moveTo(this.w-30,30),ctx.lineTo(this.w-15,15),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(this.w-15,30),ctx.lineTo(this.w-30,15),ctx.stroke(),ctx.closePath(),ctx.translate(3,-3),ctx.translate(-130,-(canvas.h-this.h-20)),0!==e&&ctx.translate(0,-e),ctx.globalAlpha=1;const l=mouse.canvasX-130,o=mouse.canvasY-(canvas.h-this.h-20);if(l>0&&l<this.w&&o>0&&o<this.h)for(let t of Object.values(this.petalContainers).reverse())for(let e of t)this.filteredOutBySearch(e)||(l>e.x-e.w/2&&l<e.x+e.w/2&&o>e.y-e.h/2&&o<e.y+e.h/2&&(e.isHovered=!0),e.drawStatsBox(!1,!1,e.render.x+130,e.render.y+(canvas.h-this.h-20)))}drawTextInput(){ctx.save(),ctx.fillStyle="#ffffff",ctx.strokeStyle="#000000",ctx.lineWidth=4,ctx.beginPath(),ctx.roundRect(35,45,this.w-85,35,2),ctx.fill(),ctx.stroke(),ctx.closePath(),this.mouseInTextBox()&&setCursor("text"),ctx.textAlign="left",ctx.font="600 22px 'Ubuntu'";let t=void 0!==this.currentSearchTerm&&this.currentSearchTerm.length>0;if(ctx.fillStyle=t?"#000000":"#cccccc",ctx.fillText(t?this.currentSearchTerm:"Search...",43,64),this.textBoxActive){let e=t?this.currentSearchTerm:"",i=petalSearch.selectionStart??e.length;if(Math.floor(Date.now()/500)%2==0){const t=43+ctx.measureText(e.slice(0,i)).width+2;ctx.beginPath(),ctx.moveTo(t,50),ctx.lineTo(t,75),ctx.lineWidth=2,ctx.strokeStyle="#000000",ctx.stroke()}}ctx.restore()}mouseInTextBox(){const t=mouse.canvasX-130,e=mouse.canvasY-(canvas.h-this.h-20);return t>35&&t<this.w-85&&e>45&&e<80}filteredOutBySearch(t){return this.currentSearchTerm&&this.currentSearchTerm.length>0&&!t.type.toLowerCase().includes(this.currentSearchTerm.toLowerCase())}updateScroll({x:t,y:e},{mouseX:i,mouseY:n}){!0===this.menuActive&&(i<130||n<canvas.h-this.h-20||i>130+this.w||n>canvas.h-20||(this.scroll-=e))}mouseMove({mouseX:t,mouseY:e}){if(t<this.w-16+12+130&&t>this.w-16-12+130&&e>this.scrollbar.bottom&&e<this.scrollbar.top?this.hoveringOverScrollbar=!0:this.hoveringOverScrollbar=!1,!0!==this.draggingScrollBar||0===Object.keys(this.petalContainers).length)return;const i=canvas.h-this.h-20+.5*this.scrollbar.length+60,n=canvas.h-20-.5*this.scrollbar.length+30,a=i-.25*this.scrollbar.length;let r=(e-a)/(n+.33*this.scrollbar.length-a);r<0?r=0:r>1&&(r=1),!1!==this.scrollBarActive?this.scroll=r*this.totalPetalHeight:this.scroll=5}toggleMenu(){!0===mobGallery.menuActive&&mobGallery.toggleMenu(),!0===shop.menu.active&&shop.toggle(),this.isSpecial&&!0===globalInventory.menuActive&&(globalInventory.menuActive=!1,globalInventory.lastCloseTime=time),this.isSpecial||!0!==specialGlobalInventory.menuActive||(specialGlobalInventory.menuActive=!1,specialGlobalInventory.lastCloseTime=time),!0===this.menuActive?this.lastCloseTime=time:(this.lastOpenTime=time,!0===craftingMenu.menuActive&&craftingMenu.toggleMenu()),this.menuActive=!this.menuActive,petalSearch.value="",this.currentSearchTerm=""}}function simulatedraggingPetalContainer(t,e){const i=draggingPetalContainer;i.x=t+i.mouseOffset.x,i.y=e+i.mouseOffset.y,void 0===i.base&&(i.render.x=interpolate(i.render.x,i.x,.2),i.render.y=interpolate(i.render.y,i.y,.2));const n=menuInventory.getClosest(i);!1!==n?(void 0===i.base&&(i.base={w:i.w,h:i.h}),void 0!==i.firstPetalSettleTimer&&time-i.firstPetalSettleTimer>200?(i.x=n.x,i.y=n.y+menuInventory.translateY,i.w=n.size,i.h=n.size):void 0===i.firstPetalSettleTimer&&(i.firstPetalSettleTimer=time)):i.base&&(i.w=i.base.w,i.h=i.base.h,delete i.base,delete i.firstPetalSettleTimer)}