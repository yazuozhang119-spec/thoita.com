const playerSpeed=1,petalRotateSpeed=2.5/30,neutralPetalDistance=70,attackPetalDistance=133.7,defendPetalDistance=42,flowerSpeed=1/9,serverTickLength=1e3/30,flowerInterpolateKeys=["headX","headY","radius","hp","baseX","baseY","petalDistance","beforeStreakHp","shield","isPoisoned","healingReduction"],flowerInterpolateMagnitudes=[.072,.072,.44,.22,.088,.088,.2,.22,.22,.088,.088],flowerPackKeys=["id","hp","maxHp","shield","headX","headY","radius","petalRotation","petalRotateSpeed","angle","isPoisoned","petalDistance"];class Flower{constructor(t){this.id=t,this.x=0,this.y=0,this.baseX=0,this.baseY=0,this.healingReduction=1,this.headX=0,this.headY=0,this.radius=25,this.xv=0,this.yv=0,this.friction=.3,this.movementType="mouse",this.angle=0,this.magnitude=0,this.maxHp=100,this.hp=100,this.shield=0,this.isPoisoned=0,this.name="",this.beforeStreakHp=this.maxHp,this.ticksSinceLastDamaged=1001,this.input={up:!1,down:!1,right:!1,left:!1},this.eyeOffsetX=0,this.eyeOffsetY=0,this.petals=[],this.petalRotateSpeed=petalRotateSpeed,this.petalRotation=0,this.petalLag=0,this.petalDistance=70,this.attacking=!1,this.defending=!1,this.middleState=!1,this.render={};for(let t=0;t<flowerInterpolateKeys.length;t++)this.render[flowerInterpolateKeys[t]]=this[flowerInterpolateKeys[t]];this.render.angle=this.angle,this.render.fastPetalDistance=this.petalDistance,this.render.x=this.render.baseX,this.render.y=this.render.baseY,this.projectiles=[],this.pets=[],this.deadProjectiles=[],this.deadPets=[],this.character="flower",this.score=0}init(t){if(t.id==selfId&&t.equippedArtifacts&&t.equippedArtifacts.length>0&&"undefined"!=typeof menuInventory){const e=t.equippedArtifacts[0];if(e&&"undefined"!=typeof specialGlobalInventory){const t=specialGlobalInventory.artifacts[e];t&&t.petalContainer&&(menuInventory.artifactContainer=t.petalContainer,menuInventory.artifactContainer.x=menuInventory.artifactSlot.x,menuInventory.artifactContainer.y=menuInventory.artifactSlot.y,menuInventory.artifactContainer.w=menuInventory.artifactSlot.size,menuInventory.artifactContainer.h=menuInventory.artifactSlot.size,"undefined"!=typeof inventory&&(inventory.artifactContainer=t.petalContainer,inventory.artifactContainer.x=inventory.artifactSlot.x,inventory.artifactContainer.y=inventory.artifactSlot.y,inventory.artifactContainer.w=inventory.artifactSlot.size,inventory.artifactContainer.h=inventory.artifactSlot.size))}}t.id==selfId&&t.maxMana&&(null!=t.maxMana.grace&&t.maxMana.grace>0&&GraceBar.init(t.maxMana.grace,t.mana.grace),null!=t.maxMana.time&&t.maxMana.time>0&&TimeBar.init(t.maxMana.time,t.mana.time),null!=t.maxMana.divergence&&t.maxMana.divergence>0&&DivergenceBar.init(t.maxMana.divergence,t.mana.divergence));for(let e in t)if("petals"!==e)if("projectiles"===e)for(let e=0;e<t.projectiles.length;e++)this.projectiles[e]=new Petal(t.projectiles[e]),this.projectiles[e].isProjectile=!0;else if("pets"===e)for(let e=0;e<t.pets.length;e++)this.pets[e]=new Enemy(t.pets[e]);else this[e]=t[e];else for(let e in t.petals)this.petals[e]=new Petal(t.petals[e])}update(t,e){t[e+1]<this.hp&&this.updateRenderDamage(t.hp);for(let a=e;a<flowerPackKeys.length+e;a++)a===e+9&&this.id===window.selfId||(this[flowerPackKeys[a-e]]=t[a]);this.x=this.headX,this.y=this.headY,this.baseX=interpolate(this.baseX,this.headX,.4),this.baseY=interpolate(this.baseY,this.headY,.4);for(let a=0;a<this.petals.length;a++){const i=t[e+flowerPackKeys.length+a];let s=Math.floor(100*i)/100,l=Math.round(1e3*(i-s));if(i<=0)this.petals[a].update({takeDamage:!0,hp:-s},this);else if(1!==l){if(i>=.002&&i<.003){const t=(i-.002)/1e-4;if(!this.petals[a].maxHp){const t=Stats.petals?.[this.petals[a].type]?.[this.petals[a].rarity];this.petals[a].maxHp=t?.health||100}if(this.petals[a].hp=this.petals[a].maxHp*Math.max(0,Math.min(1,t)),this.petals[a].render.hp=this.petals[a].hp,!this.petals[a].reloadBase){const t=Stats.petals?.[this.petals[a].type]?.[this.petals[a].rarity];this.petals[a].reloadBase=t?.reload||3}this.petals[a].maxReload||(this.petals[a].maxReload=1e3*this.petals[a].reloadBase),this.petals[a].reload=this.petals[a].maxReload,this.petals[a].render.reload=this.petals[a].reload,!1!==this.petals[a].dead&&this.petals[a].update({dead:!1},this);continue}if(3!==l){if(4===l){const t=(i-.004)/1e-4;if(!this.petals[a].maxReload){const t=Stats.petals?.[this.petals[a].type]?.[this.petals[a].rarity];this.petals[a].reloadBase=t?.reload||3,this.petals[a].maxReload=1e3*this.petals[a].reloadBase}this.petals[a].reload=this.petals[a].maxReload*Math.max(0,Math.min(1,t)),this.petals[a].render.reload=this.petals[a].reload,!0!==this.petals[a].dead&&this.petals[a].update({dead:!0},this);continue}if(5!==l);else if(!0!==this.petals[a].dying){const t=this.petals[a].render?.x??this.petals[a].x,e=this.petals[a].render?.y??this.petals[a].y;this.petals[a].update({dead:!0,dying:!0,reload:s,deadPosition:{x:t,y:e}},this)}else this.petals[a].update({reload:s},this)}else this.petals[a].update({distance:s},this)}else!1!==this.petals[a].dead&&this.petals[a].update({dead:!1},this)}if(0!==this.projectiles.length){const a=e+flowerPackKeys.length+this.petals.length;for(let e=0;e<this.projectiles.length;e++){if(!this.projectiles[e])continue;const i=[t[a+2*e],t[a+2*e+1]];-6.5===i[0]?this.projectiles[e].update({dead:!0},this):this.projectiles[e].update({x:i[0],y:i[1]},this)}}if(0!==this.pets.length){const a=e+flowerPackKeys.length+this.petals.length+2*this.projectiles.length;for(let e=0;e<this.pets.length;e++){const i=a+e*enemyPackKeys.length;this.pets[e].update(t,i)}}}updateRenderDamage(){this.ticksSinceLastDamaged=0}updatePetsAndProjectiles(){for(let t=0;t<this.deadProjectiles.length;t++)this.deadProjectiles[t].deadAnimationTimer>166&&(this.deadProjectiles[t].toRemove=!0);this.deadProjectiles=this.deadProjectiles.filter(t=>!0!==t.toRemove);for(let t=0;t<this.deadPets.length;t++)this.deadPets[t].deadAnimationTimer>166&&(this.deadPets[t].toRemove=!0);this.deadPets=this.deadPets.filter(t=>!0!==t.toRemove)}calculatePetalLag(){return 1.08695652174*this.petalRotateSpeed}updateInterpolate(){if(window.isEditor&&void 0!==this.extraRange&&this.petalDistance>70){var t=this.petalDistance;this.petalDistance/=this.extraRange}for(let t=0;t<flowerInterpolateKeys.length;t++)this.render[flowerInterpolateKeys[t]]=interpolate(this.render[flowerInterpolateKeys[t]],this[flowerInterpolateKeys[t]],flowerInterpolateMagnitudes[t]*dt/16.66);this.render.angle=interpolateDirection(this.render.angle,this.angle,.2*dt/16.66),this.render.fastPetalDistance=interpolate(this.render.fastPetalDistance,this.petalDistance,.4*dt/16.66);for(let t=0;t<this.petals.length;t++)this.petals[t].updateInterpolate(this);for(let t=0;t<this.projectiles.length;t++)this.projectiles[t]&&(void 0!==this.projectiles[t].updateInterpolate?this.projectiles[t].updateInterpolate(this):this.projectiles[t]=new Petal(this.projectiles[t]));this.render.x=this.render.baseX,this.render.y=this.render.baseY,window.isEditor&&void 0!==this.extraRange&&this.petalDistance>70&&(this.petalDistance=t)}drawProjectiles(){if(0!==this.projectiles.length&&(!0===window.renderSquadPetals||this.id===window.selfId))for(let t=0;t<this.projectiles.length;t++)this.projectiles[t]&&(!0===toRender({x:this.projectiles[t].x,y:this.projectiles[t].y,radius:this.projectiles[t].radius},window.camera)&&this.projectiles[t].draw(),this.projectiles[t].updateTimer())}drawPets(){for(let t=0;t<this.pets.length;t++)void 0!==this.pets[t]?.render?.x&&!0===toRender({x:this.pets[t].x,y:this.pets[t].y,radius:4*this.pets[t].radius},window.camera)&&this.pets[t].draw();for(let t=0;t<this.deadPets.length;t++)void 0!==this.deadPets[t]?.render?.x&&!0===toRender({x:this.deadPets[t].x,y:this.deadPets[t].y,radius:4*this.deadPets[t].radius},window.camera)&&this.deadPets[t].draw()}draw(){this.id!==window.selfId&&this.updateInterpolate(),this.updatePetsAndProjectiles();for(let t=0;t<this.deadProjectiles.length;t++)!this.deadProjectiles[t]||!0!==window.renderSquadPetals&&this.id!==window.selfId||(!0===toRender({x:this.deadProjectiles[t].x,y:this.deadProjectiles[t].y,radius:this.deadProjectiles[t].radius},window.camera)&&this.deadProjectiles[t].draw(),this.deadProjectiles[t].updateTimer());if(this.ticksSinceLastDamaged+=dt,this.ticksSinceLastDamaged>666&&(this.beforeStreakHp=this.hp),renderHpBar({x:this.render.headX,y:this.render.headY-this.render.radius/3,radius:this.render.radius,hp:this.render.hp,maxHp:this.maxHp,shield:this.render.shield,beforeStreakHp:this.render.beforeStreakHp,flowerName:this.name,flowerUsername:this.username},this),void 0!==this.petalAlpha&&(ctx.globalAlpha=this.petalAlpha),this.id==window.selfId&&(petalReloadData={},petalHpData={}),!0===window.renderSquadPetals||this.id===window.selfId)if("Tanksmith"===this.character&&"menu"===state){let t=1;for(let e=0;e<this.petals.length;e++){let a=this.petals[e];if(!0===toRender({x:a.x,y:a.y,radius:a.radius},window.camera)){if(0!==a.subStackedId){t++;continue}ctx.translate(a.render.x,a.render.y);let e="Normal";["Rose","Dahlia","Leaf","Starfish","Shell"].includes(a.type)?e="Heal":["Yucca"].includes(a.type)?e="TankHeal":"Bud"===a.type?e="Bud":"Bloom"===a.type?e="Bloom":"Magnet"===a.type?e="Magnet":"Egg"!==a.type&&"Jellyfish Egg"!==a.type&&"Neuroflare Egg"!==a.type||(e="Egg"),enemyRenderMap.Tanksmith({render:{radius:a.radius*Math.sqrt(t),angle:a.render.angle},barrelNum:t,tsRenderType:e,ticksSinceLastDamaged:1001,lastTicksSinceLastDamaged:1001}),ctx.translate(-a.render.x,-a.render.y),t=1}a.updateTimer()}}else{let t=!1,e=1;if(window.verdantUltimateEffects&&window.verdantUltimateEffects[this.id]){const a=window.verdantUltimateEffects[this.id],i=performance.now();i<a.endTime&&(t=!0,e=Math.min((i-a.startTime)/300,1))}for(let a=0;a<this.petals.length;a++){let i=this.petals[a];if(!0===toRender({x:i.x,y:i.y,radius:i.radius},window.camera)&&i.draw(t,e),this.id==window.selfId){let t=i.petalContainerId;petalReloadData[t]?petalReloadData[t].reload<i.render.reload/i.maxReload&&(i.dead||i.dying)&&(petalReloadData[t].reload=i.render.reload/i.maxReload):(i.dead||i.dying)&&(petalReloadData[t]={reload:i.render.reload/i.maxReload}),petalHpData[t]?i.dead||(petalHpData[t].hp=(petalHpData[t].count*petalHpData[t].hp+i.render.hp/i.maxHp)/(petalHpData[t].count+1),petalHpData[t].count++):i.dead||(petalHpData[t]={hp:i.render.hp/i.maxHp,count:1})}i.updateTimer()}}if(ctx.globalAlpha=1,!0===toRender({x:this.headX,y:this.headY,radius:this.radius},window.camera)&&this.drawFlower(this.render.headX,this.render.headY,this.radius,this.character),(!0===window.renderSquadPetals||this.id===window.selfId)&&this.lightnings&&this.lightnings.length>0){this.lightnings=this.lightnings.filter(t=>time<t.time+600);let t=null;for(let e of this.lightnings){e.type!==t&&(ctx.strokeStyle=["#97f0ea","#f0ee97","#00fca4","#a82d2d"][e.type],t=e.type),e.rarity>=13?ctx.lineWidth=9*(2-(time-e.time)/700):ctx.lineWidth=5*(2-(time-e.time)/700),ctx.globalAlpha=1-(time-e.time)/700,ctx.beginPath();for(let t=0;t<e.renderData.length;t++)ctx.lineTo(e.renderData[t].x,e.renderData[t].y);ctx.stroke(),e.rarity>=13&&(ctx.lineWidth=18*(2-(time-e.time)/700),ctx.stroke()),ctx.closePath()}ctx.globalAlpha=1}if((!0===window.renderSquadPetals||this.id===window.selfId)&&this.blasts&&this.blasts.length>0){this.blasts=this.blasts.filter(t=>time<t.time+600);for(let t of this.blasts)0==t.type?(ctx.fillStyle="#581e75",ctx.globalAlpha=.115385-(time-t.time)/5200):1==t.type&&(ctx.fillStyle="#e68612",ctx.globalAlpha=.0555555-(time-t.time)/10800),ctx.beginPath(),ctx.arc(t.x,t.y,t.radius+this.radius,0,2*Math.PI),ctx.fill(),ctx.closePath();ctx.globalAlpha=1}if(this.thunderstruck&&time<this.thunderstruck){const t=this.thunderstruck-time,e=Math.min(1,t/2e3);ctx.save(),ctx.translate(this.render.headX,this.render.headY),ctx.strokeStyle=`rgba(100, 200, 255, ${.8*e})`,ctx.lineWidth=2,ctx.shadowColor="#00ffff",ctx.shadowBlur=10;const a=5;for(let t=0;t<a;t++){const e=(time/200+t*(2*Math.PI/a))%(2*Math.PI),i=1.3*this.render.radius,s=1.8*this.render.radius,l=Math.PI/3;ctx.beginPath();for(let t=0;t<=10;t++){const a=t/10,r=i+(s-i)*Math.random(),n=e+(a-.5)*l+.3*(Math.random()-.5),h=Math.cos(n)*r,o=Math.sin(n)*r;0===t?ctx.moveTo(h,o):ctx.lineTo(h,o)}ctx.stroke()}if(Math.random()<.3){const t=Math.random()*Math.PI*2,a=this.render.radius*(.5+.5*Math.random());ctx.strokeStyle=`rgba(200, 220, 255, ${e})`,ctx.lineWidth=1,ctx.beginPath(),ctx.moveTo(Math.cos(t)*this.render.radius,Math.sin(t)*this.render.radius),ctx.lineTo(Math.cos(t)*(this.render.radius+a),Math.sin(t)*(this.render.radius+a)),ctx.stroke()}ctx.restore()}}drawFlower(t,e,a,i="flower"){if(!this.dead)if(this.dev){if("Tanksmith"===i?(ctx.fillStyle=blendColor("#790000","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#550000","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.lineWidth=4):(ctx.fillStyle=blendColor("#ffe763","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#cebb50","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.lineWidth=a/8),ctx.fillStyle=blendColor(ctx.fillStyle,"#ce76da",Math.max(0,this.render.isPoisoned)),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#ab63b3",Math.max(0,this.render.isPoisoned)),ctx.fillStyle=blendColor(ctx.fillStyle,"#ce76da",Math.max(0,this.render.isPoisoned)),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#ab63b3",Math.max(0,this.render.isPoisoned)),this.render.healingReduction<.999&&(ctx.fillStyle=blendColor(ctx.fillStyle,"#ffffff",Math.max(0,1-this.render.healingReduction)),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#ffffff",Math.max(0,1-this.render.healingReduction))),this.undead?(ctx.fillStyle="#222222",ctx.strokeStyle="#000000"):this.rage&&(ctx.fillStyle="#9900ff",ctx.strokeStyle="#6b00b3"),ctx.beginPath(),ctx.lineTo(t+1.03*a,e+-.02*a),ctx.quadraticCurveTo(t+.78*a,e+1.06*a,t+.27*a,e+1.14*a),ctx.quadraticCurveTo(t+-.8*a,e+.75*a,t+-.94*a,e+.36*a),ctx.quadraticCurveTo(t+-1.18*a,e+-.29*a,t+-.83*a,e+-.95*a),ctx.quadraticCurveTo(t+-.45*a,e+-1.3*a,t+-.06*a,e+-1.06*a),ctx.quadraticCurveTo(t+.85*a,e+-1.04*a,t+1.03*a,e+-.02*a),ctx.fill(),ctx.stroke(),ctx.closePath(),"Tanksmith"===i){ctx.translate(t,e),ctx.rotate(this.render.angle),ctx.lineWidth=5,ctx.fillStyle=blendColor("#bfbfbf","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#868686","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166));for(let t=0;t<8;t++)ctx.beginPath(),ctx.roundRect(0,.23*-a,1.3*a,.23*a*2,2),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.rotate(2*Math.PI/8);return ctx.beginPath(),ctx.arc(0,0,a/2,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.rotate(-this.render.angle),void ctx.translate(-t,-e)}let s;ctx.fillStyle="#212219",ctx.beginPath(),ctx.ellipse(t+a/2.5+.05*a,e+5*a/13.5,3*a/23.5*1.1,5.85*a/23.5*1.1,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.ellipse(t-a/2.5,e-5*a/23.5+-.15*a,3*a/23.5*1.1,5.85*a/23.5*1.1,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.strokeStyle=ctx.fillStyle,ctx.lineWidth=a/15,ctx.lineCap="round",s=this.attacking||this.defending?1:0,this.render.isPoisoned&&(s=this.render.isPoisoned),ctx.beginPath(),ctx.moveTo(t-.3*a+a/4,e+.025*a+9.5*a/23.5),ctx.quadraticCurveTo(t-.4*a,e-.1*a+1.07*a*(5.5+9.5*(1-s))/23.5*61.1/70,t-.275*a-a/4,e-.25*a+9.5*a/23.5),ctx.stroke(),ctx.save(),ctx.beginPath(),ctx.ellipse(t+a/2.5+.05*a,e+5*a/13.5,2.5*a/23.5*1.1,5*a/23.5*1.1,0,0,2*Math.PI),ctx.clip();const l={x:Math.cos(this.render.angle)*a*2/23,y:Math.sin(this.render.angle)*a*3.5/23};ctx.fillStyle="#eeeeee",ctx.beginPath(),ctx.ellipse(t+a/2.5+l.x+.05*a,e+5*a/13.5+l.y,2.92*a/23.5*1.1,2.92*a/23.5*1.1,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore(),ctx.save(),ctx.beginPath(),ctx.ellipse(t-a/2.5,e-5*a/23.5+-.15*a,2.5*+a/23.5*1.1,5*a/23.5*1.1,0,0,2*Math.PI),ctx.clip(),ctx.fillStyle="#eeeeee",ctx.beginPath(),ctx.ellipse(t-a/2.5-l.x,e-5*a/23.5-l.y+-.15*a,3*a/23.5*1.1,3*a/23.5*1.1,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore()}else{if("Tanksmith"===i?(ctx.fillStyle=blendColor("#790000","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#550000","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.lineWidth=4):(ctx.fillStyle=blendColor("#ffe763","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#cebb50","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.lineWidth=a/8),ctx.fillStyle=blendColor(ctx.fillStyle,"#ce76da",Math.max(0,this.render.isPoisoned)),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#ab63b3",Math.max(0,this.render.isPoisoned)),this.render.healingReduction<.999&&(ctx.fillStyle=blendColor(ctx.fillStyle,"#ffffff",Math.max(0,1-this.render.healingReduction)),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#ffffff",Math.max(0,1-this.render.healingReduction))),this.undead?(ctx.fillStyle="#222222",ctx.strokeStyle="#000000"):this.rage&&(ctx.fillStyle="#9900ff",ctx.strokeStyle="#6b00b3"),ctx.beginPath(),ctx.arc(t,e,a,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),"Tanksmith"===i){ctx.translate(t,e),ctx.rotate(this.render.angle),ctx.lineWidth=5,ctx.fillStyle=blendColor("#bfbfbf","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#868686","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166));for(let t=0;t<8;t++)ctx.beginPath(),ctx.roundRect(0,.23*-a,1.3*a,.23*a*2,2),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.rotate(2*Math.PI/8);return ctx.beginPath(),ctx.arc(0,0,a/2,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.rotate(-this.render.angle),void ctx.translate(-t,-e)}let s;ctx.fillStyle="#212219",ctx.beginPath(),ctx.ellipse(t-a/3.5,e-5*a/23.5,3*a/23.5,5.85*a/23.5,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.ellipse(t+a/3.5,e-5*a/23.5,3*a/23.5,5.85*a/23.5,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.strokeStyle=ctx.fillStyle,ctx.lineWidth=a/15,ctx.lineCap="round",s=this.attacking||this.defending?1:0,this.render.isPoisoned>.001&&(s=Math.max(this.render.isPoisoned,s)),ctx.beginPath(),ctx.moveTo(t+a/4,e+9.5*a/23.5),ctx.quadraticCurveTo(t,e+1.07*a*(5.5+9.5*(1-s))/23.5*61.1/70,t-a/4,e+9.5*a/23.5),ctx.stroke(),ctx.save(),ctx.beginPath(),ctx.ellipse(t+a/3.5,e-5*a/23.5,2.5*a/23.5,5*a/23.5,0,0,2*Math.PI),ctx.clip();const l={x:Math.cos(this.render.angle)*a*2/23,y:Math.sin(this.render.angle)*a*3.5/23};let r;ctx.fillStyle="#eeeeee",ctx.beginPath(),ctx.ellipse(t+a/3.5+l.x,e-5*a/23.5+l.y,2.92*a/23.5,2.92*a/23.5,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore(),ctx.save(),ctx.beginPath(),ctx.ellipse(t-a/3.5,e-5*a/23.5,2.5*a/23.5,5*a/23.5,0,0,2*Math.PI),ctx.clip(),ctx.fillStyle="#eeeeee",ctx.beginPath(),ctx.ellipse(t-a/3.5+l.x,e-5*a/23.5+l.y,3*a/23.5,3*a/23.5,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore(),r=this.attacking||this.defending?(133.7-7-126)/35*a/25:-1.8*a/25,ctx.fillStyle=blendColor("#ffe763","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.fillStyle=blendColor(ctx.fillStyle,"#ce76da",Math.max(0,this.render.isPoisoned)),this.undead?(ctx.fillStyle="#222222",ctx.strokeStyle="#000000"):this.rage&&(ctx.fillStyle="#9900ff",ctx.strokeStyle="#6b00b3"),ctx.beginPath(),ctx.moveTo(t-a/3.5*2,e-14*a/23.5+r),ctx.lineTo(t+a/3.5*2,e-14*a/23.5+r),ctx.lineTo(t,e-5*a/23.5+r),ctx.fill(),ctx.closePath()}}static drawDeadFlower(t,e,a){if(this.dev){ctx.fillStyle="#ffe763",ctx.strokeStyle="#cebb50",ctx.lineWidth=a/8,ctx.beginPath(),ctx.lineTo(t+1.03*a,e+-.02*a),ctx.quadraticCurveTo(t+.78*a,e+1.06*a,t+.27*a,e+1.14*a),ctx.quadraticCurveTo(t+-.8*a,e+.75*a,t+-.94*a,e+.36*a),ctx.quadraticCurveTo(t+-1.18*a,e+-.29*a,t+-.83*a,e+-.95*a),ctx.quadraticCurveTo(t+-.45*a,e+-1.3*a,t+-.06*a,e+-1.06*a),ctx.quadraticCurveTo(t+.85*a,e+-1.04*a,t+1.03*a,e+-.02*a),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.fillStyle="#212219",ctx.strokeStyle=ctx.fillStyle,ctx.lineWidth=a/15,ctx.lineCap="round";let i=1;ctx.beginPath(),ctx.moveTo(t-.3*a+a/4,e+.025*a+9.5*a/23.5),ctx.quadraticCurveTo(t-.4*a,e-.1*a+1.07*a*(5.5+9.5*(1-i))/23.5*61.1/70,t-.275*a-a/4,e-.25*a+9.5*a/23.5),ctx.stroke(),ctx.lineWidth=a/8,ctx.lineCap="round";let s={x:t+a/2.5+.05*a,y:e+5*a/13.5};ctx.beginPath(),ctx.moveTo(s.x+4*a/23.5,s.y+4*a/23.5),ctx.lineTo(s.x-4*a/23.5,s.y-4*a/23.5),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(s.x+4*a/23.5,s.y-4*a/23.5),ctx.lineTo(s.x-4*a/23.5,s.y+4*a/23.5),ctx.stroke(),ctx.closePath(),s={x:t-a/2.5,y:e-5*a/23.5+-.15*a},ctx.beginPath(),ctx.moveTo(s.x+4*a/23.5,s.y+4*a/23.5),ctx.lineTo(s.x-4*a/23.5,s.y-4*a/23.5),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(s.x+4*a/23.5,s.y-4*a/23.5),ctx.lineTo(s.x-4*a/23.5,s.y+4*a/23.5),ctx.stroke(),ctx.closePath()}else{ctx.fillStyle="#ffe763",ctx.strokeStyle="#cebb50",ctx.lineWidth=a/8,ctx.beginPath(),ctx.arc(t,e,a,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.fillStyle="#212219",ctx.strokeStyle=ctx.fillStyle,ctx.lineWidth=a/8,ctx.lineCap="round";let i={x:t-a/3.5,y:e-5*a/23.5};ctx.beginPath(),ctx.moveTo(i.x+4*a/23.5,i.y+4*a/23.5),ctx.lineTo(i.x-4*a/23.5,i.y-4*a/23.5),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(i.x+4*a/23.5,i.y-4*a/23.5),ctx.lineTo(i.x-4*a/23.5,i.y+4*a/23.5),ctx.stroke(),ctx.closePath(),i={x:t+a/3.5,y:e-5*a/23.5},ctx.beginPath(),ctx.moveTo(i.x+4*a/23.5,i.y+4*a/23.5),ctx.lineTo(i.x-4*a/23.5,i.y-4*a/23.5),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(i.x+4*a/23.5,i.y-4*a/23.5),ctx.lineTo(i.x-4*a/23.5,i.y+4*a/23.5),ctx.stroke(),ctx.closePath(),ctx.strokeStyle=ctx.fillStyle,ctx.lineWidth=a/15,ctx.lineCap="round";let s=1;ctx.beginPath(),ctx.moveTo(t+a/4,e+9.5*a/23.5),ctx.quadraticCurveTo(t,e+1.07*a*(5.5+9.5*(1-s))/23.5*61.1/70,t-a/4,e+9.5*a/23.5),ctx.stroke()}}pack(){return{movementType:this.movementType,input:this.input}}}function interpolate(t,e,a){return t+(e-t)*(a=Math.max(0,Math.min(1,a)))}function shortAngleDist(t,e){const a=2*Math.PI,i=(e-t)%a;return 2*i%a-i}function interpolateDirection(t,e,a){return t+shortAngleDist(t,e)*a}function toRender(t,e={x:0,y:0}){return"pass"===t.x||!0===e.disableCulling||!(t.x-t.radius>e.x+canvas.w/2/renderFov||t.x+t.radius<e.x-canvas.w/2/renderFov)&&!(t.y-t.radius>e.y+canvas.h/2/renderFov||t.y+t.radius<e.y-canvas.h/2/renderFov)}