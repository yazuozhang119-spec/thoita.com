let savedStartingWave=localStorage.getItem("startingWave");"string"==typeof savedStartingWave&&(savedStartingWave=parseInt(savedStartingWave)),isNaN(savedStartingWave)&&(savedStartingWave=1);const outsidePadding=16,cardPadding=8,cardHeight=65,buttonPadding=10,flowerSize=40,flowerPadding=12,petalSlotSize=24,petalSlotPadding=3,petalSlotRows=2,petalSlotCols=10,artifactWidth=51,artifactHeight=51,readyCircleRadius=10;class SquadUI{constructor(){this.clients=[],this.w=540,this.h=0,this.x=canvas.w/2,this.y=canvas.h/2+30,this.timerX=0,this.minimizedHeight=46,this.baseHeight=this.h,this.minimized=!0,this.initRenderTimer=0,this.hoveringOverX=!1,this.hoveringOverPublic=!1,this.hoveringOverNew=!1,this.hoveringOverPrivate=!1,this.hoveringOverReady=!1,this.hoveringOverQuickJoin=!1,this.hoveringOverJoinMainPvp=!1,this.hoveringOverSW=!1,this.public=!0,this.selfId=null,this.startingWaveSlider=1,this.desiredSWS=1,this.draggingSlider=!1,this.maxStartingWave=1,this.startingWave=this.maxStartingWave}reset(){this.clients=[],this.hoveringOverX=!1,this.hoveringOverPublic=!1,this.hoveringOverNew=!1,this.hoveringOverPrivate=!1,this.hoveringOverReady=!1,this.hoveringOverQuickJoin=!1,this.hoveringOverJoinMainPvp=!1,this.hoveringOverSW=!1,this.public=!0,delete this.lastUnMinimizedTimer,delete window.squadUICloseTime,delete this.selfIdSentFlag,this.h=.01,this.initRenderTimer=0,this.buttonAlpha=1}removeAllClients(){this.clients=[]}startGame(){this.hoveringOverX=!1,this.hoveringOverPublic=!1,this.hoveringOverNew=!1,this.hoveringOverPrivate=!1,this.hoveringOverReady=!1,this.hoveringOverQuickJoin=!1,this.hoveringOverJoinMainPvp=!1,this.clients=[],this.h=0,this.minimized=!0,window.squadUIEnabled=!1}recieveData(t){this.selfId=t.selfId;for(let e=0;e<t.clients.length;e++)this.addClient(t.clients[e]);if(this.clients.length>t.clients.length){for(let e=0;e<this.clients.length;e++)void 0===t.clients[e]&&(this.clients[e].removed=!0);this.clients=this.clients.filter(t=>!0!==t.removed)}!1===t.public?(this.public=!1,biomeManager.switchToBiome(t.biome)):this.public=!0}getCardY(t){return canvas.h/2+20+73*t}getPetalSlotsBounds(t){const e=this.x-this.w/2+16,i=this.getCardY(t);return{x:e+(this.w-32)-8-267-51-3,y:i+7,w:267,h:51}}getArtifactBounds(t){const e=this.getPetalSlotsBounds(t);return{x:e.x+e.w+3,y:e.y,w:51,h:51}}getSliderBounds(t){const e=this.x-this.w/2+16,i=this.getCardY(t),a=(this.w,e+12+40+10);return{x:a,y:(i+18+(i+65-18))/2-5,w:this.getPetalSlotsBounds(t).x-40-a-6,h:10}}updateFlowerPetals(t,e,i=!0){let a=-1,s=null;for(let t=0;t<this.clients.length;t++)if(this.clients[t].id===e){s=this.clients[t],a=t;break}if(void 0===s||-1===a)return;const n=s.flower;n.lastPetals=n.petals,n.petals=[];const l=this.x-this.w/2+16,r=this.getCardY(a)+7+25.5;n.render.headX=l+12+20,n.render.headY=r,n.headX=n.render.headX,n.headY=n.render.headY,n.x=n.render.headX,n.y=n.render.headY,n.render.x=n.x,n.render.y=n.y,n.render.baseX=n.x,n.render.baseY=n.y,n.baseX=n.x,n.baseY=n.y;for(let e=0;e<t.length;e++){if(null===t[e]||void 0===t[e]){n.petals[e]=null;continue}const i=n.petals[e]=new Petal(t[e]);if(i.distance=neutralPetalDistance,i.render.distance=0,i.updateInterpolate(n),i.x=n.baseX,i.y=n.baseY,i.render.x=i.x,i.render.y=i.y,i.slowInterpolateDistance=!0,n.lastPetals&&void 0!==n.lastPetals[e]){for(let t in n.lastPetals[e].render)i.render[t]=n.lastPetals[e].render[t];i.angle=i.render.angle}}this.updateFlowerPetalContainers(n),delete n.lastPetals}updateCharacter(t,e){let i=null;for(let t=0;t<this.clients.length;t++)if(this.clients[t].id===e){i=this.clients[t];break}void 0!==i&&(i.flower.character=t)}updateFlowerPetalContainers(t,e=!1){e||(t.petalContainers=new Array(20).fill(null));const i={};for(let e=0;e<t.petals.length;e++){const a=t.petals[e];if(!a)continue;const s=parseInt(a.petalContainerId);isNaN(s)||s<0||s>=10||(i[s]||(i[s]=[]),i[s].push(a))}for(let e in i){const a=i[e];if(a.length>0){const i=new PetalContainer(a.map(t=>new Petal(t)),{x:0,y:0,w:20,h:20,originalX:0,originalY:0,radius:100,toRenderText:!1,toOscillate:!1},Math.random(),1);for(let t=0;t<i.petals.length;t++)i.petals[t].angle=0,i.petals[t].selfAngle=0;t.petalContainers[parseInt(e)]=i}}t.offPetals&&t.offPetals.length>0&&this.updateOffPetalContainers(t,e)}updateOffPetalContainers(t,e=!1){const i={};t.petalContainers&&20===t.petalContainers.length||(t.petalContainers=new Array(20).fill(null));for(let e=0;e<t.offPetals.length;e++){const a=t.offPetals[e];if(!a)continue;const s=10+parseInt(a.petalContainerId);isNaN(s)||s<10||s>=20||(i[s]||(i[s]=[]),i[s].push(a))}for(let e in i){const a=i[e];if(a.length>0){const i=new PetalContainer(a.map(t=>new Petal(t)),{x:0,y:0,w:20,h:20,originalX:0,originalY:0,radius:100,toRenderText:!1,toOscillate:!1},Math.random(),1);for(let t=0;t<i.petals.length;t++)i.petals[t].angle=0,i.petals[t].selfAngle=0;t.petalContainers[parseInt(e)]=i}}}updateFlowerOffPetals(t,e,i=!0){let a=-1,s=null;for(let t=0;t<this.clients.length;t++)if(this.clients[t].id===e){s=this.clients[t],a=t;break}if(void 0===s||-1===a)return;const n=s.flower;n.offPetals=[];for(let e=0;e<t.length;e++){if(null===t[e]||void 0===t[e]){n.offPetals[e]=null;continue}const i=n.offPetals[e]=new Petal(t[e]);i.distance=neutralPetalDistance,i.render.distance=0,i.x=n.baseX,i.y=n.baseY,i.render.x=i.x,i.render.y=i.y,i.slowInterpolateDistance=!0}this.updateOffPetalContainers(n,i)}updateSelfFlowerPetals(t){const e=this.findClient(this.selfId),i=e.flower;if(void 0===e||void 0===i)return;i.petals=[];for(let e in t.top){const a=t.top[e];for(let t=0;t<a.petals.length;t++){const s={...a.petals[t]};delete s.insidePetalContainer,s.petalContainerId=e,s.offset||(s.offset={angle:0,distance:0}),window.multiPetals&&void 0!==window.multiPetals[s.type]?s.subId=t:a.petals.length>1&&(s.subStackedId=t,s.subId=t,s.offset.angle=s.subStackedId/a.petals.length*Math.PI*2,s.offset.distance=s.radius),i.petals.push(new Petal(s));const n=i.petals[i.petals.length-1];n.distance=neutralPetalDistance,n.render.distance=0,n.updateInterpolate(i),n.x=i.baseX,n.y=i.baseY,n.render.x=n.x,n.render.y=n.y,n.slowInterpolateDistance=!0}}for(let e in t.bottom){const a=t.bottom[e];for(let t=0;t<a.petals.length;t++){const s={...a.petals[t]};delete s.insidePetalContainer,s.petalContainerId=e,s.offset||(s.offset={angle:0,distance:0}),window.multiPetals&&void 0!==window.multiPetals[s.type]?s.subId=t:a.petals.length>1&&(s.subStackedId=t,s.subId=t,s.offset.angle=s.subStackedId/a.petals.length*Math.PI*2,s.offset.distance=s.radius),i.petals.push(new Petal(s));const n=i.petals[i.petals.length-1];n.distance=neutralPetalDistance,n.render.distance=0,n.updateInterpolate(i),n.x=i.baseX,n.y=i.baseY,n.render.x=n.x,n.render.y=n.y,n.slowInterpolateDistance=!0}}const a=i.petals.filter(t=>0===t.subStackedId).length,s=Math.random()*Math.PI*2;let n=0;for(let t=0;t<i.petals.length;t++)0===i.petals[t].subStackedId&&n++,i.petals[t].id=t,i.petals[t].angle=n/a*Math.PI*2,i.petals[t].render.angle=s,i.petals[t].angleOffset=i.petals[t].angle;this.updateSelfFlowerPetalContainers(i)}updateSelfFlowerPetalContainers(t){const e=Object.values(menuInventory.topPetalContainers).concat(Object.values(menuInventory.bottomPetalContainers));t.petalContainers=e.map(t=>new PetalContainer(t.petals,{x:0,y:0,w:20,h:20,originalX:0,originalY:0,radius:100,toRenderText:!1,toOscillate:!1},Math.random(),1,0))}startSliderDrag(t){this.draggingSlider=!0,this.updateSliderDrag(t)}intersectingSlider({x:t,y:e}){let i=0;for(let t=0;t<this.clients.length;t++)if(this.clients[t].id===this.selfId){i=t;break}const a=this.getSliderBounds(i);return(t-interpolate(a.x,a.x+a.w,this.startingWaveSlider))**2+(e-(a.y+a.h/2))**2<225}intersectingSliderBound({x:t,y:e}){let i=0;for(let t=0;t<this.clients.length;t++)if(this.clients[t].id===this.selfId){i=t;break}const a=this.getSliderBounds(i),s=(interpolate(a.x,a.x+a.w,this.startingWaveSlider),a.y+a.h/2);let n=t;return n<a.x&&(n=a.x),n>a.x+a.w&&(n=a.x+a.w),(t-n)**2+(e-s)**2<225}updateSliderDrag(t){let e=0;for(let t=0;t<this.clients.length;t++)if(this.clients[t].id===this.selfId){e=t;break}const i=this.getSliderBounds(e);let a=t-i.x;a<0?a=0:a>i.w&&(a=i.w),this.desiredSWS=a/i.w}endSliderDrag(t){if(!1===this.draggingSlider)return;this.updateSliderDrag(t);const e=Math.max(1,Math.ceil(this.desiredSWS*this.maxStartingWave));send({sw:e}),this.draggingSlider=!1,e!==this.maxStartingWave?(localStorage.setItem("startingWave",e),savedStartingWave=e):(localStorage.removeItem("startingWave"),savedStartingWave=null)}sendSavedStartingWave(){null!==savedStartingWave&&send({sw:savedStartingWave})}render(t){if(this.hoveringOverSW=!1,0===this.clients.length?!0!==window.squadUIEnabled?(this.minimized=!0,this.baseHeight=this.minimizedHeight):(this.minimized=!1,this.baseHeight=353):(!0===this.minimized&&(this.lastUnMinimizedTimer=performance.now()),this.baseHeight=353,this.minimized=!1),this.buttonAlpha=1,this.initRenderTimer<180&&(this.initRenderTimer+=t,this.h=Math.max(.01,this.baseHeight*easeOutCubic(this.initRenderTimer/180))),performance.now()-this.lastUnMinimizedTimer<160&&(this.h=this.minimizedHeight+20+(this.baseHeight-this.minimizedHeight)*easeOutCubic((performance.now()-this.lastUnMinimizedTimer)/160)),void 0!==window.squadUICloseTime&&!0===window.squadUIEnabled){const t=performance.now()-window.squadUICloseTime;t<180?(this.buttonAlpha=Math.max(0,this.h/this.baseHeight),this.h=(1-easeOutCubic(t/180))*this.baseHeight):t<1e3?(this.buttonAlpha=0,delete window.squadUICloseTime,this.initRenderTimer=0,window.squadUIEnabled=!1):delete window.squadUICloseTime}if(this.initRenderTimer>=180&&performance.now()-this.lastUnMinimizedTimer>=160&&!window.squadUICloseTime&&(this.h=interpolate(this.h,this.baseHeight,.25)),this.x=interpolate(this.x,canvas.w/2-71,.01*t),window.squadTimer?this.timerX=interpolate(this.timerX,this.w/12,.01*t):this.timerX=interpolate(this.timerX,0,.01*t),ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=5,this.timerX>.01){const t=canvas.h/2+20,e=t,i=t+284,a=i-e;let s=this.x-this.w/2-this.timerX;ctx.beginPath(),ctx.roundRect(s,e,this.w/16,a,0),ctx.fill(),ctx.stroke(),ctx.closePath();let n=(window.squadTimer-Date.now())/5e3;ctx.save();let l=Math.max(0,(1-n)*(a-20));const r=8;ctx.lineWidth=5,ctx.strokeStyle="#333333",ctx.fillStyle="#333333",ctx.beginPath(),ctx.roundRect(s+10,i-r,this.w/16-20,20-a,3),ctx.stroke(),ctx.fill(),ctx.closePath(),ctx.fillStyle=blendColor("#75dd34","#dd3434",n),ctx.beginPath(),ctx.roundRect(s+10,i-r,this.w/16-20,-l,3),ctx.fill(),ctx.closePath(),ctx.restore()}const e=Math.max(0,Math.min(1,this.h/this.baseHeight));(this.desiredSWS>1||this.startingWaveSlider>1)&&(this.desiredSWS=Math.min(1,this.desiredSWS),this.startingWaveSlider=Math.min(1,this.startingWaveSlider));const i=performance.now();ctx.globalAlpha=this.buttonAlpha;for(let a=0;a<this.clients.length;a++)!0!==this.minimized&&this.renderPlayerCard(a,e,i,t);if(!1===this.minimized&&this.clients.length<4)for(let t=this.clients.length;t<4;t++)this.renderEmptySlot(t,e);(this.clients.length>0||!0===window.squadUIEnabled)&&!1===this.minimized&&this.renderSideButtons(e),ctx.globalAlpha=1,!1===this.public&&(ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=3,ctx.textAlign="right",ctx.textBaseline="bottom",ctx.strokeText("(Private)",this.x+this.w/2-7.5,canvas.h/2+this.h-7.5+30),ctx.fillText("(Private)",this.x+this.w/2-7.5,canvas.h/2+this.h-7.5+30),ctx.textAlign="center",ctx.textBaseline="middle"),this.clients.length>4&&this.renderOverfullWarning(),ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=5,ctx.globalAlpha=1}renderTopButtons(t){ctx.fillStyle="#c1565e",ctx.strokeStyle="#90464b",ctx.lineWidth=5,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30,canvas.h/2+30+7.5,30,30*t,3),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.lineCap="round",ctx.strokeStyle="#cccccc",ctx.beginPath(),ctx.moveTo(this.x+this.w/2-7.5-30+7.5,canvas.h/2+30+7.5*t+7.5),ctx.lineTo(this.x+this.w/2-7.5-7.5,canvas.h/2+30+7.5*t-7.5+15+15*t),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(this.x+this.w/2-7.5-7.5,canvas.h/2+30+7.5*t+7.5),ctx.lineTo(this.x+this.w/2-7.5-30+7.5,canvas.h/2+7.5*t-7.5+15+30+15*t),ctx.stroke(),ctx.closePath(),this.hoveringOverX=!1,mouse.canvasX>this.x+this.w/2-7.5-30&&mouse.canvasY>canvas.h/2+30+7.5&&mouse.canvasX<this.x+this.w/2-7.5&&mouse.canvasY<canvas.h/2+30+7.5+30*t&&(ctx.fillStyle="white",ctx.globalAlpha=.1,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-ctx.lineWidth/2,canvas.h/2+30+7.5-ctx.lineWidth/2,30+ctx.lineWidth,30*t+ctx.lineWidth,3),ctx.fill(),ctx.closePath(),ctx.globalAlpha=1,this.hoveringOverX=!0)}renderSideButtons(t){this.hoveringOverPrivate=!1,this.hoveringOverPublic=!1,this.hoveringOverNew=!1,this.hoveringOverReady=!1;const e=this.x+this.w/2-1;ctx.letterSpacing="-.05px",ctx.font="900 20px 'Ubuntu'",ctx.textAlign="center",ctx.textBaseline="middle";const i=48.75,a=this.getCardY(0);for(let s=0;s<3;s++){const n=a+60.75*s,l=["Private","Find Pub","New"][s],r=["private","public","new"][s];this.renderSideButton(l,e,n,125,i,t,r)}const s=a+260+24-i,n=`Player: ${this.clients.length}/4`,l=s-20;ctx.fillStyle="#ffffff",ctx.font="900 20px 'Ubuntu'",ctx.textAlign="center",ctx.fillText(n,e+62.5,l);const r=window.ready?"Unready":"Ready",h=window.ready?"#d11d1d":"#1dd129";this.renderSideButton(r,e,s,125,i,t,"ready",h)}renderSideButton(t,e,i,a,s,n,l,r=null){ctx.save();const h=s;if(r?(ctx.fillStyle=r,ctx.strokeStyle="#d11d1d"===r?"#8f1515":"#149917"):(ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac"),ctx.lineWidth=4,ctx.beginPath(),ctx.roundRect(e,i,a,h,5),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=2,ctx.strokeText(t,e+a/2,i+h/2),ctx.fillText(t,e+a/2,i+h/2),mouse.canvasX>e&&mouse.canvasX<e+a&&mouse.canvasY>i&&mouse.canvasY<i+h)switch(ctx.fillStyle="white",ctx.globalAlpha=.1,ctx.beginPath(),ctx.roundRect(e-ctx.lineWidth/2,i-ctx.lineWidth/2,a+ctx.lineWidth,h+ctx.lineWidth,5),ctx.fill(),ctx.closePath(),l){case"private":this.hoveringOverPrivate=!0;break;case"public":this.hoveringOverPublic=!0;break;case"new":this.hoveringOverNew=!0;break;case"ready":this.hoveringOverReady=!0}ctx.restore()}renderPlayerCard(t,e,i,a){const s=this.clients[t];if(!s)return;ctx.save();const n=this.x-this.w/2+16,l=this.getCardY(t),r=this.w-32;i-s.creationTime<400&&(ctx.globalAlpha=this.buttonAlpha*easeOutCubic((i-s.creationTime)/400),ctx.translate(0,20*-(1-easeOutCubic((i-s.creationTime)/400)))),ctx.fillStyle="#5a8bc7",ctx.strokeStyle="#4a7ab0",ctx.lineWidth=3,ctx.beginPath(),ctx.roundRect(n,l,r,65,5),ctx.fill(),ctx.stroke(),ctx.closePath();const h=s.flower,c=l+32.5,d=l+7+25.5;h.render.headX=n+12+20,h.render.headY=c,h.headX=h.render.headX,h.headY=h.render.headY,h.x=h.render.headX,h.y=h.render.headY,h.render.x=h.x,h.render.y=h.y,h.render.baseX=h.x,h.render.baseY=h.y,h.baseX=h.x,h.baseY=h.y,ctx.save(),ctx.translate(h.render.headX,h.render.headY),ctx.scale(.8,.8),ctx.translate(-h.render.headX,-h.render.headY),h.drawFlower(h.render.headX,h.render.headY,25,h.character),ctx.restore(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.letterSpacing="-.05px",ctx.lineWidth=3,ctx.textAlign="left",ctx.textBaseline="middle",ctx.font="900 20px 'Ubuntu'";const o=""===s.name?"Unnamed":s.name,x=n+12+40+10;let g;g=s.id===this.selfId?l+18:l+22,ctx.strokeText(o,x,g),ctx.fillText(o,x,g);const f=this.getPetalSlotsBounds(t).x-20,u=d;if(ctx.beginPath(),ctx.arc(f,u,8,0,2*Math.PI),ctx.fillStyle="transparent",ctx.strokeStyle="#888888",ctx.lineWidth=2,ctx.stroke(),ctx.closePath(),!0===s.ready||i-s.lastReadyDisableTime<600){if(ctx.beginPath(),ctx.translate(f,u),i-s.lastReadyEnableTime<600){const t=easeOutCubic((i-s.lastReadyEnableTime)/600);ctx.rotate(2*Math.PI*t),ctx.globalAlpha=this.buttonAlpha*t}if(i-s.lastReadyDisableTime<600){const t=1-easeOutCubic((i-s.lastReadyDisableTime)/600);ctx.rotate(2*-Math.PI*t),ctx.globalAlpha=this.buttonAlpha*t}if(ctx.moveTo(-7.5,.5),ctx.lineTo(-3.5,7.5),ctx.lineTo(7.5,-7.5),ctx.strokeStyle="black",ctx.lineWidth=5,ctx.stroke(),ctx.strokeStyle="#1dd129",ctx.lineWidth=2,ctx.stroke(),i-s.lastReadyDisableTime<600){const t=1-easeOutCubic((i-s.lastReadyDisableTime)/600);ctx.rotate(2*Math.PI*t),ctx.globalAlpha=1*this.buttonAlpha}if(i-s.lastReadyEnableTime<600){const t=easeOutCubic((i-s.lastReadyEnableTime)/600);ctx.rotate(2*-Math.PI*t),ctx.globalAlpha=1*this.buttonAlpha}ctx.translate(-f,-u),ctx.closePath()}if(s.id===this.selfId){this.startingWaveSlider=interpolate(this.startingWaveSlider,this.desiredSWS,.22);const e=this.getSliderBounds(t),i=interpolate(e.x,e.x+e.w,this.startingWaveSlider);ctx.strokeStyle="#4a7ab0",ctx.lineWidth=4,ctx.beginPath(),ctx.moveTo(e.x,e.y+e.h/2),ctx.lineTo(e.x+e.w,e.y+e.h/2),ctx.stroke(),ctx.closePath(),ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=3,ctx.beginPath(),ctx.arc(i,e.y+e.h/2,8,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),(mouse.canvasX-i)**2+(mouse.canvasY-(e.y+e.h/2))**2<144?(ctx.fillStyle="white",ctx.globalAlpha=.2,ctx.beginPath(),ctx.arc(i,e.y+e.h/2,10,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.globalAlpha=this.buttonAlpha,this.hoveringOverSlider=!0):!0===this.draggingSlider&&(ctx.fillStyle="white",ctx.globalAlpha=.2,ctx.beginPath(),ctx.arc(i,e.y+e.h/2,10,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.globalAlpha=this.buttonAlpha),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=2,ctx.textAlign="left",ctx.textBaseline="middle",ctx.font="900 10px 'Ubuntu'",this.startingWave=Math.max(1,Math.round(this.maxStartingWave*this.startingWaveSlider));const a="Starting Wave: "+this.startingWave,s=l+65-18;ctx.strokeText(a,x,s),ctx.fillText(a,x,s);const n=ctx.measureText(a).width,r=14;this.swTextBounds={x,y:s-r/2,w:n,h:r},mouse.canvasX>this.swTextBounds.x&&mouse.canvasX<this.swTextBounds.x+this.swTextBounds.w&&mouse.canvasY>this.swTextBounds.y&&mouse.canvasY<this.swTextBounds.y+this.swTextBounds.h&&(this.hoveringOverSW=!0,setCursor("pointer"))}else{ctx.fillStyle="#cccccc",ctx.strokeStyle="black",ctx.lineWidth=2,ctx.textAlign="left",ctx.textBaseline="middle",ctx.font="900 10px 'Ubuntu'";const t="Starting Wave: "+Math.max(1,Math.ceil(s.startingWave));ctx.strokeText(t,x,l+65-18),ctx.fillText(t,x,l+65-18)}this.renderPetalSlots(s,t),this.renderArtifact(s,t),ctx.restore()}renderEmptySlot(t,e){ctx.save();const i=this.x-this.w/2+16,a=this.getCardY(t),s=this.w-32;ctx.globalAlpha=.5*this.buttonAlpha,ctx.fillStyle="#3a5a87",ctx.strokeStyle="#2a4a67",ctx.lineWidth=2,ctx.setLineDash([5,5]),ctx.beginPath(),ctx.roundRect(i,a,s,65,5),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.setLineDash([]),ctx.restore()}renderPetalSlots(t,e){const i=this.getPetalSlotsBounds(e),a=t.flower.petalContainers||[];for(let t=0;t<2;t++)for(let e=0;e<10;e++){const s=10*t+e,n=i.x+27*e,l=i.y+27*t;if(ctx.fillStyle="#3a6a9a",ctx.strokeStyle="#2a5a8a",ctx.lineWidth=1,ctx.beginPath(),ctx.roundRect(n,l,24,24,2),ctx.fill(),ctx.stroke(),ctx.closePath(),a[s]){const t=a[s];t.x=n+12,t.y=l+12,t.render.x=t.x,t.render.y=t.y,t.w=22,t.h=22,t.nameless=!0,t.spawnAnimation=1,t.draw()}}}renderArtifact(t,e){if(!t.artifactPetalContainer)return;const i=this.getArtifactBounds(e),a=t.artifactPetalContainer;a.x=i.x+i.w/2,a.y=i.y+i.h/2,a.render.x=a.x,a.render.y=a.y,a.w=i.w-2,a.h=i.h-2,a.nameless=!0,a.spawnAnimation=1,a.draw()}renderOverfullWarning(){ctx.textAlign="left",ctx.textBaseline="bottom",ctx.font="900 12px 'Ubuntu'",ctx.lineWidth=3,ctx.fillStyle="red";const t=this.getCardY(0)-5;ctx.strokeText("[OVERFULL]",this.x-this.w/2+7.5,t),ctx.fillText("[OVERFULL]",this.x-this.w/2+7.5,t),ctx.fillStyle="white";const e=["","125%","150%","175%","200%","225%","250%","275%","300%"],i=["","Lvl100","Lvl200","Lvl300","Lvl400","Lvl500","Lvl600","Lvl700","Lvl800"],a=Math.min(this.clients.length-4,e.length-1);ctx.strokeText(`${e[a]} mob health`,this.x-this.w/2+7.5,t+14),ctx.fillText(`${e[a]} mob health`,this.x-this.w/2+7.5,t+14),ctx.strokeText(`(${i[a]} feature)`,this.x-this.w/2+7.5,t+28),ctx.fillText(`(${i[a]} feature)`,this.x-this.w/2+7.5,t+28),ctx.textAlign="center",ctx.textBaseline="middle"}getButtonAtPosition(t,e){if((this.clients.length>0||!0===window.squadUIEnabled)&&!1===this.minimized){const i=125,a=48.75,s=12,n=this.x+this.w/2-1,l=this.getCardY(0);for(let r=0;r<3;r++){const h=l+r*(a+s);if(t>=n&&t<=n+i&&e>=h&&e<=h+a)return["private","public","new"][r]}const r=l+260+24-a;if(t>=n&&t<=n+i&&e>=r&&e<=r+a)return"ready"}return null}createClient(t){const e={creationTime:performance.now(),flower:new Flower(t)},i=e.flower,a=this.x-this.w/2+16,s=this.getCardY(this.clients.length)+7+25.5;return i.petalContainers=new Array(20).fill(null),i.render.headX=a+12+20,i.render.headY=s,i.headX=i.render.headX,i.headY=i.render.headY,i.x=i.render.headX,i.y=i.render.headY,i.render.x=i.x,i.render.y=i.y,i.render.baseX=i.x,i.render.baseY=i.y,i.baseX=i.x,i.baseY=i.y,e}addClient(t){const e=this.clients.find(e=>e.id===t.id);if(e){for(let i in t)e[i]=t[i];return e.flower.character=t.character,e.startingWave=t.sw,e.flower.dev=t.dev,delete e.sw,t.petals&&this.updateFlowerPetals(t.petals,e.id,!0),t.offPetals&&this.updateFlowerOffPetals(t.offPetals,e.id,!0),t.equippedArtifacts&&(e.equippedArtifacts=t.equippedArtifacts,this.updateClientArtifact(e)),void(t.id===this.selfId&&(this.maxStartingWave=t.maxSW,null!==savedStartingWave&&savedStartingWave<=this.maxStartingWave?(this.desiredSWS=savedStartingWave/this.maxStartingWave,send({sw:savedStartingWave})):(this.desiredSWS=1,null!==savedStartingWave&&(localStorage.removeItem("startingWave"),savedStartingWave=null))))}this.clients.push(this.createClient(t.id));const i=this.clients[this.clients.length-1];for(let e in t)i[e]=t[e];i.flower.character=t.character,i.startingWave=t.sw,i.flower.dev=t.dev,delete i.sw,t.petals&&this.updateFlowerPetals(t.petals,i.id,!1),t.offPetals&&this.updateFlowerOffPetals(t.offPetals,i.id,!0),t.equippedArtifacts&&(i.equippedArtifacts=t.equippedArtifacts,this.updateClientArtifact(i)),t.id===this.selfId&&(this.maxStartingWave=t.maxSW,null!==savedStartingWave&&savedStartingWave<=this.maxStartingWave?(this.desiredSWS=savedStartingWave/this.maxStartingWave,send({sw:savedStartingWave})):(this.desiredSWS=1,null!==savedStartingWave&&(localStorage.removeItem("startingWave"),savedStartingWave=null)))}updateClientArtifact(t){if(!t.equippedArtifacts||0===t.equippedArtifacts.length)return void(t.artifactPetalContainer=null);const e=t.equippedArtifacts[0],i=t.equippedArtifactLevel||0,a=Stats.rarities.length-1,s=Math.min(Math.max(i,0),a),n=new Petal({type:e,rarity:s,x:0,y:0,distance:0,angle:0,maxHp:1e30,hp:1e30,maxReload:3,reload:3,damage:0});t.artifactPetalContainer=new PetalContainer([n],{x:0,y:0,w:51,h:51,originalX:0,originalY:0,radius:25.5,toOscillate:!1},`${e}_squad`,1,0),t.artifactPetalContainer.spawnAnimation=1}updateStartingWave(t,e,i,a=!1){if(t===this.selfId)a&&void 0!==i?(this.maxStartingWave=i,this.startingWave=Math.min(e,i),this.desiredSWS=this.startingWave/i):this.startingWave=Math.min(e,this.maxStartingWave);else{const i=this.findClient(t);i.startingWave=Math.min(e,i.maxSW||e)}}removeClient(t){for(let e=0;e<this.clients.length;e++)if(this.clients[e].id===t)return void this.clients.splice(e,1)}findClient(t){for(let e=0;e<this.clients.length;e++)if(this.clients[e].id===t)return this.clients[e];return{}}}