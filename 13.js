let savedStartingWave=localStorage.getItem("startingWave");"string"==typeof savedStartingWave&&(savedStartingWave=parseInt(savedStartingWave)),isNaN(savedStartingWave)&&(savedStartingWave=1);const outsidePadding=16,playerPadding=10,buttonPadding=10;class SquadUI{constructor(){this.clients=[],this.w=446,this.h=0,this.x=canvas.w/2,this.timerX=0,this.minimizedHeight=46,this.baseHeight=this.h,this.minimized=!0,this.initRenderTimer=0,this.hoveringOverX=!1,this.hoveringOverPublic=!1,this.hoveringOverNew=!1,this.hoveringOverPrivate=!1,this.hoveringOverQuickJoin=!1,this.hoveringOverJoinMainPvp=!1,this.public=!0,this.selfId=null,this.startingWaveSlider=1,this.desiredSWS=1,this.draggingSlider=!1,this.maxStartingWave=1,this.startingWave=this.maxStartingWave,this.isCustomCode=!1,this.is1v1=!1}reset(){this.clients=[],this.is1v1=!1,this.hoveringOverX=!1,this.hoveringOverPublic=!1,this.hoveringOverNew=!1,this.hoveringOverPrivate=!1,this.hoveringOverQuickJoin=!1,this.hoveringOverJoinMainPvp=!1,this.public=!0,delete this.lastUnMinimizedTimer,delete window.squadUICloseTime,delete this.selfIdSentFlag,this.h=0}removeAllClients(){this.clients=[]}startGame(){this.hoveringOverX=!1,this.hoveringOverPublic=!1,this.hoveringOverNew=!1,this.hoveringOverPrivate=!1,this.hoveringOverQuickJoin=!1,this.hoveringOverJoinMainPvp=!1,this.clients=[],this.h=0,this.minimized=!0,window.squadUIEnabled=!1}recieveData(t){this.selfId=t.selfId;for(let e=0;e<t.clients.length;e++)this.addClient(t.clients[e]);if(this.clients.length>t.clients.length){for(let e=0;e<this.clients.length;e++)void 0===t.clients[e]&&(this.clients[e].removed=!0);this.clients=this.clients.filter(t=>!0!==t.removed)}!1===t.public?(this.public=!1,biomeManager.switchToBiome(t.biome)):this.public=!0,null!==savedStartingWave&&(this.desiredSWS=savedStartingWave/this.maxStartingWave)}updateFlowerPetals(t,e){if(e===this.selfId){if(!0===this.selfIdSentFlag)return;t.length>0&&(this.selfIdSentFlag=!0)}let i,s;for(let t=0;t<this.clients.length;t++)this.clients[t].id===e&&(s=this.clients[t],i=t);if(void 0===s)return;const a=s.flower;a.lastPetals=a.petals,a.petals=[];const h=(this.w-30-32)/4;a.render.headX=this.x-this.w/2+16+i*(h+10)+h/2,a.render.headY=canvas.h/2+this.h/2+35-9,a.headX=a.render.headX,a.headY=a.render.headY,a.x=a.render.headX,a.y=a.render.headY,a.render.x=a.x,a.render.y=a.y,a.render.baseX=a.x,a.render.baseY=a.y,a.baseX=a.x,a.baseY=a.y;for(let e=0;e<t.length;e++){const i=a.petals[e]=new Petal(t[e]);if(i.distance=neutralPetalDistance,i.render.distance=0,i.updateInterpolate(a),i.x=a.baseX,i.y=a.baseY,i.render.x=i.x,i.render.y=i.y,i.slowInterpolateDistance=!0,void 0!==a.lastPetals[e]){for(let t in a.lastPetals[e].render)i.render[t]=a.lastPetals[e].render[t];i.angle=i.render.angle}}this.updateFlowerPetalContainers(a),delete a.lastPetals}updateCharacter(t,e){let i,s;for(let t=0;t<this.clients.length;t++)this.clients[t].id===e&&(s=this.clients[t],i=t);if(void 0===s)return;s.flower.character=t}updateFlowerPetalContainers(t){t.petalContainers=[];let e=[];for(let i=0;i<t.petals.length;i++)if(t.petals[i].subId>0&&0===t.petals[i].subStackedId)t.petalContainers[t.petalContainers.length-1].petals.push(new Petal(t.petals[i]));else if(e.push(t.petals[i]),0===t.petals[i].subStackedId){t.petalContainers.push(new PetalContainer(e.map(t=>new Petal(t)),{x:0,y:0,w:20,h:20,originalX:0,originalY:0,radius:100,toRenderText:!1,toOscillate:!1},Math.random(),1)),e=[];const i=t.petalContainers[t.petalContainers.length-1];for(let t=0;t<i.petals.length;t++)i.petals[t].angle=0,i.petals[t].selfAngle=0}}updateSelfFlowerPetals(t){const e=this.findClient(this.selfId),i=e.flower;if(void 0===e||void 0===i)return;i.petals=[];for(let e in t.top){const s=t.top[e];for(let t=0;t<s.petals.length;t++){const a={...s.petals[t]};delete a.insidePetalContainer,a.petalContainerId=e,a.offset||(a.offset={angle:0,distance:0}),window.multiPetals&&void 0!==window.multiPetals[a.type]?a.subId=t:s.petals.length>1&&(a.subStackedId=t,a.subId=t,a.offset.angle=a.subStackedId/s.petals.length*Math.PI*2,a.offset.distance=a.radius),i.petals.push(new Petal(a));const h=i.petals[i.petals.length-1];h.distance=neutralPetalDistance,h.render.distance=0,h.updateInterpolate(i),h.x=i.baseX,h.y=i.baseY,h.render.x=h.x,h.render.y=h.y,h.slowInterpolateDistance=!0}}for(let e in t.bottom){const s=t.bottom[e];for(let t=0;t<s.petals.length;t++){const a={...s.petals[t]};delete a.insidePetalContainer,a.petalContainerId=e,a.offset||(a.offset={angle:0,distance:0}),window.multiPetals&&void 0!==window.multiPetals[a.type]?a.subId=t:s.petals.length>1&&(a.subStackedId=t,a.subId=t,a.offset.angle=a.subStackedId/s.petals.length*Math.PI*2,a.offset.distance=a.radius),i.petals.push(new Petal(a));const h=i.petals[i.petals.length-1];h.distance=neutralPetalDistance,h.render.distance=0,h.updateInterpolate(i),h.x=i.baseX,h.y=i.baseY,h.render.x=h.x,h.render.y=h.y,h.slowInterpolateDistance=!0}}const s=i.petals.filter(t=>0===t.subStackedId).length,a=Math.random()*Math.PI*2;let h=0;for(let t=0;t<i.petals.length;t++)0===i.petals[t].subStackedId&&h++,i.petals[t].id=t,i.petals[t].angle=h/s*Math.PI*2,i.petals[t].render.angle=a,i.petals[t].angleOffset=i.petals[t].angle;this.updateSelfFlowerPetalContainers(i)}updateSelfFlowerPetalContainers(t){const e=Object.values(menuInventory.topPetalContainers).concat(Object.values(menuInventory.bottomPetalContainers));t.petalContainers=e.map(t=>new PetalContainer(t.petals,{x:0,y:0,w:20,h:20,originalX:0,originalY:0,radius:100,toRenderText:!1,toOscillate:!1},Math.random(),1,0))}startSliderDrag(t){this.draggingSlider=!0,this.updateSliderDrag(t)}intersectingSlider({x:t,y:e}){let i=0;for(let t=0;t<this.clients.length;t++)if(this.clients[t].id===this.selfId){i=t;break}i=Math.min(3,i);const s=(this.w-30-32)/4,a=!0===this.isCustomCode?{x:this.x-this.w/2+16,y:canvas.h/2+30+16,w:this.w-76.8,h:this.h-32}:{x:this.x-this.w/2+16+i*(s+10)+5,y:canvas.h/2+35+.15*this.h+Math.max(0,.65*this.h-22),w:s-10,h:2*(.03*this.h+34)+6};return(t-interpolate(a.x,a.x+a.w,this.startingWaveSlider))**2+(e-(a.y+a.h/2))**2<225}intersectingSliderBound({x:t,y:e}){let i=0;for(let t=0;t<this.clients.length;t++)if(this.clients[t].id===this.selfId){i=t;break}i=Math.min(3,i);const s=(this.w-30-32)/4,a=!0===this.isCustomCode?{x:this.x-this.w/2+16,y:canvas.h/2+30+16,w:this.w-76.8,h:this.h-32}:{x:this.x-this.w/2+16+i*(s+10)+5,y:canvas.h/2+35+.15*this.h+Math.max(0,.65*this.h-22),w:s-10,h:2*(.03*this.h+34)+6};interpolate(a.x,a.x+a.w,this.startingWaveSlider);let h=t;return h<a.x&&(h=a.x),h>a.x+a.w&&(h=a.x+a.w),(t-h)**2+(e-(a.y+a.h/2))**2<225}updateSliderDrag(t){let e=0;for(let t=0;t<this.clients.length;t++)if(this.clients[t].id===this.selfId){e=t;break}e=Math.min(3,e);const i=(this.w-30-32)/4,s=!0===this.isCustomCode?{x:this.x-this.w/2+16,w:this.w-76.8}:{x:this.x-this.w/2+16+e*(i+10)+5,w:i-10};let a=t-s.x;a<0?a=0:a>s.w&&(a=s.w),this.desiredSWS=a/s.w}endSliderDrag(t){if(!1===this.draggingSlider)return;this.updateSliderDrag(t);const e=Math.max(1,Math.ceil(this.desiredSWS*this.maxStartingWave));send({sw:e}),this.draggingSlider=!1,e!==this.maxStartingWave?(localStorage.setItem("startingWave",e),savedStartingWave=e):(localStorage.removeItem("startingWave"),savedStartingWave=null)}sendSavedStartingWave(){null!==savedStartingWave&&send({sw:savedStartingWave})}render(t){this.is1v1=void 0!==biomeManager&&"1v1"===biomeManager.getCurrentBiome();if(0===this.clients.length?(this.minimized=!0,this.baseHeight=this.minimizedHeight):!1===this.isCustomCode&&(!0===this.minimized&&(this.lastUnMinimizedTimer=performance.now()),this.baseHeight=300,this.minimized=!1),this.buttonAlpha=1,this.initRenderTimer<180&&(this.initRenderTimer+=t,this.h=Math.max(.01,this.baseHeight*easeOutCubic(this.initRenderTimer/180))),performance.now()-this.lastUnMinimizedTimer<160&&(this.h=this.minimizedHeight+20+(280-this.minimizedHeight)*easeOutCubic((performance.now()-this.lastUnMinimizedTimer)/160),this.baseHeight=this.h),void 0!==window.squadUICloseTime&&(performance.now()-window.squadUICloseTime<180?(this.buttonAlpha=Math.max(0,this.h/this.baseHeight),this.h=(1-easeOutCubic((performance.now()-window.squadUICloseTime)/180))*this.baseHeight):(this.buttonAlpha=0,delete window.squadUICloseTime,this.initRenderTimer=0,window.squadUIEnabled=!1)),window.squadTimer?(this.x=interpolate(this.x,canvas.w/2+this.w/24,.01*t),this.timerX=interpolate(this.timerX,this.w/12,.01*t)):(this.x=interpolate(this.x,canvas.w/2,.01*t),this.timerX=interpolate(this.timerX,0,.01*t)),ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=5,this.timerX>.01){let t=!0===this.is1v1?208*(this.h-this.minimizedHeight)/280+this.minimizedHeight:this.h,e=this.x-this.w/2-this.timerX;ctx.beginPath(),ctx.roundRect(e,canvas.h/2+30,this.w/16,t,0),ctx.fill(),ctx.stroke(),ctx.closePath();let i=(window.squadTimer-Date.now())/5e3;ctx.save();let s=Math.max(0,(1-i)*t-20);ctx.lineWidth=5,ctx.strokeStyle="#333333",ctx.fillStyle="#333333",ctx.beginPath(),ctx.roundRect(e+10,canvas.h/2+(!0===this.is1v1?-40:20)+this.h,this.w/16-20,20-t,3),ctx.stroke(),ctx.fill(),ctx.closePath(),ctx.fillStyle=blendColor("#75dd34","#dd3434",i),ctx.beginPath(),ctx.roundRect(e+10,canvas.h/2+(!0===this.is1v1?-40:20)+this.h,this.w/16-20,-s,3),ctx.fill(),ctx.closePath(),ctx.restore()}ctx.fillStyle="#689ed6",ctx.beginPath(),ctx.roundRect(this.x-this.w/2,canvas.h/2+30,this.w,!0===this.is1v1?208*(this.h-this.minimizedHeight)/280+this.minimizedHeight:this.h,0),ctx.fill(),ctx.stroke(),ctx.closePath();const e=Math.max(0,Math.min(1,this.h/this.baseHeight));if(!0===this.isCustomCode){this.startingWaveSlider=interpolate(this.startingWaveSlider,this.desiredSWS,.22),ctx.lineWidth=5;let t=0;for(let e=0;e<this.clients.length;e++)if(this.clients[e].id===this.selfId){t=e;break}t=Math.min(3,t);const i={x:this.x-this.w/2+16,y:canvas.h/2+30+16,w:this.w-76.8,h:this.h-32},s=interpolate(i.x,i.x+i.w,this.startingWaveSlider),a={x:s,y:i.y+i.h/2};return ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.beginPath(),ctx.moveTo(i.x,i.y+i.h/2),ctx.lineTo(i.x+i.w,i.y+i.h/2),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.arc(s,i.y+i.h/2,12,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),(mouse.canvasX-a.x)**2+(mouse.canvasY-a.y)**2<225?(ctx.fillStyle="white",ctx.globalAlpha=.1,ctx.beginPath(),ctx.arc(s,i.y+i.h/2,12+ctx.lineWidth/2,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.globalAlpha=1,this.hoveringOverSlider=!0):!0===this.draggingSlider&&(ctx.fillStyle="white",ctx.globalAlpha=.1,ctx.beginPath(),ctx.arc(s,i.y+i.h/2,12+ctx.lineWidth/2,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.globalAlpha=1),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.letterSpacing="-.05px",ctx.lineWidth=3,ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="900 14px 'Ubuntu'",this.startingWave=Math.max(1,Math.ceil(this.maxStartingWave*this.startingWaveSlider)),ctx.globalAlpha=this.h/this.baseHeight,ctx.strokeText("Starting Wave: "+this.startingWave,i.x+i.w/2,i.y+19.5),ctx.fillText("Starting Wave: "+this.startingWave,i.x+i.w/2,i.y+19.5),ctx.globalAlpha=1,ctx.fillStyle="#c1565e",ctx.strokeStyle="#90464b",ctx.lineWidth=5,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30,canvas.h/2+30+7.5,30,30*e,3),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.lineCap="round",ctx.strokeStyle="#cccccc",ctx.beginPath(),ctx.moveTo(this.x+this.w/2-7.5-30+7.5,canvas.h/2+30+7.5*e+7.5),ctx.lineTo(this.x+this.w/2-7.5-7.5,canvas.h/2+30+7.5*e-7.5+15+15*e),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(this.x+this.w/2-7.5-7.5,canvas.h/2+30+7.5*e+7.5),ctx.lineTo(this.x+this.w/2-7.5-30+7.5,canvas.h/2+7.5*e-7.5+15+30+15*e),ctx.stroke(),ctx.closePath(),this.hoveringOverX=!1,void(mouse.canvasX>this.x+this.w/2-7.5-30&&mouse.canvasY>canvas.h/2+30+7.5&&mouse.canvasX<this.x+this.w/2-7.5&&mouse.canvasY<canvas.h/2+30+7.5+30*e&&(ctx.fillStyle="white",ctx.globalAlpha=.1,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-ctx.lineWidth/2,canvas.h/2+30+7.5-ctx.lineWidth/2,30+ctx.lineWidth,30*e+ctx.lineWidth,3),ctx.fill(),ctx.closePath(),ctx.globalAlpha=1,this.hoveringOverX=!0))}(this.desiredSWS>1||this.startingWaveSlider>1)&&(this.desiredSWS=Math.min(1,this.desiredSWS),this.startingWaveSlider=Math.min(1,this.startingWaveSlider));const i=(this.w-30-32)/4,s=performance.now();ctx.globalAlpha=this.buttonAlpha,!0===this.is1v1&&ctx.translate(i+10,0);for(let t=0;t<Math.max(!0===this.is1v1?2:4,this.clients.length);t++)if(!0!==this.minimized&&(ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=5,ctx.beginPath(),ctx.roundRect(this.x-this.w/2+16+t*(i+10),canvas.h/2+35+.15*this.h,i,Math.max(0,.65*this.h-22),1),ctx.fill(),ctx.stroke(),ctx.closePath(),void 0!==this.clients[t])){s-this.clients[t].creationTime<400&&(ctx.globalAlpha=this.buttonAlpha*easeOutCubic((s-this.clients[t].creationTime)/400),ctx.translate(0,-(1-easeOutCubic((s-this.clients[t].creationTime)/400))*this.h*.1)),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.letterSpacing="-.05px",ctx.lineWidth=3,ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=`900 ${18*e}px 'Ubuntu'`;const a=""===this.clients[t].name?"Unnamed":this.clients[t].name;let h=""===this.clients[t].username?"undefined":this.clients[t].username,l=ctx.measureText(a).width;l>i-20&&(ctx.font=`900 ${18*e*(i-20)/l}px 'Ubuntu'`,ctx.lineWidth=4*(i-20)/l),ctx.globalAlpha=.8*this.buttonAlpha,ctx.strokeText(a,this.x-this.w/2+16+t*(i+10)+i/2,canvas.h/2+35+.15*this.h+.05*this.h),ctx.globalAlpha=1*this.buttonAlpha,ctx.fillText(a,this.x-this.w/2+16+t*(i+10)+i/2,canvas.h/2+35+.15*this.h+.05*this.h),l=ctx.measureText(h).width,l>i-20&&(ctx.font=`900 ${14*e*(i-20)/l}px 'Ubuntu'`,ctx.lineWidth=4*(i-20)/l),ctx.fillStyle="#cccccc",ctx.globalAlpha=.8*this.buttonAlpha,ctx.strokeText(h,this.x-this.w/2+16+t*(i+10)+i/2,canvas.h/2+35+.15*this.h+.05*this.h+18),ctx.globalAlpha=1*this.buttonAlpha,ctx.fillText(h,this.x-this.w/2+16+t*(i+10)+i/2,canvas.h/2+35+.15*this.h+.05*this.h+18),ctx.globalAlpha=1*this.buttonAlpha,s-this.clients[t].creationTime<400&&ctx.translate(0,(1-easeOutCubic((s-this.clients[t].creationTime)/400))*this.h*.1)}ctx.globalAlpha=1,window.camera.disableCulling=!0;for(let e=0;e<Math.max(4,this.clients.length);e++){if(!0===this.minimized||void 0===this.clients[e])continue;const a=this.clients[e].flower,h={x:this.x-this.w/2+16+e*(i+10),y:canvas.h/2+35+.15*this.h+22+20,w:i,h:.6*this.h-22},l=4,n=20,c=2,r=5;Math.floor((a.petalContainers.length-1)/4);let x=0;for(let t=0;t<a.petalContainers.length;t++){for(;[9,10,13,14].includes(x);)x++;const e=a.petalContainers[t],i=Math.floor(x/4);e.y=h.y+n/2+c+(n+c)*i,e.x=r+n/2+h.x+x%l*(n+c),e.render.x=e.x,e.render.y=e.y,e.spawnAnimation=1,e.nameless=!0,e.draw(),x++}a.petalContainers=a.petalContainers.filter(t=>null===t.collectTime||performance.now()-t.collectTime<300);const o=this.clients[e];if(o&&o.artifactPetalContainer){const t=o.artifactPetalContainer;t.x=h.x+r+n/2,t.y=h.y+c-12,t.render.x=t.x,t.render.y=t.y,t.w=20,t.h=20,t.nameless=!0,t.draw()}if(a.render.headX=this.x-this.w/2+16+e*(i+10)+i/2,a.render.headY=canvas.h/2+this.h/2+35-9+20-7.5,a.headX=a.render.headX,a.headY=a.render.headY,a.x=a.render.headX,a.y=a.render.headY,a.render.x=a.x,a.render.y=a.y,a.render.baseX=a.x,a.render.baseY=a.y,a.baseX=a.x,a.baseY=a.y,a.petalRotation+=petalRotateSpeed/40*t,ctx.translate(a.render.headX,a.render.headY),ctx.scale(.8,.8),ctx.translate(-a.render.headX,-a.render.headY),!0===this.is1v1?a.angle=Math.atan2(mouse.canvasY-a.render.headY,mouse.canvasX-(i+10)-a.render.headX):a.angle=Math.atan2(mouse.canvasY-a.render.headY,mouse.canvasX-a.render.headX),mouseInBox({x:mouse.canvasX-(this.is1v1?i+10:0),y:mouse.canvasY},h)?(void 0===a.petalAlpha&&(a.petalAlpha=1),a.petalAlpha-=t/300,a.petalAlpha<.37&&(a.petalAlpha=.37)):void 0!==a.petalAlpha&&(a.petalAlpha+=t/300,a.petalAlpha>1&&delete a.petalAlpha),window.renderSquadPetals||(a.petals=[]),a.draw(),ctx.translate(a.render.headX,a.render.headY),ctx.scale(1.25,1.25),ctx.translate(-a.render.headX,-a.render.headY),this.clients[e].id!==this.selfId&&!1===this.is1v1){ctx.fillStyle="white",ctx.strokeStyle="black",ctx.letterSpacing="-.05px",ctx.lineWidth=3,ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="900 10px 'Ubuntu'";const t=Math.max(1,Math.ceil(this.clients[e].startingWave)),s={x:this.x-this.w/2+16+e*(i+10)+i/2,y:canvas.h/2+35+.15*this.h+Math.max(0,.65*this.h-22)-12};ctx.strokeText("Starting Wave: "+t,s.x,s.y),ctx.fillText("Starting Wave: "+t,s.x,s.y)}if(!0===this.clients[e].ready||s-this.clients[e].lastReadyDisableTime<600){if(ctx.beginPath(),ctx.translate(this.x-this.w/2+16+e*(i+10)+i-15-7.5,canvas.h/2+35+.15*this.h+.6*this.h-15-7.5-12),ctx.translate(7.5,7.5),s-this.clients[e].lastReadyEnableTime<600){const t=easeOutCubic((s-this.clients[e].lastReadyEnableTime)/600);ctx.rotate(2*Math.PI*t),ctx.globalAlpha=this.buttonAlpha*t}if(s-this.clients[e].lastReadyDisableTime<600){const t=1-easeOutCubic((s-this.clients[e].lastReadyDisableTime)/600);ctx.rotate(2*-Math.PI*t),ctx.globalAlpha=this.buttonAlpha*t}if(ctx.moveTo(-7.5,.5),ctx.lineTo(-3.5,7.5),ctx.lineTo(7.5,-7.5),ctx.strokeStyle="black",ctx.lineWidth=5,ctx.stroke(),ctx.strokeStyle="#1dd129",ctx.lineWidth=2,ctx.stroke(),s-this.clients[e].lastReadyDisableTime<600){const t=1-easeOutCubic((s-this.clients[e].lastReadyDisableTime)/600);ctx.rotate(2*Math.PI*t),ctx.globalAlpha=1*this.buttonAlpha}if(s-this.clients[e].lastReadyEnableTime<600){const t=easeOutCubic((s-this.clients[e].lastReadyEnableTime)/600);ctx.rotate(2*-Math.PI*t),ctx.globalAlpha=1*this.buttonAlpha}ctx.translate(-7.5,-7.5),ctx.translate(-(this.x-this.w/2+16+e*(i+10)+i-15-7.5),-(canvas.h/2+35+.15*this.h+.6*this.h-15-7.5-12)),ctx.closePath()}else(!0!==this.is1v1||!0===this.is1v1&&2===this.clients.length)&&delete window.squadTimer}if(!0===this.is1v1&&ctx.translate(-i-10,0),delete window.camera.disableCulling,ctx.globalAlpha=this.buttonAlpha,!0!==this.minimized&&!1===this.is1v1){this.startingWaveSlider=interpolate(this.startingWaveSlider,this.desiredSWS,.22),ctx.lineWidth=5;let t=0;for(let e=0;e<this.clients.length;e++)if(this.clients[e].id===this.selfId){t=e;break}t=Math.min(3,t);const e={x:this.x-this.w/2+16+t*(i+10)+5,y:canvas.h/2+35+.15*this.h+Math.max(0,.65*this.h-22),w:i-10,h:2*(.03*this.h+34)+6},s=interpolate(e.x,e.x+e.w,this.startingWaveSlider),a={x:s,y:e.y+e.h/2};ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.beginPath(),ctx.moveTo(e.x,e.y+e.h/2),ctx.lineTo(e.x+e.w,e.y+e.h/2),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.arc(s,e.y+e.h/2,12,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),(mouse.canvasX-a.x)**2+(mouse.canvasY-a.y)**2<225?(ctx.fillStyle="white",ctx.globalAlpha=.1,ctx.beginPath(),ctx.arc(s,e.y+e.h/2,12+ctx.lineWidth/2,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.globalAlpha=1,this.hoveringOverSlider=!0):!0===this.draggingSlider&&(ctx.fillStyle="white",ctx.globalAlpha=.1,ctx.beginPath(),ctx.arc(s,e.y+e.h/2,12+ctx.lineWidth/2,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.globalAlpha=1),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.letterSpacing="-.05px",ctx.lineWidth=3,ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="900 14px 'Ubuntu'",this.startingWave=Math.max(1,Math.ceil(this.maxStartingWave*this.startingWaveSlider)),ctx.strokeText("Starting Wave: "+this.startingWave,e.x+e.w/2,e.y+17),ctx.fillText("Starting Wave: "+this.startingWave,e.x+e.w/2,e.y+17)}ctx.fillStyle="#c1565e",ctx.strokeStyle="#90464b",ctx.lineWidth=5,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30,canvas.h/2+30+7.5,30,30*e,3),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.lineCap="round",ctx.strokeStyle="#cccccc",ctx.beginPath(),ctx.moveTo(this.x+this.w/2-7.5-30+7.5,canvas.h/2+30+7.5*e+7.5),ctx.lineTo(this.x+this.w/2-7.5-7.5,canvas.h/2+30+7.5*e-7.5+15+15*e),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(this.x+this.w/2-7.5-7.5,canvas.h/2+30+7.5*e+7.5),ctx.lineTo(this.x+this.w/2-7.5-30+7.5,canvas.h/2+7.5*e-7.5+15+30+15*e),ctx.stroke(),ctx.closePath(),this.hoveringOverX=!1,mouse.canvasX>this.x+this.w/2-7.5-30&&mouse.canvasY>canvas.h/2+30+7.5&&mouse.canvasX<this.x+this.w/2-7.5&&mouse.canvasY<canvas.h/2+30+7.5+30*e&&(ctx.fillStyle="white",ctx.globalAlpha=.1,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-ctx.lineWidth/2,canvas.h/2+30+7.5-ctx.lineWidth/2,30+ctx.lineWidth,30*e+ctx.lineWidth,3),ctx.fill(),ctx.closePath(),ctx.globalAlpha=1,this.hoveringOverX=!0),ctx.letterSpacing="-.05px",ctx.font=`900 ${16*e}px 'Ubuntu'`,ctx.textAlign="center",ctx.textBaseline="middle";const a=ctx.measureText("New").width;ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=5,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-a-30-7.5,canvas.h/2+30+7.5,30+a,30*e,3),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=.08866826452*a,ctx.strokeText("New",this.x+this.w/2-7.5-30-a-7.5-30+(30+a)/2,canvas.h/2+30+7.5+30*e/2),ctx.fillText("New",this.x+this.w/2-7.5-30-a-7.5-30+(30+a)/2,canvas.h/2+30+7.5+30*e/2),ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=5,mouse.canvasX>this.x+this.w/2-7.5-30-a-30-7.5&&mouse.canvasY>canvas.h/2+30+7.5&&mouse.canvasX<this.x+this.w/2-7.5-30-a-30-7.5+30+a&&mouse.canvasY<canvas.h/2+30+7.5+30*e?(ctx.fillStyle="white",ctx.globalAlpha*=.1,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-a-30-7.5-ctx.lineWidth/2,canvas.h/2+30+7.5-ctx.lineWidth/2,30+a+ctx.lineWidth,30*e+ctx.lineWidth,3),ctx.fill(),ctx.closePath(),ctx.globalAlpha=1*this.buttonAlpha,this.hoveringOverNew=!0):this.hoveringOverNew=!1,ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=5;const h=ctx.measureText("Find Public").width;ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5,canvas.h/2+30+7.5,30+h,30*e,3),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=.03603260836*h,ctx.strokeText("Find Public",this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5+(30+h)/2,canvas.h/2+30+7.5+30*e/2),ctx.fillText("Find Public",this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5+(30+h)/2,canvas.h/2+30+7.5+30*e/2),ctx.lineWidth=5,mouse.canvasX>this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5&&mouse.canvasY>canvas.h/2+30+7.5&&mouse.canvasX<this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5+30+h&&mouse.canvasY<canvas.h/2+30+7.5+30*e?(ctx.fillStyle="white",ctx.globalAlpha*=.1,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-ctx.lineWidth/2,canvas.h/2+30+7.5-ctx.lineWidth/2,30+h+ctx.lineWidth,30*e+ctx.lineWidth,3),ctx.fill(),ctx.closePath(),ctx.globalAlpha=1*this.buttonAlpha,this.hoveringOverPublic=!0):this.hoveringOverPublic=!1,ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=5;const l=ctx.measureText("Private").width;if(ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-(30+l)-7.5,canvas.h/2+30+7.5,30+l,30*e,3),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=3,ctx.strokeText("Private",this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-(30+l)-7.5+(30+l)/2,canvas.h/2+30+7.5+30*e/2),ctx.fillText("Private",this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-(30+l)-7.5+(30+l)/2,canvas.h/2+30+7.5+30*e/2),ctx.lineWidth=5,mouse.canvasX>this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-(30+l)&&mouse.canvasY>canvas.h/2+30+7.5&&mouse.canvasX<this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5+30+l-(30+l)&&mouse.canvasY<canvas.h/2+30+7.5+30*e?(ctx.fillStyle="white",ctx.globalAlpha=.1,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-(30+l)-7.5-ctx.lineWidth/2,canvas.h/2+30+7.5-ctx.lineWidth/2,30+l+ctx.lineWidth,30*e+ctx.lineWidth,3),ctx.fill(),ctx.closePath(),ctx.globalAlpha=1,this.hoveringOverPrivate=!0):this.hoveringOverPrivate=!1,!0===this.is1v1){ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=5;const t=ctx.measureText("Join Main").width;ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-(30+l)-7.5-(30+t)-7.5,canvas.h/2+30+7.5,30+t,30*e,3),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=3,ctx.strokeText("Join Main",this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-(30+l)-(30+t)-7.5-7.5+(30+t)/2,canvas.h/2+30+7.5+30*e/2),ctx.fillText("Join Main",this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-(30+l)-(30+t)-7.5-7.5+(30+t)/2,canvas.h/2+30+7.5+30*e/2),ctx.lineWidth=5,mouse.canvasX>this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-(30+l)-(30+t)-7.5&&mouse.canvasY>canvas.h/2+30+7.5&&mouse.canvasX<this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5+30+t-(30+l)-(30+t)-7.5&&mouse.canvasY<canvas.h/2+30+7.5+30*e?(ctx.fillStyle="white",ctx.globalAlpha=.1,ctx.beginPath(),ctx.roundRect(this.x+this.w/2-7.5-30-a-30-7.5-(30+h)-7.5-(30+l)-7.5-(30+t)-7.5,canvas.h/2+30+7.5,30+t,30*e,3),ctx.fill(),ctx.closePath(),ctx.globalAlpha=1,this.hoveringOverJoinMainPvp=!0):this.hoveringOverJoinMainPvp=!1}!1===this.public&&(ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=3,ctx.textAlign="right",ctx.textBaseline="bottom",ctx.strokeText("(Private)",this.x+this.w/2-7.5,canvas.h/2+this.h-7.5+30),ctx.fillText("(Private)",this.x+this.w/2-7.5,canvas.h/2+this.h-7.5+30),ctx.textAlign="center",ctx.textBaseline="middle"),this.clients.length>4&&(ctx.textAlign="left",ctx.textBaseline="bottom",ctx.font="900 12px 'Ubuntu'",ctx.lineWidth=3,ctx.fillStyle="red",ctx.strokeText("[OVERFULL]",this.x-this.w/2+7.5,canvas.h/2-7.5+58),ctx.fillText("[OVERFULL]",this.x-this.w/2+7.5,canvas.h/2-7.5+58),ctx.fillStyle="white",5==this.clients.length?(ctx.strokeText("125% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.fillText("125% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.strokeText("(Lvl100 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86),ctx.fillText("(Lvl100 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86)):6==this.clients.length?(ctx.strokeText("150% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.fillText("150% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.strokeText("(Lvl200 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86),ctx.fillText("(Lvl200 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86)):7==this.clients.length?(ctx.strokeText("175% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.fillText("175% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.strokeText("(Lvl300 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86),ctx.fillText("(Lvl300 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86)):this.clients.length>=8?(ctx.strokeText("200% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.fillText("200% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.strokeText("(Lvl400 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86),ctx.fillText("(Lvl400 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86)):this.clients.length>=9?(ctx.strokeText("225% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.fillText("225% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.strokeText("(Lvl500 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86),ctx.fillText("(Lvl500 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86)):this.clients.length>=10?(ctx.strokeText("250% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.fillText("250% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.strokeText("(Lvl600 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86),ctx.fillText("(Lvl600 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86)):this.clients.length>=11?(ctx.strokeText("275% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.fillText("275% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.strokeText("(Lvl700 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86),ctx.fillText("(Lvl700 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86)):this.clients.length>=12&&(ctx.strokeText("300% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.fillText("300% mob health",this.x-this.w/2+7.5,canvas.h/2-7.5+72),ctx.strokeText("(Lvl800 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86),ctx.fillText("(Lvl800 feature)",this.x-this.w/2+7.5,canvas.h/2-7.5+86)),ctx.textAlign="center",ctx.textBaseline="middle"),ctx.fillStyle="#689ed6",ctx.strokeStyle="#537fac",ctx.lineWidth=5,ctx.globalAlpha=1}createClient(t){const e={creationTime:performance.now(),flower:new Flower(t)},i=e.flower,s=(this.w-30-32)/4;return i.petalContainers=[],i.render.headX=this.x-this.w/2+16+this.clients.length*(s+10)+s/2,i.render.headY=canvas.h/2+this.h/2+35-9,i.headX=i.render.headX,i.headY=i.render.headY,i.x=i.render.headX,i.y=i.render.headY,i.render.x=i.x,i.render.y=i.y,i.render.baseX=i.x,i.render.baseY=i.y,i.baseX=i.x,i.baseY=i.y,e}addClient(t){const e=this.clients.find(e=>e.id===t.id);if(e){for(let i in t)e[i]=t[i];return e.flower.character=t.character,e.startingWave=t.sw,e.flower.dev=t.dev,delete e.sw,t.petals&&this.updateFlowerPetals(t.petals,e.id),t.equippedArtifacts&&(e.equippedArtifacts=t.equippedArtifacts,this.updateClientArtifact(e)),void(t.id===this.selfId&&(this.maxStartingWave=t.maxSW,this.desiredSWS=1))}this.clients.push(this.createClient(t.id));const i=this.clients[this.clients.length-1];for(let e in t)i[e]=t[e];i.flower.character=t.character,i.startingWave=t.sw,i.flower.dev=t.dev,delete i.sw,t.petals&&this.updateFlowerPetals(t.petals,i.id),t.equippedArtifacts&&(i.equippedArtifacts=t.equippedArtifacts,this.updateClientArtifact(i)),t.id===this.selfId&&(this.maxStartingWave=t.maxSW,this.desiredSWS=1)}updateClientArtifact(t){if(!t.equippedArtifacts||0===t.equippedArtifacts.length)return void(t.artifactPetalContainer=null);const e=t.equippedArtifacts[0],i=t.equippedArtifactLevel||0,s=new Petal({type:e,rarity:i,x:0,y:0,distance:0,angle:0,maxHp:1e30,hp:1e30,maxReload:3,reload:3,damage:0});t.artifactPetalContainer=new PetalContainer([s],{x:0,y:0,w:65,h:65,originalX:0,originalY:0,radius:32.5,toOscillate:!1},`${e}_squad`,1,0),t.artifactPetalContainer.spawnAnimation=1}updateStartingWave(t,e,i,s=!1){if(t===this.selfId)s&&void 0!==i?(this.maxStartingWave=i,this.startingWave=e,this.desiredSWS=e/i):this.startingWave=e;else{this.findClient(t).startingWave=e}}removeClient(t){for(let e=0;e<this.clients.length;e++)if(this.clients[e].id===t)return void this.clients.splice(e,1)}findClient(t){for(let e=0;e<this.clients.length;e++)if(this.clients[e].id===t)return this.clients[e];return{}}}