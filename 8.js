let currentBiome="";function getAngleOnSquare(e,t,a,i){let r,n,l=t-i/2,s=a-i/2,o=t,c=a,d=i,h=i,m=Math.atan2(c-s,l+d-o);return e<=Math.PI?e<Math.PI/2?e<m?(colX=l+d,r=Math.tan(e)*(d/2),colY=c-r):(colY=s,n=h/2/Math.tan(e),colX=o+n):e<Math.PI-m?(colY=s,n=h/2/Math.tan(Math.PI-e),colX=o-n):(colX=l,r=Math.tan(Math.PI-e)*(d/2),colY=c-r):e<3*Math.PI/2?e<m+Math.PI?(colX=l,r=Math.tan(e-Math.PI)*(d/2),colY=c+r):(colY=s+h,n=h/2/Math.tan(e-Math.PI),colX=o-n):e<2*Math.PI-m?(colY=s+h,n=h/2/Math.tan(2*Math.PI-e),colX=o+n):(colX=l+d,r=Math.tan(2*Math.PI-e)*(d/2),colY=c+r),{x:colX,y:colY}}class PetalContainer{constructor(e,{x:t,y:a,w:i,h:r,originalX:n,originalY:l,radius:s,toOscillate:o,isDragging:c,lastSlot:d,toRenderText:h,petalStats:m,customBiome:x},u,g,S){this.petals=e,this.petalStats=m;for(let e=0;e<this.petals.length;e++)this.petals[e].insidePetalContainer=!0;this.rarity=(this.petals[0]??{rarity:0}).rarity,this.type=(this.petals[0]??{type:"Basic"}).type,"Custom"!==this.type&&"CustomProjectile"!==this.type||(this.type=this.petals[0].customType),this.randomAngle=Math.random()*Math.PI*2,this.x=t,this.y=a,this.w=i,this.h=r,this.radius=s,this.render={x:n??this.x,y:l??this.y,w:this.w},this.amount=g,this.attempt=S,this.id=u,this.spawnAnimation=0,this.lastAmountChangedTime=-1e3,this.collectTime=null,this.toOscillate=!1!==o,!0===this.toOscillate&&(this.angleOffset=.05*Math.PI*(2*Math.random()-1)),this.creationTime=performance.now(),this.isDraggingPetalContainer=c??!1,!0===this.isDraggingPetalContainer&&(this.lastPetalSlot=d??{index:-1,top:!0}),void 0!==h&&(this.toRenderText=!1),this.isHovered=!1,this.statsBoxAlpha=0,this.statsBox=null,void 0!==x&&(this.customBiome=x,this.greyed=!1),this.generatedIn1v1=!1}get ecOverride(){return enemyOverrides[this.type]?enemyOverrides[this.type]:{}}generatePetalImage(e=62.5,t,a=!1){const i=t.data.override;let r=this.type,n=10,l=1.5,s=0,o=10,c=0,d=0;void 0!==i?.customName&&(r=i?.customName),void 0!==i?.petalSize&&(n=i?.petalSize),void 0!==i?.renderSize&&(l=i?.renderSize),void 0!==i?.mainAngle&&(s=i?.mainAngle),void 0!==i?.multiRadius&&(o=i?.multiRadius),void 0!==i?.multiAngle&&(c=i?.multiAngle),void 0!==i?.multiAdd&&(d=i?.multiAdd);const h={radius:n,angle:0,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:this.rarity,customType:this.type};let m=e/100;const x=Math.min(1,ctx.measureText("Starfis").width/ctx.measureText(r).width),u=t.data.count;if(i?.image&&!0!==a){let a=new Image;a.src=i.image,a.onload=()=>{const i=new OffscreenCanvas(e,e),h=i.getContext("2d"),g=ctx;if(ctx=h,ctx.lineCap="round",ctx.lineJoin="round",ctx.scale(m,m),ctx.translate(50,42.5),ctx.scale(l,l),ctx.rotate(s),u>1){const e=2*Math.PI/u;for(let t=0;t<u;t++)ctx.rotate(t*(e+d)),ctx.translate(o,0),ctx.rotate(c),ctx.scale(n/a.width,n/a.height),ctx.drawImage(a,-a.width/2,-a.height/2),ctx.scale(a.width/n,a.height/n),ctx.rotate(-c),ctx.translate(-o,0),ctx.rotate(-t*(e+d)-c)}else ctx.scale(n/a.width,n/a.height),ctx.drawImage(a,-a.width/2,-a.height/2),ctx.scale(a.width/n,a.height/n);ctx.rotate(-s),ctx.scale(1/l,1/l),ctx.translate(-50,-42.5),ctx.font=`900 ${22.5*x}px Ubuntu`,ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=3.25*x,ctx.beginPath(),ctx.strokeText(r,50,75),ctx.fillText(r,50,75),ctx.closePath(),ctx.scale(1/m,1/m),cachedImages.petals.live[`${this.type}${t.index}`]=i,ctx=g}}else{let i,n,g;if(!1===a?(i=new OffscreenCanvas(e,e),n=i.getContext("2d"),g=ctx,ctx=n):!0===this.imageLoaded&&(h.image=this.image,h.imageLoaded=this.imageLoaded,l=.38),ctx.setFillStyle=e=>{void 0===window.overrideBlendColor?ctx.fillStyle=e:ctx.fillStyle=blendColor(e,window.overrideBlendColor[1],window.overrideBlendColor[0])},ctx.setStrokeStyle=e=>{void 0===window.overrideBlendColor?ctx.strokeStyle=e:ctx.strokeStyle=blendColor(e,window.overrideBlendColor[1],window.overrideBlendColor[0])},ctx.setGlobalAlpha=(e,t=!1)=>{void 0===window.alphaMult||!0===t?ctx.globalAlpha=e:ctx.globalAlpha=window.alphaMult*e},ctx.setFillAlpha=e=>{ctx.fillOpacity=e},ctx.setStrokeAlpha=e=>{ctx.strokeOpacity=e},ctx.setLineWidth=e=>{ctx.lineWidth=e},ctx.lineCap="round",ctx.lineJoin="round",ctx.scale(m,m),ctx.translate(50,42.5),ctx.scale(l,l),ctx.rotate(s),u>1){const e=2*Math.PI/u;for(let t=0;t<u;t++)ctx.rotate(t*(e+d)),ctx.translate(o,0),ctx.rotate(c),petalRenderMap[this.type]?petalRenderMap[this.type](h):petalRenderMap.Custom(h),ctx.rotate(-c),ctx.translate(-o,0),ctx.rotate(-t*(e+d))}else petalRenderMap[this.type]?petalRenderMap[this.type](h):petalRenderMap.Custom(h);ctx.rotate(-s),ctx.scale(1/l,1/l),ctx.translate(-50,-42.5),ctx.font=`900 ${22.5*x}px Ubuntu`,ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=3.25*x,ctx.beginPath(),ctx.strokeText(r,50,75),ctx.fillText(r,50,75),ctx.closePath(),ctx.scale(1/m,1/m),!1===a?(cachedImages.petals.live[`${this.type}${t.index}`]=i,ctx=g):h.image&&(this.image=h.image,this.image.onload=()=>{this.imageLoaded=!0})}}generateNamelessPetalImage(e=62.5,t){const a=t.data.override;let i=10,r=1.5,n=0,l=10,s=0,o=0,c=null;void 0!==a?.petalSize&&(i=a?.petalSize),void 0!==a?.renderSize&&(r=a?.renderSize),void 0!==a?.mainAngle&&(n=a?.mainAngle),void 0!==a?.multiRadius&&(l=a?.multiRadius),void 0!==a?.multiAngle&&(s=a?.multiAngle),void 0!==a?.multiAdd&&(o=a?.multiAdd);const d={radius:i,angle:0,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:this.rarity,customType:this.type},h=e/100,m=t.data.count;if(a?.image){let c=new Image;c.src=a.image,c.onload=()=>{const a=new OffscreenCanvas(e,e),d=a.getContext("2d"),x=ctx;if(ctx=d,ctx.lineCap="round",ctx.lineJoin="round",ctx.scale(h,h),ctx.translate(50,50),ctx.scale(r,r),ctx.rotate(n),m>1){const e=2*Math.PI/m;for(let t=0;t<m;t++)ctx.rotate(t*(e+o)),ctx.translate(l,0),ctx.rotate(s),ctx.scale(i/c.width,i/c.height),ctx.drawImage(c,-c.width/2,-c.height/2),ctx.scale(c.width/i,c.height/i),ctx.rotate(-s),ctx.translate(-l,0),ctx.rotate(-t*(e+o)-s)}else ctx.scale(i/c.width,i/c.height),ctx.drawImage(c,-c.width/2,-c.height/2),ctx.scale(c.width/i,c.height/i);ctx.rotate(-n),ctx.scale(1/r,1/r),ctx.translate(-50,-50),ctx.scale(1/h,1/h),cachedImages.petals.live[`${this.type}${t.index}nameless`]=a,ctx=x}}else{const a=new OffscreenCanvas(e,e),i=a.getContext("2d"),c=ctx;if(ctx=i,ctx.setFillStyle=e=>{void 0===window.overrideBlendColor?ctx.fillStyle=e:ctx.fillStyle=blendColor(e,window.overrideBlendColor[1],window.overrideBlendColor[0])},ctx.setStrokeStyle=e=>{void 0===window.overrideBlendColor?ctx.strokeStyle=e:ctx.strokeStyle=blendColor(e,window.overrideBlendColor[1],window.overrideBlendColor[0])},ctx.setGlobalAlpha=(e,t=!1)=>{void 0===window.alphaMult||!0===t?ctx.globalAlpha=e:ctx.globalAlpha=window.alphaMult*e},ctx.setFillAlpha=e=>{ctx.fillOpacity=e},ctx.setStrokeAlpha=e=>{ctx.strokeOpacity=e},ctx.setLineWidth=e=>{ctx.lineWidth=e},ctx.lineCap="round",ctx.lineJoin="round",ctx.scale(h,h),ctx.translate(50,50),ctx.scale(r,r),ctx.rotate(n),m>1){const e=2*Math.PI/m;for(let t=0;t<m;t++)ctx.rotate(t*(e+o)),ctx.translate(l,0),ctx.rotate(s),petalRenderMap[this.type]?petalRenderMap[this.type](d):petalRenderMap.Custom(d),ctx.rotate(-s),ctx.translate(-l,0),ctx.rotate(-t*(e+o))}else petalRenderMap[this.type]?petalRenderMap[this.type](d):petalRenderMap.Custom(d);ctx.rotate(-n),ctx.scale(1/r,1/r),ctx.translate(-50,-50),ctx.scale(1/h,1/h),cachedImages.petals.live[`${this.type}${t.index}nameless`]=a,ctx=c}}generateEnemyImage(e=62.5){const t=new OffscreenCanvas(e,e),a=t.getContext("2d"),i=ctx;ctx=a;const r=this.ecOverride;let n=this.type,l=25,s=1,o=-3*Math.PI/4,c=null;r?.customName&&(n=r?.customName),r?.enemySize&&(l=r?.enemySize),r?.renderSize&&(s=r?.renderSize),r?.angle&&(o=r?.angle),r?.customRender&&(c=r?.customRender);const d={render:{radius:l,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:l,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0,isInEnemyBox:!0,customType:this.type},h=e/100;ctx.setFillStyle=e=>{void 0===window.overrideBlendColor?ctx.fillStyle=e:ctx.fillStyle=blendColor(e,window.overrideBlendColor[1],window.overrideBlendColor[0])},ctx.setStrokeStyle=e=>{void 0===window.overrideBlendColor?ctx.strokeStyle=e:ctx.strokeStyle=blendColor(e,window.overrideBlendColor[1],window.overrideBlendColor[0])},ctx.setGlobalAlpha=(e,t=!1)=>{void 0===window.alphaMult||!0===t?ctx.globalAlpha=e:ctx.globalAlpha=window.alphaMult*e},ctx.setFillAlpha=e=>{ctx.fillOpacity=e},ctx.setStrokeAlpha=e=>{ctx.strokeOpacity=e},ctx.setLineWidth=e=>{ctx.lineWidth=e},ctx.lineCap="round",ctx.lineJoin="round",ctx.scale(h,h),ctx.translate(50,50),ctx.scale(s,s),ctx.rotate(o),c?c():enemyRenderMap[this.type]?(enemyDataMap[this.type]&&(d.data=enemyDataMap[this.type](d)),enemyRenderMap[this.type](d)):enemyRenderMap.Custom(d),ctx.rotate(-o),ctx.scale(1/s,1/s),ctx.translate(-50,-50),ctx.scale(1/h,1/h),cachedImages.enemies[`${this.type}`]=t,ctx=i}updateInterpolate(){this.render.x=interpolate(this.render.x,this.x,.00672*dt),this.render.y=interpolate(this.render.y,this.y,.00672*dt),this.render.w=interpolate(this.render.w,this.w,.00672*dt),this.collectTime?this.spawnAnimation=interpolate(this.spawnAnimation,0,.00672*dt):this.spawnAnimation=interpolate(this.spawnAnimation,1,.00672*dt)}drawStatsBox(e=!1,t,a=this.render.x,i=this.render.y){if(!1===window.statBoxes)return;if(this.statsBoxAlpha<.1&&!this.isHovered)return void(this.statsBoxAlpha=0);let r="petals";1==t&&(r="enemies");let n;if(["Abyssal Artifact","Scorched Artifact","Verdant Artifact","Cosmic Artifact"].includes(this.type))try{n=new StatsBox(this.type,this.petalStats,r,this.amount,this.rarity),delete n.image;const e=ctx,t=document.createElement("canvas");ctx=t.getContext("2d"),n.draw(),ctx=e}catch(e){n=null}else n=cachedImages.statBoxes[r][`${this.type}`],n&&n.amount===this.amount&&n.rarity===this.rarity||(n=void 0,cachedImages.statBoxes[r][`${this.type}`]=new StatsBox(this.type,this.petalStats,r,this.amount,this.rarity));!0===this.isHovered?(this.statsBoxAlpha+=.15*dt/18,this.statsBoxAlpha>1&&(this.statsBoxAlpha=1)):this.statsBoxAlpha>.1&&(this.statsBoxAlpha-=.15*dt/18,this.statsBoxAlpha<0&&(this.statsBoxAlpha=0)),0!==this.statsBoxAlpha&&n&&(n.y=e?i+this.h/2+11.5:i-n.h-this.h/2-11.5,n.x=a,ctx.globalAlpha=this.statsBoxAlpha,n.draw(),ctx.globalAlpha=1),this.isHovered=!1,this.statsBox&&!0===this.statsBox.shouldRegenPC&&(this.statsBox.shouldRegenPC=!1)}draw(e,t){if(this.updateInterpolate(),!0===this.toOscillate&&!1===toRender({x:this.render.x,y:this.render.y,radius:this.radius},window.camera)&&!0!==this.toSkipCulling)return;const a=smoothstep(this.spawnAnimation);let i,r=1,n=0;if(ctx.lastTransform=ctx.getTransform(),ctx.translate(this.render.x,this.render.y),r*=a*this.render.w/50,n-=(1-a)*Math.PI*3,!0===this.isDraggingPetalContainer?(void 0===this.draggingTimer&&(this.draggingTimer=0),this.draggingTimer+=1e3/30*dt/16.66,n+=.28*Math.sin(this.draggingTimer/280),this!==draggingPetalContainer&&(this.isDraggingPetalContainer=!1,this.undraggingPetalContainerTimer=30,this.lastDraggingAngle=.28*Math.sin(this.draggingTimer/280))):void 0!==this.undraggingPetalContainerTimer&&void 0===this.interval&&(this.lastDraggingAngle=interpolate(this.lastDraggingAngle,0,.15),n+=this.lastDraggingAngle,this.undraggingPetalContainerTimer--,this.undraggingPetalContainerTimer<0&&(delete this.undraggingPetalContainerTimer,delete this.lastDraggingAngle,delete this.draggingTimer)),!0===this.toOscillate&&(r*=1+Math.sin(performance.now()/1e3/.076)/52,n+=this.angleOffset),0!==n&&ctx.rotate(n),1!==r&&ctx.scale(r,r),!0===this.toOscillate&&!0!==this.isDisplayPetalContainer&&(ctx.globalAlpha=.3,ctx.fillStyle="black",ctx.beginPath(),ctx.roundRect(-30,-30,60,60,5),ctx.fill(),ctx.closePath(),ctx.globalAlpha=1),ctx.lineWidth=4.5,currentBiome=biomeManager.getCurrentBiome(),this.greyed=void 0!==this.customBiome&&!0===window.officialBiomes.includes(currentBiome),"soccer petal"===this.type&&"Soccer!"!==currentBiome&&(this.greyed=!0),this.greyed?(ctx.globalAlpha=.3,ctx.fillStyle="#525252",ctx.strokeStyle="#404040"):(ctx.fillStyle=Colors.rarities[this.rarity].color,ctx.strokeStyle=Colors.rarities[this.rarity].border,staticGradients[this.rarity]&&(ctx.fillStyle=staticGradients[this.rarity])),"1v1"===currentBiome&&!1===this.generatedIn1v1||"1v1"!==currentBiome&&!0===this.generatedIn1v1){let e;e="1v1"===currentBiome?pvpStats:Stats,e=0!==this.petals.length&&void 0!==this.petals[0].team?e.enemies:e.petals;let t=0;if(void 0!==e[this.type]&&void 0!==e[this.type][this.rarity]){const a=e[this.type][this.rarity].petalLayout;if(void 0===a)t=1;else for(let e=0;e<a.length;e++)for(let i=0;i<a[e].length;i++)t++}else t=1;if(t<this.petals.length)this.petals.length=t;else for(;this.petals.length<t;)this.petals.push(new Petal(this.petals[Math.floor(Math.random()*this.petals.length)]));this.generatedIn1v1=!this.generatedIn1v1}if(void 0!==Colors.rarities[this.rarity].fancy&&1==window.hqp&&(i=this.rarity<=23?ctx.createLinearGradient(-30,-30,30,30):this.rarity<=25?ctx.createLinearGradient(30,30,-30,-30):this.rarity<=29?ctx.createRadialGradient(0,0,0,0,0,30):ctx.createRadialGradient(0,0,30,0,0,0),createFancyGradient(i,this.rarity),ctx.fillStyle=i,ctx.strokeStyle=Colors.rarities[this.rarity].fancy.border),"Shattered Relic of Wrath"!==this.type&&"Reinforced Relic of Wrath"!==this.type&&"Subset Relic of the Guardian"!==this.type&&"Division Relic of the Guardian"!==this.type&&"Guard Relic of the Guardian"!==this.type&&"Knight Relic of the Guardian"!==this.type&&"Aid Relic of Serenity"!==this.type&&"Subliminal Relic of Serenity"!==this.type&&"Barrier Relic of Serenity"!==this.type&&"Token"!==this.type||0!=this.rarity||(ctx.fillStyle=`hsl(${time/10%360}, 30%, 60%)`,ctx.strokeStyle=`hsl(${time/10%360}, 50%, 40%)`),ctx.beginPath(),ctx.roundRect(-25,-25,50,50,.25),ctx.fill(),ctx.closePath(),void 0!==Colors.rarities[this.rarity].fancy&&void 0!==Colors.rarities[this.rarity].fancy.stars&&1==window.hqp){if(ctx.beginPath(),ctx.roundRect(-27.25,-27.25,54.5,54.5,1),ctx.closePath,!this.stars){this.stars=[];for(let e=0;e<Colors.rarities[this.rarity].fancy.stars;e++)this.stars.push({x:50*Math.random()-25,y:50*Math.random()-25})}ctx.fillStyle="#ffffff";for(let e of this.stars)if(e.x+=.1,e.y+=.1,(e.x>25||e.y>25)&&(e.x=800*Math.random()-20-30,e.y=-30),e.x<25&&e.x>-25&&e.y<25&&e.y>-25){ctx.beginPath();var l=ctx.createRadialGradient(e.x,e.y,15,e.x,e.y,0);l.addColorStop(0,"transparent"),l.addColorStop(.8,`rgba(255,255,255,${.8*(Math.cos(Date.now()/600+e.x/30+e.y/30)+1)})`),l.addColorStop(1,"white"),ctx.fillStyle=l,ctx.globalAlpha=.3,ctx.fillRect(-25,-25,50,50),ctx.globalAlpha=1,ctx.fillStyle="#fff",ctx.arc(e.x,e.y,1,0,2*Math.PI),ctx.fill(),ctx.closePath()}}if(e)if(petalReloadData[t]){if(petalReloadData[t].reload>.001&&petalReloadData[t].reload<.999){ctx.save(),ctx.beginPath(),ctx.roundRect(-25,-25,50,50,.25),ctx.clip(),ctx.globalAlpha=.3,ctx.lineCap="butt";let e=(1-Math.pow(petalReloadData[t].reload,.7))*Math.PI*6+this.randomAngle;ctx.strokeStyle="#000000",ctx.lineWidth=50,ctx.beginPath(),ctx.arc(0,0,25,e-2*Math.PI*smoothstep(petalReloadData[t].reload),e),ctx.stroke(),ctx.closePath(),ctx.restore()}}else petalHpData[t]&&petalHpData[t].hp>.001&&petalHpData[t].hp<.999&&(ctx.save(),ctx.beginPath(),ctx.roundRect(-23,-23,46,46,.25),ctx.clip(),ctx.globalAlpha=.3,ctx.lineCap="butt",ctx.fillStyle="#000000",ctx.beginPath(),ctx.rect(-25,-25,50,50*(1-petalHpData[t].hp)),ctx.fill(),ctx.closePath(),ctx.restore());if(this.petals[0].constructor===Petal){cachedImages.petals.indexed[this.type]||setPcIndexes(this.type);const e=cachedImages.petals.indexed[this.type][this.rarity];if(this.nameless){cachedImages.petals.live[`${this.type}${e.index}nameless`]||this.generateNamelessPetalImage(62.5,e);const t=cachedImages.petals.live[`${this.type}${e.index}nameless`];if(t){const e=this.render.w*(62/this.render.w)/(1.15*t.width);ctx.scale(e,e),ctx.drawImage(t,-t.width/2,-t.width/2),ctx.scale(1/e,1/e)}}else if(window.hqp){let t=this.render.w*(62/this.render.w)/71.875,a=ctx.getTransform(),i=ctx.strokeStyle,r=ctx.lineWidth;ctx.getTransform(),ctx.scale(t,t),ctx.translate(-31.25,-31.25),this.generatePetalImage(62.5,e,!0),ctx.setTransform(a),ctx.strokeStyle=i,ctx.lineWidth=r}else{cachedImages.petals.live[`${this.type}${e.index}`]||this.generatePetalImage(62.5,e);const t=cachedImages.petals.live[`${this.type}${e.index}`];if(t){const e=this.render.w*(62/this.render.w)/(1.15*t.width);ctx.scale(e,e),ctx.drawImage(t,-t.width/2,-t.width/2),ctx.scale(1/e,1/e)}}}if(this.petals[0].constructor===Enemy){cachedImages.enemies[`${this.type}`]||this.generateEnemyImage();const e=cachedImages.enemies[`${this.type}`];if(e){const t=this.render.w*(62/this.render.w)/(1.15*e.width);ctx.scale(t,t),ctx.drawImage(e,-e.width/2,-e.width/2),ctx.scale(1/t,1/t)}}ctx.beginPath(),ctx.roundRect(-25,-25,50,50,.25),ctx.stroke(),ctx.closePath(),void 0!==Colors.rarities[this.rarity].fancy&&1==window.hqp&&(ctx.save(),ctx.beginPath(),ctx.rect(-29.5,-29.5,59,59),ctx.rect(21.5,-21.5,-44,44),ctx.closePath(),ctx.clip(),ctx.globalAlpha*=.5,ctx.beginPath(),ctx.roundRect(-27.25,-27.25,54.5,54.5,1),ctx.fillStyle=i,ctx.fill(),ctx.closePath(),ctx.globalAlpha=1,ctx.restore()),1!==r&&ctx.scale(1/r,1/r),0!==n&&ctx.rotate(-n);!["Abyssal Artifact","Scorched Artifact","Verdant Artifact","Cosmic Artifact"].includes(this.type)&&(1!==this.amount||performance.now()-this.lastAmountChangedTime<240)&&(performance.now()-this.lastAmountChangedTime<240&&(ctx.globalAlpha=smoothstep((performance.now()-this.lastAmountChangedTime)/240)),1===this.amount&&(ctx.globalAlpha=1-ctx.globalAlpha),ctx.font=`600 ${13*r}px Ubuntu`,ctx.letterSpacing="1px",ctx.textBaseline="middle",ctx.textAlign="right",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=2,ctx.translate(28.5*r,-16.3*r),ctx.rotate(Math.PI/9.1),this.greyed&&(ctx.globalAlpha*=.3),ctx.strokeText("x"+(1===this.amount?2:formatAmount(this.amount)),0,0),ctx.fillText("x"+(1===this.amount?2:formatAmount(this.amount)),0,0),ctx.globalAlpha=1),this.greyed&&(ctx.globalAlpha=1),ctx.setTransform(ctx.lastTransform),delete ctx.lastTransform}}function formatAmount(e){if(e<1e3)return e;ctx.letterSpacing=".5px";const t=[{value:1e51,suffix:"sDc"},{value:1e48,suffix:"QDc"},{value:1e45,suffix:"qDc"},{value:1e42,suffix:"tDc"},{value:1e39,suffix:"dDc"},{value:1e36,suffix:"uDc"},{value:1e33,suffix:"Dc"},{value:1e30,suffix:"No"},{value:1e27,suffix:"Oc"},{value:1e24,suffix:"Sp"},{value:1e21,suffix:"Sx"},{value:1e18,suffix:"Qt"},{value:1e15,suffix:"Qd"},{value:1e12,suffix:"t"},{value:1e9,suffix:"b"},{value:1e6,suffix:"m"},{value:1e3,suffix:"k"}];for(let a=0;a<t.length;a++)if(e>=t[a].value){return Math.floor(e/(t[a].value/100))/100+t[a].suffix}return e}function formatAmountHighPrecision(e){const t=Math.abs(e),a=Math.sign(e);if(t<10)return Math.floor(100*t)/100*a;if(t<100)return Math.floor(10*t)/10*a;if(t<1e3)return Math.floor(t)*a;const i=[{value:1e51,suffix:"sDc"},{value:1e48,suffix:"QDc"},{value:1e45,suffix:"qDc"},{value:1e42,suffix:"tDc"},{value:1e39,suffix:"dDc"},{value:1e36,suffix:"uDc"},{value:1e33,suffix:"Dc"},{value:1e30,suffix:"No"},{value:1e27,suffix:"Oc"},{value:1e24,suffix:"Sp"},{value:1e21,suffix:"Sx"},{value:1e18,suffix:"Qt"},{value:1e15,suffix:"Qd"},{value:1e12,suffix:"t"},{value:1e9,suffix:"b"},{value:1e6,suffix:"m"},{value:1e3,suffix:"k"}];for(let e=0;e<i.length;e++){const{value:r,suffix:n}=i[e];if(t>=r){return Math.floor(t/(r/100))/100*a+n}}return e}function smoothstep(e){return interpolate(e*e,1-(1-e)*(1-e),e)}let petalOverrides={"Plastic Egg":{0:{customName:"Egg",renderSize:1.75,petalSize:12.5}},"Jellyfish Egg":{0:{customName:"Egg",renderSize:1.75,petalSize:12.5}},"Neuroflare Egg":{0:{customName:"Egg",renderSize:1.75,petalSize:12.5}},Egg:{0:{renderSize:1.75,petalSize:12.5}},"Shiny Egg":{0:{renderSize:1.75,petalSize:12.5,customName:"Egg"}},"Fire Missile":{0:{customName:"Missile",mainAngle:1.25*Math.PI/4,renderSize:1.25}},"Homing Missile":{0:{customName:"Missile",mainAngle:1.25*Math.PI/4,renderSize:1.25}},"Amulet of Time":{0:{customName:"Amulet",renderSize:2},11:{customName:"Amulet",renderSize:2},12:{customName:"Amulet",renderSize:2}},"Amulet of Grace":{0:{customName:"Amulet",mainAngle:Math.PI/7.5,renderSize:2},11:{customName:"Amulet",mainAngle:Math.PI/7.5,renderSize:2},12:{customName:"Amulet",mainAngle:Math.PI/7.5,renderSize:2}},"Amulet of Divergence":{0:{customName:"Amulet",mainAngle:Math.PI/4,renderSize:2},11:{customName:"Amulet",mainAngle:Math.PI/4,renderSize:2},12:{customName:"Amulet",mainAngle:Math.PI/4,renderSize:2},13:{customName:"Amulet",mainAngle:Math.PI/4,renderSize:2}},Missile:{0:{mainAngle:1.25*Math.PI/4,renderSize:1.25}},"Dark Compass":{0:{customName:"Compass",mainAngle:-Math.PI/4},10:{customName:"Compass"}},"Waterlogged Compass":{0:{customName:"Compass",mainAngle:-Math.PI/4},10:{customName:"Compass"}},"Waterlogged Dark Compass":{0:{customName:"Compass",mainAngle:-Math.PI/4},10:{customName:"Compass"}},Compass:{0:{mainAngle:-Math.PI/4},10:{}},Ikea:{0:{image:"https://archello.com/thumbs/images/2014/02/03/IKEA-Tampines.1506072620.5502.jpg?fit=crop&w=414&h=518",petalSize:40}},Thomas:{0:{image:"https://i.pinimg.com/originals/96/21/65/96216524958973ceffb8b7a2f29c9110.png",petalSize:30}},Stinger:{0:{petalSize:7.5},6:{multiAngle:-Math.PI,petalSize:7.5}},"Blood Jolt":{0:{customName:"Jolt"}},"Blood Stinger":{0:{petalSize:7.5,customName:"Stinger"},6:{multiAngle:-Math.PI,petalSize:7.5,customName:"Stinger"}},Wing:{0:{renderSize:2},12:{multiRadius:4,renderSize:2},14:{multiAngle:Math.PI/8,multiRadius:4,renderSize:2}},"Shiny Wing":{0:{renderSize:2,customName:"Wing"},12:{multiRadius:4,renderSize:2,customName:"Wing"},14:{multiAngle:Math.PI/8,multiRadius:4,renderSize:2,customName:"Wing"}},Claw:{0:{renderSize:2},15:{multiAngle:.763,renderSize:1.9,multiRadius:7}},Fangs:{0:{renderSize:2},16:{multiRadius:0,renderSize:2.5,multiAdd:Math.PI/2,mainAngle:-Math.PI/15+Math.PI/2}},Starfish:{0:{renderSize:2.5},13:{renderSize:2,multiAngle:Math.PI/8},14:{mainAngle:3.3*Math.PI/6,renderSize:1.9,multiAngle:Math.PI/8}},Brisingida:{0:{renderSize:2.5},13:{renderSize:2,multiAngle:Math.PI/8},14:{mainAngle:5*Math.PI/4,renderSize:1.9,multiAngle:Math.PI/8},15:{mainAngle:3.3*Math.PI/6,renderSize:1.9,multiAngle:Math.PI/8}},Blade:{0:{multiAngle:-Math.PI}},Bubble:{0:{renderSize:1.825,mainAngle:3*Math.PI/4}},"Shiny Bubble":{0:{renderSize:1.75,mainAngle:3*Math.PI/4,customName:"Bubble"}},Toxin:{0:{renderSize:2}},Neurotoxin:{0:{renderSize:2,customName:"Toxin"}},Batrachotoxin:{0:{renderSize:2,customName:"Toxin"}},Clover:{0:{renderSize:2.5},12:{renderSize:2.5},13:{renderSize:2.5},14:{renderSize:2.5},15:{renderSize:2.5},16:{renderSize:2.5},17:{renderSize:2.5},18:{renderSize:2.5},19:{renderSize:2.5},20:{renderSize:2.5},21:{renderSize:2.5},22:{renderSize:2.5},23:{renderSize:2.5},24:{renderSize:2.5},25:{renderSize:2.5},26:{renderSize:2.5},27:{renderSize:2.5},28:{renderSize:2.5},29:{renderSize:2.5}},Bloom:{0:{petalSize:12.5}},"Neutron Star":{0:{renderSize:3}},Card:{0:{petalSize:15,mainAngle:-Math.PI/4}},Cash:{0:{petalSize:25,mainAngle:-Math.PI/4}},Pentagon:{0:{renderSize:2.5}},Hexagon:{0:{renderSize:2.5,mainAngle:-Math.PI/4,customName:"ӇЄҲƛƓƠƝ"}},Husk:{0:{petalSize:12.5}},Soil:{0:{petalSize:12.5,renderSize:1.25}},Square:{0:{renderSize:2.25,mainAngle:-Math.PI/8,petalSize:12.5}},Trident:{0:{renderSize:2.25}},Coral:{0:{renderSize:2.25}},Rubber:{0:{renderSize:2}},Sponge:{0:{renderSize:3}},Jelly:{0:{renderSize:2}},Lightning:{0:{renderSize:1.25}},"Shiny Lightning":{0:{renderSize:1.25,customName:"Lightning"}},Pearl:{0:{renderSize:2.5},14:{renderSize:2.25,multiRadius:5}},Cactus:{0:{petalSize:12.5},1:{petalSize:12.5},2:{petalSize:12.5},3:{petalSize:12.5},4:{petalSize:12.5},5:{petalSize:12.5},6:{image:"./gfx/deteled.png",renderSize:5},7:{petalSize:12.5}},"Shiny Cactus":{0:{petalSize:12.5,customName:"Cactus"},7:{petalSize:12.5,customName:"Cactus"}},"Bloodshot Eye":{0:{renderSize:1.75}},"Third Eye":{0:{renderSize:1.75}},Mandible:{0:{petalSize:12.5,renderSize:2},13:{petalSize:12.5,renderSize:1.75,multiRadius:7.5}},"Blood Mandible":{0:{customName:"Mandible",petalSize:12.5,renderSize:2},13:{customName:"Mandible",petalSize:12.5,renderSize:1.75,multiRadius:7.5}},Magnet:{0:{renderSize:2.5},10:{renderSize:2,multiRadius:7.5},13:{renderSize:2,multiRadius:7.5,multiAngle:-Math.PI/1.5}},Oranges:{12:{mainAngle:-Math.PI/2}},"Blood Oranges":{0:{customName:"Oranges"},12:{mainAngle:-Math.PI/2,customName:"Oranges"}},Fig:{0:{renderSize:2.3}},Coconut:{0:{renderSize:2.4},14:{renderSize:2.2,multiRadius:5}},Root:{0:{renderSize:2.4}},Heavy:{0:{renderSize:2.5}},Rog456:{0:{renderSize:2,multiRadius:10}},Rice:{0:{renderSize:1.75,mainAngle:Math.PI/4}},Faster:{0:{petalSize:7.5}},Dandelion:{0:{mainAngle:Math.PI/4},5:{multiAngle:Math.PI/4+Math.PI/12},5:{multiAngle:2*Math.PI/3-Math.PI/12},12:{multiAngle:Math.PI/5+Math.PI}},Pollen:{0:{petalSize:7.5}},"Yin Yang":{0:{petalSize:15}},Dahlia:{0:{petalSize:7.5}},Rose:{0:{petalSize:12.5},12:{petalSize:12.5}},Light:{0:{petalSize:7.5}},"Blood Light":{0:{petalSize:7.5,customName:"Light"}},"Blood Rose":{0:{petalSize:12.5,customName:"Rose"}},Powder:{0:{petalSize:8.25},16:{petalSize:8.25},17:{petalSize:8.25}},Sand:{0:{petalSize:7.5}},Rock:{0:{petalSize:12.5,renderSize:1.75},7:{image:"https://memes.co.in/memes/update/uploads/2021/12/InShot_20211209_222013681-1024x1024.jpg",renderSize:4.25},8:{petalSize:12.5,renderSize:1.75}},Iris:{0:{petalSize:7.5},13:{petalSize:15},14:{petalSize:20}},"Shiny Iris":{0:{petalSize:7.5,customName:"Iris"},13:{petalSize:15,customName:"Iris"},14:{petalSize:20,customName:"Iris"}},Corn:{0:{petalSize:15},15:{renderSize:1.67,mainAngle:-Math.PI/6},16:{renderSize:1.67,mainAngle:-Math.PI/4}},"Blood Corn":{0:{petalSize:15,customName:"Corn"},15:{renderSize:1.6,mainAngle:-Math.PI/6,customName:"Corn"},16:{renderSize:1.6,customName:"Corn",mainAngle:-Math.PI/4}},Honey:{0:{petalSize:12.5}},Web:{0:{petalSize:12.5}},Bone:{0:{petalSize:12.5},16:{multiRadius:0,multiAdd:Math.PI/2,petalSize:12.5,renderSize:1.75,mainAngle:-Math.PI/15}},"Dark Spine":{0:{renderSize:2,mainAngle:-Math.PI/4,customName:"Spine"}},Peas:{0:{renderSize:1.25},12:{}},Grapes:{0:{renderSize:1.25},12:{}},"Mini Flower":{0:{renderSize:2,customName:"Flower"}},Horn:{0:{renderSize:2}},"Blood Horn":{0:{renderSize:2,customName:"Horn"}},"Blood Leaf":{0:{customName:"Leaf"},16:{customName:"Leaf",petalSize:15}},"Shard of Divergence":{0:{customName:"Shard",mainAngle:Math.PI/7.5,renderSize:2}},"Shard of Time":{0:{customName:"Shard",mainAngle:Math.PI/7.5,renderSize:2}},"Shard of Grace":{0:{customName:"Shard",mainAngle:Math.PI/7.5,renderSize:2}},"Trinket of the Hivemind":{0:{customName:"Trinket",renderSize:2.5}},"Trinket of the Sea":{0:{customName:"Trinket",renderSize:2.5,mainAngle:Math.PI/4}},"Trinket of the Wild":{0:{customName:"Trinket",renderSize:2.5}},"Ant Egg":{0:{customName:"Egg",multiRadius:7.5,renderSize:1.75}},"Shiny Leaf":{0:{customName:"Leaf"},16:{customName:"Leaf",petalSize:15}},Thorax:{0:{mainAngle:-Math.PI/4,renderSize:2}},Carapace:{0:{mainAngle:-Math.PI/4,renderSize:2}},Lilypad:{0:{mainAngle:-Math.PI/4,renderSize:2.5}},Blossom:{0:{renderSize:4}},Plank:{0:{mainAngle:-Math.PI/4,renderSize:2.2}},Carrot:{0:{mainAngle:Math.PI/4,renderSize:2.5}},"Shattered Relic of Wrath":{0:{customName:"Relic",renderSize:2.5}},"Reinforced Relic of Wrath":{0:{customName:"Relic",renderSize:2.5}},"Subset Relic of the Guardian":{0:{customName:"Relic",renderSize:2.5}},"Division Relic of the Guardian":{0:{customName:"Relic",renderSize:2.5}},"Guard Relic of the Guardian":{0:{customName:"Relic",renderSize:2.5}},"Knight Relic of the Guardian":{0:{customName:"Relic",renderSize:2.5}},"Aid Relic of Serenity":{0:{customName:"Relic",renderSize:2.5}},"Subliminal Relic of Serenity":{0:{customName:"Relic",renderSize:2.5}},"Barrier Relic of Serenity":{0:{customName:"Relic",renderSize:2.5}},Spikes:{0:{renderSize:1.2}},Leaf:{16:{customName:"Leaf",petalSize:15}},Cinderleaf:{0:{customName:"Leaf"},16:{customName:"Leaf",petalSize:15}},"Shiny Ruby":{0:{customName:"Ruby"}},Ruby:{0:{petalSize:10},16:{petalSize:10},17:{petalSize:10}},"Shiny Yucca":{0:{customName:"Yucca"}}},enemyOverrides={Centipede:{customRender:()=>{enemyRenderMap.Centipede({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:25,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0,isInEnemyBox:!0,isHead:!0}),ctx.translate(-50,0),enemyRenderMap.Centipede({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:25,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0,isInEnemyBox:!0}),ctx.translate(50,0)},renderSize:.825},"Evil Centipede":{customRender:()=>{enemyRenderMap["Evil Centipede"]({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:25,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0,isInEnemyBox:!0,isHead:!0}),ctx.translate(-50,0),enemyRenderMap["Evil Centipede"]({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:25,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0,isInEnemyBox:!0}),ctx.translate(50,0)},renderSize:.825},"Desert Centipede":{customRender:()=>{enemyRenderMap["Desert Centipede"]({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:25,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0,isInEnemyBox:!0,isHead:!0}),ctx.translate(-50,0),enemyRenderMap["Desert Centipede"]({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:25,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0,isInEnemyBox:!0}),ctx.translate(50,0)},renderSize:.825},"Evil Desert Centipede":{customRender:()=>{enemyRenderMap["Evil Desert Centipede"]({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:25,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0,isInEnemyBox:!0,isHead:!0}),ctx.translate(-50,0),enemyRenderMap["Evil Desert Centipede"]({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:25,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0,isInEnemyBox:!0}),ctx.translate(50,0)},renderSize:.825},DandelionMissile:{renderSize:.825},Dandelion:{customRender:()=>{for(let e=0,t=10;e<t;e++)ctx.rotate(e*Math.PI*2/t),ctx.translate(45,0),enemyRenderMap.DandelionMissile({render:{radius:10,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:1,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0}),ctx.translate(-45,0),ctx.rotate(-e*Math.PI*2/t);enemyRenderMap.Dandelion({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:1,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0})},renderSize:.75},"Ant Burrow":{renderSize:1.5},"Shiny Ant Burrow":{renderSize:1.325},"Fire Ant Burrow":{renderSize:1.325,customRender:()=>{enemyRenderMap["Fire Ant Burrow"]({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:1,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0,poppable:!0})}},"Sea Floor Burrow":{renderSize:1.5},Spider:{renderSize:.625},Gloomcrawler:{renderSize:.625},Tarantula:{renderSize:.625},Leech:{angle:2*Math.PI,renderSize:1.25},"Dark Electric Eel":{angle:2*Math.PI,renderSize:1.25},"Electric Eel":{angle:2*Math.PI,renderSize:1.25},"Shiny Electric Eel":{angle:2*Math.PI,renderSize:1.25},"1v1text":{angle:Math.PI},"Agar.io Cell":{angle:Math.PI},Sandstorm:{renderSize:1.25},Hornet:{renderSize:1.325},Root:{renderSize:1.3},"Worker Ant":{renderSize:.625},"Soldier Ant":{renderSize:.625},"Baby Ant":{renderSize:.625},"Soldier Fire Ant":{renderSize:.625},"Baby Fire Ant":{renderSize:.625},"Worker Fire Ant":{renderSize:.625},"Soldier Termite":{renderSize:.625},Gnat:{renderSize:.5},"Baby Termite":{renderSize:.625},"Worker Termite":{renderSize:.625},"Termite Mound":{renderSize:1.5},"Soldier Shiny Ant":{renderSize:.625},Rock:{renderSize:1.125},Sandstone:{renderSize:1.125},Soil:{renderSize:.75},"Dark Beetle":{customRender:()=>{ctx.translate(-7.5,0),enemyRenderMap["Dark Beetle"]({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:1,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0}),ctx.translate(7.5,0)}},"Shiny Beetle":{customRender:()=>{ctx.translate(-7.5,0),enemyRenderMap["Shiny Beetle"]({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:1,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0}),ctx.translate(7.5,0)}},Beetle:{customRender:()=>{ctx.translate(-7.5,0),enemyRenderMap.Beetle({render:{radius:25,angle:0,time:5e6,lastX:-100,lastY:-100,x:100,y:100},radius:1,lastTicksSinceLastDamaged:1e3,ticksSinceLastDamaged:1e3,rarity:0}),ctx.translate(7.5,0)}},Scorpion:{renderSize:1.125},Cactus:{renderSize:1.25},"Shiny Cactus":{renderSize:1.25},"Sunlit Frog":{renderSize:.75},"Moonlit Frog":{renderSize:.75},"Ruby Frog":{renderSize:.75},"Poison Dart Frog":{renderSize:.75},Locust:{renderSize:1.25},Starfish:{renderSize:.75},Brisingida:{renderSize:.75},Shell:{renderSize:1.25},Sponge:{renderSize:1.25},Crab:{renderSize:.8},Coral:{renderSize:1.25,angle:2*Math.PI}};function clonePC(e,t=void 0){if(void 0!==t)for(let a in t)e[a]=t[a];return new PetalContainer(e.petals.map(e=>new Petal(e)),{...e},e.id,e.amount,e.attempt)}function cloneEnemyPC(e,t=void 0){if(void 0!==t)for(let a in t)e[a]=t[a];return new PetalContainer(e.petals.map(e=>new Enemy(e)),{...e},e.id,e.amount,e.attempt)}function setPcIndexes(e){Stats.petals[e]||"1v1"===currentBiome||window.calculateStats(),pvpStats.petals[e]||"1v1"!==currentBiome||petalRenderMap[e]&&window.calculateStats(!0),cachedImages.petals.indexed[e]=[];let t=0,a=1,i=petalOverrides[e];for(let r=0;r<Stats.rarities.length;r++){let n={},l=!1;if(petalOverrides[e])for(let t in petalOverrides[e])t=Number(t),r==t?(i=r,n.override=petalOverrides[e][r],l=!0):r>=i&&(n.override=petalOverrides[e][i]);const s="1v1"===currentBiome&&petalRenderMap[e]?pvpStats.petals[e][r].petalLayout:Stats.petals[e][r].petalLayout;let o=1;o=1!==s[0].length?s[0].length:s.length,o!==a&&(a=o,l=!0),n.count=o,!0===l&&t++,cachedImages.petals.indexed[e][r]={index:t,data:n}}}