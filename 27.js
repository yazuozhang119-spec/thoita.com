let discoveredEnemies=localStorage.getItem("discoveredEnemies");if(null===discoveredEnemies)discoveredEnemies={};else try{discoveredEnemies=JSON.parse(discoveredEnemies)}catch(t){discoveredEnemies={}}function addDiscoveredEnemy(t="Ladybug",e=0){void 0===discoveredEnemies[t]&&(discoveredEnemies[t]=[]),discoveredEnemies[t][e]=!0,mobGallery.toRegenerate=!0,localStorage.setItem("discoveredEnemies",JSON.stringify(discoveredEnemies))}class MobGallery{constructor(){this.resize(),this.icon=new Image,"https://flowrclient.serum0017.repl.co"===location.origin?this.icon.src="https://flowr.fun/gfx/bin.svg":this.icon.src="gfx/bin.svg",this.hoveringOverButton=!1,this.hoveringOverX=!1,this.menuActive=!1,this.lastCloseTime=0,this.lastOpenTime=0,this.rows={},this.toRegenerate=!0,this.fillerPetalSlots={},this.scroll={x:0,y:0,render:{x:0,y:0}},this.horizontalScrollBarEnabled=!1,this.scrollExcess={x:0,y:0}}fadeOut(){this.fadingOut=!0,this.originalFadeOutTime=time,setTimeout(()=>{delete this.fadingOut,!0===this.menuActive&&this.toggleMenu()},100)}resize(t){this.dimensions={x:130,y:canvas.h-this.h-20,w:645,h:t??382};for(let t in this.dimensions)this[t]=this.dimensions[t];this.iconDimensions={x:20,y:canvas.h-20-80,w:80,h:80},this.XDimensions={x:this.x+this.w-7.5-30-3,y:this.y+7.5+3,w:30,h:30},this.inventorySpace={x:this.x,y:this.y,w:this.w-67,h:this.h},this.scrollBarSize=75,this.scrollBounds={x:{start:this.x+this.scrollBarSize/2+14,end:this.x+this.w-this.scrollBarSize/2-14-20},y:{start:this.y+this.scrollBarSize/2+2+60,end:this.y+this.h-this.scrollBarSize/2-14}}}mouseDown({x:t,y:e}){!0!==this.hoveringOverButton&&!0!==this.hoveringOverX?(!0===this.hoveringOverScrollbarH&&(this.draggingScrollBarH=!0),!0===this.hoveringOverScrollbarV&&(this.draggingScrollBarV=!0)):this.toggleMenu()}getHorizScrollBarDimensions(){return{x:this.scrollBounds.x.start+this.scroll.render.x*(this.scrollBounds.x.end-this.scrollBounds.x.start)-this.scrollBarSize/2,y:this.y+this.h-17,w:this.scrollBarSize,h:10}}getVertScrollBarDimensions(){return{x:this.x+this.w-20-5,y:this.scrollBounds.y.start+this.scroll.render.y*(this.scrollBounds.y.end-this.scrollBounds.y.start)-this.scrollBarSize/2,w:10,h:this.scrollBarSize}}mouseMove({x:t,y:e}){if(!0===this.menuActive)if(this.hoveringOverScrollbarH=!1,this.hoveringOverScrollbarV=!1,mouseInBox({x:t,y:e},this.getHorizScrollBarDimensions())?this.hoveringOverScrollbarH=!0:mouseInBox({x:t,y:e},this.getVertScrollBarDimensions())&&this.scrollExcess.y>0&&(this.hoveringOverScrollbarV=!0),this.draggingScrollBarH){const{start:e,end:s}=this.scrollBounds.x;this.scroll.x=(t-e)/(s-e)}else if(this.draggingScrollBarV){const{start:t,end:s}=this.scrollBounds.y;this.scroll.y=(e-t)/(s-t)}}mouseUp({x:t,y:e}){!0===this.menuActive&&(this.draggingScrollBarH=this.draggingScrollBarV=!1)}getMainStroke(){return"#b0ae3d"}getMainFill(){return"#dbd74b"}getHoverFill(){return blendColor("#dbd74b","#FFFFFF",.1)}drawIcon(){ctx.lineWidth=6,ctx.fillStyle=this.getMainFill(),ctx.strokeStyle=this.getMainStroke(),mouseInBox({x:mouse.canvasX,y:mouse.canvasY},this.iconDimensions)?(ctx.fillStyle=this.getHoverFill(),setCursor("pointer"),this.hoveringOverButton=!0):this.hoveringOverButton=!1,ctx.beginPath(),ctx.roundRect(20,canvas.h-20-80,80,80,3),ctx.fill(),ctx.stroke(),ctx.closePath(),this.icon.complete&&this.icon.naturalWidth>0?ctx.drawImage(this.icon,35,canvas.h-20-80+15,50,50):(ctx.font="900 30px Ubuntu",ctx.fillStyle="#ffffff",ctx.strokeStyle="#000000",ctx.lineWidth=2,ctx.textAlign="center",ctx.textBaseline="middle",ctx.strokeText("ðŸ“–",60,canvas.h-20-40),ctx.fillText("ðŸ“–",60,canvas.h-20-40)),ctx.fillStyle="#f0f0f0",ctx.strokeStyle="black",ctx.lineWidth=2.25,ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="900 14px Ubuntu",ctx.letterSpacing,ctx.letterSpacing="0px",ctx.strokeText("[V]",82.5,canvas.h-20-80+15),ctx.fillText("[V]",82.5,canvas.h-20-80+15),ctx.letterSpacing=ctx.lastLetterSpacing}toggleMenu(){!0===craftingMenu.menuActive&&craftingMenu.toggleMenu(),!0===globalInventory.menuActive&&globalInventory.toggleMenu(),!0===specialGlobalInventory.menuActive&&specialGlobalInventory.toggleMenu(),!0===shop.menu.active&&shop.toggle(),!0===this.menuActive?this.lastCloseTime=time:(this.lastOpenTime=time,!0===globalInventory.menuActive&&globalInventory.toggleMenu()),this.menuActive=!this.menuActive;for(let t in this.rows){const e=this.rows[t];for(let t=0;t<e.length;t++)void 0!==e[t].petals&&(e[t].petals[0].lastIsHovered=!1)}}draw(){!1===Number.isFinite(this.y)&&(this.y=this.dimensions.y=canvas.h-this.h-20),this.toRegenerate&&Object.keys(window.enemyStats).length>0&&(this.regenerateMobs(window.structuredClone(discoveredEnemies)),this.toRegenerate=!1),this.resize();let t=!0===this.fadingOut?1-(time-this.originalFadeOutTime)/100:1;!0===this.menuActive||time-this.lastCloseTime<160?(this.drawInventory(t),this.drawRowStatBoxes()):this.hoveringOverX=!1}drawScrollBars(){if(isNaN(this.scroll.y)&&(this.scroll.y=0),this.scroll.x=Math.min(1,Math.max(0,this.scroll.x)),this.scroll.y=Math.min(1,Math.max(0,this.scroll.y)),this.scroll.render.x=interpolate(this.scroll.render.x,this.scroll.x,this.draggingScrollBarH?.28:.08),this.scroll.render.y=interpolate(this.scroll.render.y,this.scroll.y,this.draggingScrollBarV?.28:.08),(!0===this.hoveringOverScrollbarH||!0===this.hoveringOverScrollbarV||this.draggingScrollBarH||this.draggingScrollBarV)&&setCursor("pointer"),!0===this.horizontalScrollBarEnabled){const t=this.getHorizScrollBarDimensions();ctx.strokeStyle=blendColor(this.getMainStroke(),"#000000",.1),ctx.lineWidth=8,ctx.lineCap="round",ctx.beginPath(),ctx.moveTo(t.x,t.y+t.h/2),ctx.lineTo(t.x+t.w,t.y+t.h/2),ctx.stroke(),ctx.closePath()}if(this.scrollExcess.y>0){const t=this.getVertScrollBarDimensions();ctx.beginPath(),ctx.moveTo(t.x+t.w/2,t.y),ctx.lineTo(t.x+t.w/2,t.y+t.h),ctx.stroke(),ctx.closePath()}}drawInventory(t=1){1!==t&&(ctx.globalAlpha=t);let e=0;time-this.lastCloseTime<160&&(e+=(this.h+40)*easeOutCubic((time-this.lastCloseTime)/160)),time-this.lastOpenTime<160&&(e+=this.h+40-(this.h+40)*easeOutCubic((time-this.lastOpenTime)/160)),0!==e&&ctx.translate(0,e),!0!==this.hoveringOverScrollbar&&!0!==this.draggingScrollBar||setCursor("pointer"),ctx.translate(this.x,this.y),ctx.fillStyle=this.getMainFill(),ctx.strokeStyle=this.getMainStroke(),ctx.lineWidth=8,ctx.beginPath(),ctx.roundRect(0,0,this.w,this.h,3),ctx.fill(),ctx.stroke(),ctx.closePath(),!0===this.menuActive&&0===e?mouseInBox({x:mouse.canvasX,y:mouse.canvasY},this.XDimensions)?(ctx.fillStyle="#c16666",setCursor("pointer"),this.hoveringOverX=!0):(this.hoveringOverX=!1,ctx.fillStyle="#c1565e"):(ctx.fillStyle="#c1565e",this.hoveringOverX=!1),ctx.translate(-3,3),ctx.strokeStyle="#90464b",ctx.lineWidth=5,ctx.beginPath(),ctx.roundRect(this.w-7.5-30,7.5,30,30,6),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.lineWidth=4.75,ctx.lineCap="round",ctx.strokeStyle="#cccccc",ctx.beginPath(),ctx.moveTo(this.w-30,30),ctx.lineTo(this.w-15,15),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(this.w-15,30),ctx.lineTo(this.w-30,15),ctx.stroke(),ctx.closePath(),ctx.translate(3,-3),ctx.translate(-this.x,-this.y),this.drawRows(),ctx.translate(this.x,this.y),ctx.fillStyle=this.getMainFill(),ctx.strokeStyle=this.getMainStroke(),ctx.lineWidth=8,ctx.beginPath(),ctx.roundRect(0,0,this.w,this.h,3),ctx.stroke(),ctx.closePath(),ctx.translate(-this.x,-this.y),!1===this.isEmpty&&this.drawScrollBars(),0!==e&&ctx.translate(0,-e),ctx.globalAlpha=1}drawRows(){if(void 0!==window.enemyStats&&void 0===window.enemyStats.Ladybug?.drops){window.calculateStats(!1);for(let t in Stats.enemies){const e=Stats.enemies[t],s={};for(let t in e)s[t]=e[t].drops;void 0===window?.enemyStats[t]&&(window.enemyStats[t]={}),window.enemyStats[t].drops=s}let t=[];for(let e in baseStats.enemies){const s=baseStats.enemies[e];t.push(e,s.health,s.damage,s.speed,s.mass)}for(let e=0;e<t.length;e+=5)window.enemyStats[t[e]].health=t[e+1],window.enemyStats[t[e]].damage=t[e+2],window.enemyStats[t[e]].speed=t[e+3],window.enemyStats[t[e]].mass=t[e+4];this.regenerateMobs(discoveredEnemies)}else if(void 0===window.enemyStats.Ladybug.damage){window.calculateStats(!1);for(let t in Stats.enemies){const e=Stats.enemies[t],s={};for(let t in e)s[t]=e[t].drops;window.enemyStats[t].drops=s}}if(0===Object.keys(this.rows).length){const t=ctx.letterSpacing;ctx.font="900 102px Ubuntu",ctx.letterSpacing="-.05px",ctx.textBaseline="middle",ctx.textAlign="center",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=8,ctx.strokeText("???",this.x+this.w/2,this.y+this.h/2-20),ctx.fillText("???",this.x+this.w/2,this.y+this.h/2-20),ctx.lineWidth=3.5,ctx.font="900 16px Ubuntu",ctx.strokeText("(No Mobs Discovered)",this.x+this.w/2,this.y+this.h/2+35),ctx.fillText("(No Mobs Discovered)",this.x+this.w/2,this.y+this.h/2+35),ctx.letterSpacing=t,this.isEmpty=!0}else this.isEmpty=!1;ctx.save(),ctx.beginPath(),ctx.rect(this.inventorySpace.x,this.inventorySpace.y,this.inventorySpace.w,this.inventorySpace.h-(!0===this.horizontalScrollBarEnabled?20:0)),ctx.clip(),ctx.closePath(),ctx.translate(-this.scrollExcess.x*this.scroll.render.x,-this.scrollExcess.y*this.scroll.render.y);this.currentY=this.y-3;let t=0,e=0;for(let t in this.rows){const s=this.rows[t];s.length>e&&(e=s.length)}for(let s in this.rows){const i=this.rows[s];for(let r=0;r<e;r++){void 0===i[r]&&(i[r]=!1);const e=this.x+8+64*r+28,l=this.currentY+28+12;if(!1===i[r]){const t=s,i=r;void 0===this.fillerPetalSlots[t]&&(this.fillerPetalSlots[t]={}),void 0===this.fillerPetalSlots[t][i]&&(this.fillerPetalSlots[t][i]={render:{x:e,y:l}});const n=this.fillerPetalSlots[t][i];n.x=e,n.y=l,n.render.x=interpolate(n.render.x,n.x,.00672*dt),n.render.y=interpolate(n.render.y,n.y,.00672*dt),ctx.fillStyle=this.getMainStroke(),ctx.beginPath(),ctx.roundRect(n.render.x-28,n.render.y-28,56,56,8),ctx.fill(),ctx.closePath();continue}if(!0===i[r]&&(i[r]=this.generateEnemyPc(s,r,56),!1===i[r]?i[r]=!0:(i[r].render.x=e,i[r].render.y=l)),!0===i[r])continue;t<i[r].render.x&&(t=i[r].render.x);const n=i[r];n.x=e,n.y=l,n.draw()}this.currentY+=62}this.scrollExcess={x:t-this.w-28,y:this.currentY-this.y-this.h+28},this.scrollExcess.x=Math.max(this.scrollExcess.x,0),this.scrollExcess.y=Math.max(this.scrollExcess.y,0),ctx.restore()}drawRowStatBoxes(){const t=mouseInBox({x:mouse.canvasX,y:mouse.canvasY},{...this.inventorySpace,h:this.inventorySpace.h-(!0===this.horizontalScrollBarEnabled?20:0)});for(let e in this.rows){const s=this.rows[e];for(let e=0;e<s.length;e++){if(!1===s[e]||!0===s[e])continue;const i=s[e];void 0===i.petals[0].angleVel&&(i.petals[0].angleVel=Math.random()<1e-4?.01:.002*(Math.random()**1.5-.5)),t&&!0===mouseInBox({x:mouse.canvasX,y:mouse.canvasY},{x:i.render.x-i.w/2-this.scrollExcess.x*this.scroll.render.x,y:i.render.y-i.h/2-this.scrollExcess.y*this.scroll.render.y,w:i.w,h:i.h})?(i.petals[0].isHovered=!0,i.petals[0].angle+=.02*dt/(1e3/120)*Math.sign(i.petals[0].angleVel),i.petals[0].lastIsHovered=!0):(i.petals[0].lastIsHovered=!1,i.petals[0].isHovered=!1),i.petals[0].angle+=i.petals[0].angleVel*dt;const r=i.petals[0],l={x:r.x,y:r.y,render:{x:r.render.x,y:r.render.y}};r.render.x=r.x=i.render.x-this.scrollExcess.x*this.scroll.render.x,r.render.y=r.y=i.render.y-this.scrollExcess.y*this.scroll.render.y,r.drawStatsBox(void 0,!0),r.x=l.x,r.y=l.y,r.render.x=l.render.x,r.render.y=l.render.y}}}regenerateMobs(t){this.horizontalScrollBarEnabled=!1;const e=biomeEnemyMap[biomeManager.getCurrentBiomeData().current];let s=rareBiomeEnemyMap[biomeManager.getCurrentBiomeData().current],i=secretBiomeEnemyMap[biomeManager.getCurrentBiomeData().current];s||(s=[]),i||(i=[]),this.rows={};for(let r in t)(e.includes(r)||s.includes(r)||i.includes(r)||["Square","Pentagon","Hexagon"].includes(r))&&this.addRow(r,t[r])}addRow(t,e){this.rows[t]=[];for(let s=0;s<e.length;s++)!0===e[s]?(this.rows[t][s]=!0,s>8&&(this.horizontalScrollBarEnabled=!0)):this.rows[t][s]=!1}generateEnemyPc(t,e,s){const i=new Enemy({x:0,y:0,radius:200,hp:100,maxHp:100,id:Math.random(),type:t,rarity:e,angle:Math.random()*Math.PI*2,toRenderUi:!1,isMenuEnemy:!0});i.x=i.render.x=i.y=i.render.y=0,i.radius=i.render.radius=14,i.angle=-Math.PI/4;const r=Stats.enemies[t],l=enemyRarityScalars[e];return void 0!==l&&void 0!==r&&(r.xp=l.xp,r.health*=l.health,"Starfish"==t?r.healing=Math.round(.007*r.health*30*100)/100+"/s":"Brisingida"==t&&(r.healing=Math.round(.009*r.health*30*100)/100+"/s"),r.damage*=l.damage,r.detectionDistance=l.detectionDistance,r.mass*=l.mass,new PetalContainer([i],{x:0,y:0,w:s,h:s,toOscillate:!1,amount:1,petalStats:r},Math.random(),1,0))}updateScroll(t={x:0,y:0},{mouseX:e,mouseY:s}){!1!==mouseInBox({x:e,y:s},this.dimensions)&&(this.scroll.y+=t.y/this.scrollExcess.y/3)}}const mobGallery=new MobGallery;