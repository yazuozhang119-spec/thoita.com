let cachedStats,cachedState=["please regen",!1];function safeDrawImage(t,e,a,s,i){t&&t.complete&&t.naturalWidth>0&&ctx.drawImage(t,e,a,s,i)}let isTs=void 0!==window.characterSelector&&"1"==window.characterSelector.selectedIndex;function generateCachedStats(t){cachedState[0]=t,cachedState[1]=!1,window.calculateStats(!1,t),cachedStats=structuredClone({petals:Stats.petals,enemies:Stats.enemies}),window.calculateStats(!1)}class StatsBox{constructor(t,e,a="petals",s,i){this.name=t,this.type=t,this.description=Descriptions[a][t]?Descriptions[a][t]:"Something interesting...",this.mode=a,this.amount=s,this.rarity=i,this.h=this.w=this.x=this.y=0,this.image=null,this.generateData(a,t,e)}generateData(t,e,a){if(cachedState[0]!==isTs&&generateCachedStats(isTs),["Abyssal Artifact","Scorched Artifact","Verdant Artifact","Cosmic Artifact"].includes(this.type))this.generateArtifactData();else if("petals"==t){if(a=cachedStats.petals[this.type][this.rarity],"Fangs"==this.type&&(this.name="Fang"),"Egg"==this.type&&(this.name="Beetle Egg"),"Hexagon"==this.type&&(this.name="ӇЄҲƛƓƠƝ"),"Trinket of the Hivemind"==this.type&&(this.description=[{text:"You can hear distant humming within the trinket... Converts",color:"#ffffff"},{text:Colors.rarities[a.maximumRarity].name,color:Colors.rarities[a.maximumRarity].color},{text:"Soldier Ant summons and below into Soldier Termites.",color:"#ffffff"}]),"Trinket of the Sea"==this.type&&(this.description=[{text:"The sounds of the sea fills your ears... Converts",color:"#ffffff"},{text:Colors.rarities[a.maximumRarity].name,color:Colors.rarities[a.maximumRarity].color},{text:"Sandstorms and below into Whirlpools",color:"#ffffff"}]),"Trinket of the Wild"==this.type&&(this.description=[{text:"A faint grassy smell is emitted from this trinket... All",color:"#ffffff"},{text:Colors.rarities[a.maximumRarity].name,color:Colors.rarities[a.maximumRarity].color},{text:"Ruby Summons and below convert into dangerous Mossy Rubies!",color:"#ffffff"}]),"Jellyfish Egg"==this.type&&this.rarity>=14&&(this.description="It's gonna zap everything to death. Pet Jellyfish deal 4% of their max health as zap damage."),"Neuroflare Egg"==this.type&&this.rarity>=14&&(this.description="It's gonna zap everything to death. Pet Jellyfish deal 2% of their max health as zap damage."),"Third Eye"==this.type&&13===this.rarity&&(this.description="Something lofdjf will never get."),"Mandible"==this.type&&this.rarity>=13&&(this.description="Has a 15% chance of doing 20x damage. Critical chance increases to 30% when 3 or more flowers are dead."),"Blood Mandible"==this.type&&this.rarity>=13&&(this.description="Has a 15% chance of doing 20x damage. Critical chance increases to 30% when 3 or more flowers are dead. Only deals self damage on critical hits."),"Basic"==this.type&&this.rarity>=7&&(this.description=`A nice petal, not very strong. Has a 0.1% chance to increase special wave chance by ${this.rarity-7}% every tick.`),"Faster"==this.type&&this.rarity>=13&&(this.description+="                                              "),"Amulet of Grace"==this.type&&11==this.rarity&&(this.description="Forged by the Ancients to extend their life, it has long since lost the flame that fueled it. Maybe if it was ignited again, it could be used to extend your own life once more..."),"Amulet of Grace"==this.type&&this.rarity<11&&(this.description="An odd, warm feeling overtakes you as you peer into the gem. You grow calm, but it was only for a moment. Could a more powerful amulet could harness more of this magic..?"),"Amulet of Time"==this.type&&11==this.rarity&&(this.description="In times since past, this was fought over relentlessly as it was believed to slow the enemies advances. Lacking the power it once had, maybe if recharged it could aid against the onslaught..."),"Amulet of Time"==this.type&&this.rarity<11&&(this.description="Staring into the darkness within, memories of a time long lost fade in and out. A faint glow eminates from the deep center. Perhaps if this amulet had more power..?"),"Amulet of Divergence"==this.type&&11==this.rarity&&(this.description="This was merely the prototype to something of far greater strength... capable of warping reality itself. Perhaps merging them can generate power enough to use it for your own conquest?"),"Amulet of Divergence"==this.type&&this.rarity<11&&(this.description="Faint lights appear from within deep inside the stored gem. There appears to be movement inside, but it's too hard to discern what is causing it. What if more power was contained..?"),"Jelly"==this.type&&this.rarity>=13&&(this.description="With advanced technological advancements from bioengineered Jellyfish, this Jelly only deals knockback if you are defending."),"Powder"==this.type&&this.rarity>=13&&(this.description="Increases movement speed if not attacking, but decreases health. Reduces player radius. Does not stack."),"Neutron Star"==this.type&&this.rarity>=13&&(this.description="A decoy that forcefully attracts mobs with the strength of gravity. Free will is just an illusion after all. Aims in your movement direction. Causes mobs to forcefully compress into each other, slowly wearing off over 3 seconds."),"Honey"==this.type&&this.rarity>=8&&(this.description="A rocket-powered decoy that attracts mobs away from flowers."),"Horn"==this.type&&(this.description=[{text:"If the current wave has ended, this petal calls for the next wave to start if there are under a certain number of mobs remaining. It also instantly vanquishes all remaining mobs under some rarity without drops. Horns up to",color:"#ffffff"},{text:Colors.rarities[a.maximumRarity].name,color:Colors.rarities[a.maximumRarity].color},{text:"mobs.",color:"#ffffff"}]),"Horn"==this.type&&this.rarity>=13&&(this.description=[{text:"Not only horns the wave, but also gives a slight chance for every horned mob to give drops regardless. Horns up to",color:"#ffffff"},{text:Colors.rarities[a.maximumRarity].name,color:Colors.rarities[a.maximumRarity].color},{text:"mobs.",color:"#ffffff"}]),"Magnet"==this.type&&this.rarity>=14&&(this.description="Collects drops from further away, blocks electric attacks and gives a slight chance to duplicate drops for yourself upon pickup."),"Jolt"==this.type&&this.rarity>=13&&(this.description="A jolt so powerful, it teleports all players and pets across the map, at the cost of a high cooldown time. Great for escaping threats!"),"Bubble"==this.type&&this.rarity>=13&&(this.description="Stated to be the oldest bubble ever, this ancient sphere has since propagated into every bubble that has come since it's inception. Harnessing its bubble blowing abilities will allow you to create your own to aid you."),"Bubble"==this.type&&this.rarity>=14&&(this.description="An even older bubble. This unc sphere has had nearly 67 millenia of existence. It not only blows a really fat bubble, but it teleports to you every second."),"Amulet of Divergence"==this.type&&this.rarity>=14&&(this.description="An ancient relic believed to have the power of creating a false reality. Limited use per player per game. (Attack or defend to absorb differently; only usable after wave spawning ends)"),"Waterlogged Compass"==this.type&&this.rarity>=14&&(this.description="Shows the number of the highest rarity spawning, and also shows Wave Data, but only after all mobs have already spawned."),"Ruby"==this.type&&(this.description=[{text:"A mythical gem infused with the power of friendship. Works up to",color:"#ffffff"},{text:Colors.rarities[a.maxReviveRarity].name,color:Colors.rarities[a.maxReviveRarity].color},{text:"mobs.",color:"#ffffff"}]),"Emerald"==this.type&&(this.description=[{text:"A mythical gem infused with the power of genesis. Works up to",color:"#ffffff"},{text:Colors.rarities[a.maxDuplicationRarity].name,color:Colors.rarities[a.maxDuplicationRarity].color},{text:"mobs.",color:"#ffffff"}]),"Sapphire"==this.type&&(this.description=[{text:"A mythical gem infused with the power of transformation. Works up to",color:"#ffffff"},{text:Colors.rarities[a.maxConversionRarity].name,color:Colors.rarities[a.maxConversionRarity].color},{text:"mobs.",color:"#ffffff"}]),"Emerald"==this.type&&this.rarity>=13&&(this.description=[{text:"A mythical gem infused with the power of genesis. Works up to",color:"#ffffff"},{text:Colors.rarities[a.maxDuplicationRarity].name,color:Colors.rarities[a.maxDuplicationRarity].color},{text:"mobs. Converting",color:"#ffffff"},{text:Colors.rarities[a.maxDuplicationRarity].name,color:Colors.rarities[a.maxDuplicationRarity].color},{text:"mobs disables the slot for the rest of the wave.",color:"#ffffff"}]),"Sapphire"==this.type&&this.rarity>=13&&(this.description=[{text:"A mythical gem infused with the power of transformation. Works up to",color:"#ffffff"},{text:Colors.rarities[a.maxConversionRarity].name,color:Colors.rarities[a.maxConversionRarity].color},{text:"mobs. Converting",color:"#ffffff"},{text:Colors.rarities[a.maxConversionRarity].name,color:Colors.rarities[a.maxConversionRarity].color},{text:"mobs disables the slot for the rest of the wave.",color:"#ffffff"}]),"Ruby"==this.type&&a.minimumConvert&&(this.description=[{text:"A mythical gem infused with the power of friendship.",color:"#ffffff"},{text:Colors.rarities[a.minimumConvert-1].name,color:Colors.rarities[a.minimumConvert-1].color},{text:"rarity mobs and below get converted to",color:"#ffffff"},{text:Colors.rarities[a.maxReviveRarity].name,color:Colors.rarities[a.maxReviveRarity].color},{text:"summons, but",color:"#ffffff"},{text:Colors.rarities[a.minimumConvert].name,color:Colors.rarities[a.minimumConvert].color},{text:"rarity mobs and above get converted into",color:"#ffffff"},{text:Colors.rarities[a.maxReviveRarity+1].name,color:Colors.rarities[a.maxReviveRarity+1].color},{text:"summons.",color:"#ffffff"}]),"Shiny Bubble"==this.type&&this.rarity>=14&&(this.description="Propels the flower in the direction you are facing. Teleportation keybind is [F]."),"Shiny Leaf"==this.type&&(this.description=this.description=[{text:Descriptions.petals["Shiny Leaf"]+" Requires",color:"#ffffff"},{text:"Constant Healing",color:statColors.heal},{text:"stronger than "+formatAmountHighPrecision(a.health/6)+"/s.",color:"#ffffff"}]),"Shiny Iris"==this.type&&(this.description=this.description=[{text:"Blessed with the power of the sun god himself, this glowing iris decimates waves of enemies with potent",color:"#ffffff"},{text:"poison",color:statColors.poison},{text:"sourced from the skies. The more enemies that are struck, the more the",color:"#ffffff"},{text:"poison",color:statColors.poison},{text:"hurts for all of them.",color:"#ffffff"}]),"Shiny Lightning"==this.type&&(this.description=this.description=[{text:"Blessed with the might of Thor, this shockingly deadly",color:"#ffffff"},{text:"lightning",color:statColors.lightning},{text:"can clear crowds of enemies like no other. The more it chains, the harder it hits (up to a maximum).",color:"#ffffff"}]),"Shiny Egg"==this.type&&(this.description=this.description=[{text:"This egg hatches a very hungy beetle! Each kill you get, it grows in size, to a max. Mobs that are both below rarity",color:"#ffffff"},{text:Colors.rarities[a.maxEat+1].name,color:Colors.rarities[a.maxEat+1].color},{text:"and smaller than 1/2 of the beetle get eaten whole.",color:"#ffffff"}]),"string"==typeof this.description){let t=this.description;this.description=[],this.description.push({text:t,color:"#ffffff"})}this.topstats=[],this.bottomstats=[];for(let t in a)if(isTs||!["tanksmithRadius"].includes(t))if(["reload","lifespan","hatchTime","spawnSystem","timeToPop","timeLimit"].includes(t)){if("hatchTime"==t&&isTs)continue;if(isTs){if("reload"==t&&a.tanksmithCooldown){this.topstats.push({key:t,value:a.tanksmithCooldown/30,color:statColors[t]}),a.tanksmithShootCooldown?this.topstats.push({key:"shootCd",value:a.tanksmithCooldown/30,color:statColors[t]}):this.topstats.push({key:"shootCd",value:a[t],color:statColors[t]});continue}if("reload"==t){this.topstats.push({key:t,value:1.5*a[t],color:statColors[t]}),a.tanksmithShootCooldown?this.topstats.push({key:"shootCd",value:a.tanksmithCooldown/30,color:statColors[t]}):this.topstats.push({key:"shootCd",value:a[t],color:statColors[t]});continue}}if("timeToPop"==t&&0==a[t]||this.topstats.push({key:t,value:a[t],color:statColors[t]}),"spawnSystem"==t){let e=.8;this.rarity<=13?e*=2.25:(this.rarity>=14&&(e*=.866),15==this.rarity&&(e*=2.875),this.rarity>=16&&(e*=1.5)),this.bottomstats.push({key:"summon",value:{rarity:a[t][0],type:"Sandstorm",amount:a[t][2],substats:{damage:1.2*Stats.rarities[this.rarity].petalDamage,health:Stats.enemies.Sandstorm[a[t][0]].health,mass:Stats.enemies.Sandstorm[a[t][0]].mass*e*8}},color:statColors.cooldown})}}else if(statColors[t]){if("mana"==t&&"Amulet of Time"==this.type?this.bottomstats.push({key:"timeMana",value:a[t],color:Colors.mana.time}):"mana"==t&&"Amulet of Divergence"==this.type?this.bottomstats.push({key:"divergenceMana",value:a[t],color:Colors.mana.divergence}):"mana"==t&&"Amulet of Grace"==this.type?this.bottomstats.push({key:"graceMana",value:a[t],color:Colors.mana.grace}):["poison","slowdownTime","flowerBodyPoison","summonBodyPoison","overhealConversion","period","extraRange","waveHealthBoost","shadowTime","unrevivable","healthNerf","radiusChange","range","collectDupeChance","bodyDamage","flowerArmor","armorPercent","maximumMobs","petLifespan","healingBoost"].includes(t)?this.bottomstats.push({key:t,value:a[t],color:statColors[t],unstackable:!0}):"maxDamage"==t?this.bottomstats.push({key:"maxDamage",value:a[t]+a.damage,color:statColors.damage}):this.bottomstats.push({key:t,value:a[t],color:statColors[t]}),"damage"==t&&("Lightning"!=this.type&&"Blueberries"!=this.type&&"Shiny Lightning"!=this.type||this.bottomstats.push({key:"lightning",value:a[t],color:statColors.lightning}),"Fig"==this.type&&this.bottomstats.push({key:"blastDamage",value:a[t],color:statColors.damage})),"petLifespan"==t){if("Ruby"==this.type){let t=Stats.rarities[this.rarity].petalDamage,e=4500*Stats.rarities[this.rarity].petalHealth;this.bottomstats.push({key:"summon",value:{rarity:-1,type:"Rubied Enemy",substats:{damage:t,health:e,mass:"Varies"}},color:statColors.cooldown})}if("Shiny Ruby"==this.type){let t=.1*Stats.rarities[this.rarity].petalDamage,e=9e3*Stats.rarities[this.rarity].petalHealth;this.bottomstats.push({key:"summon",value:{rarity:-1,type:"Rubied Enemy",substats:{damage:t,health:e,mass:"Varies"}},color:statColors.cooldown})}}}else if("spawnRarity"==t){let e=.8;if(this.rarity<=13&&("Jellyfish Egg"==this.type||"Neuroflare Egg"==this.type)?e*=2.25:(this.rarity>=14&&(e*=1.375),15!=this.rarity||"Jellyfish Egg"!=this.type&&"Neuroflare Egg"!=this.type||(e*=2.875),this.rarity>=16&&(e*=1.9)),"Egg"==this.type&&this.bottomstats.push({key:"summon",value:{rarity:a[t],type:"Beetle",substats:{damage:1.5*Stats.rarities[this.rarity].petalDamage,health:1.2*Stats.enemies.Beetle[a[t]].health,mass:Stats.enemies.Beetle[a[t]].mass*e*8}},color:statColors.cooldown}),"Shiny Egg"==this.type&&this.bottomstats.push({key:"summon",value:{rarity:a[t],type:"Shiny Beetle",substats:{damage:5*Stats.rarities[this.rarity].petalDamage,health:1.5*Stats.enemies.Beetle[a[t]].health,mass:[Stats.enemies["Shiny Beetle"][a[t]].mass*e*2*8,Stats.enemies["Shiny Beetle"][a[t]].mass*e*2*2.5*8]}},color:statColors.cooldown}),"Ant Egg"==this.type){let s=25*Stats.rarities[this.rarity].petalDamage;this.rarity>=10&&(s*=.8),this.rarity>=13&&(s*=5/6),this.rarity>=15&&(s*=5/6);let i=2400*Stats.rarities[this.rarity].petalHealth;this.bottomstats.push({key:"summon",value:{rarity:a[t],type:"Soldier Ant",substats:{damage:s,health:i,mass:Stats.enemies["Soldier Ant"][a[t]].mass*e}},color:statColors.cooldown})}if("Jellyfish Egg"==this.type&&this.bottomstats.push({key:"summon",value:{rarity:a[t],type:"Jellyfish",substats:{damage:.5*Stats.rarities[this.rarity].petalDamage,health:Stats.enemies.Jellyfish[a[t]].health,mass:Stats.enemies.Jellyfish[a[t]].mass*e*8,lightning:Stats.enemies.Jellyfish[a[t]].health*(this.rarity>=14?.05:.12),bounces:a[t]>11?a[t]>13?4:3:2}},color:statColors.cooldown}),"Neuroflare Egg"==this.type&&this.bottomstats.push({key:"summon",value:{rarity:a[t],type:"Neuroflare",substats:{damage:1.2*Stats.rarities[this.rarity].petalDamage,health:Stats.enemies.Neuroflare[a[t]].health,mass:Stats.enemies.Neuroflare[a[t]].mass*e,lightning:Stats.enemies.Neuroflare[a[t]].health*(this.rarity>=14?.025:.06),bounces:a[t]>11?a[t]>13?4:3:2}},color:statColors.cooldown}),"Plastic Egg"==this.type&&this.bottomstats.push({key:"summon",value:{rarity:a[t],type:"Plastic",substats:{damage:.3*Stats.rarities[this.rarity].petalDamage,health:Stats.enemies.Plastic[a[t]].health,mass:Stats.enemies.Plastic[a[t]].mass*e}},color:statColors.cooldown}),"Square"==this.type&&this.bottomstats.push({key:"summon",value:{rarity:a[t],type:"Square",substats:{damage:.3*Stats.rarities[this.rarity].petalDamage,health:Stats.enemies.Square[a[t]].health,mass:Stats.enemies.Square[a[t]].mass*e}},color:statColors.cooldown}),"Pentagon"==this.type&&this.bottomstats.push({key:"summon",value:{rarity:a[t],type:"Pentagon",substats:{damage:.3*Stats.rarities[this.rarity].petalDamage,health:Stats.enemies.Pentagon[a[t]].health,mass:Stats.enemies.Pentagon[a[t]].mass*e}},color:statColors.cooldown}),"Hexagon"==this.type&&this.bottomstats.push({key:"summon",value:{rarity:a[t],type:"Hexagon",substats:{damage:.3*Stats.rarities[this.rarity].petalDamage,health:Stats.enemies.Hexagon[a[t]].health,mass:Stats.enemies.Hexagon[a[t]].mass*e}},color:statColors.cooldown}),"Bubble"==this.type&&this.rarity>=13){let s=Stats.enemies.Bubble[a[t]].mass/100*e*8;13==this.rarity&&(s*=2),this.rarity>=15&&(s*=2),this.bottomstats.push({key:"summon",value:{rarity:a[t],type:"Bubble",substats:{damage:.1*Stats.rarities[this.rarity].petalDamage,health:.01*Stats.enemies.Bubble[a[t]].health,mass:s,maxEnemyBoost:1.5*s}},color:statColors.cooldown})}}else"damageHeal"==t?a[t]>0?this.bottomstats.push({key:"lifesteal",value:a[t],color:statColors.heal}):a[t]<0&&this.bottomstats.push({key:"selfDamage",value:-a[t],color:statColors.damage}):"petalNum"==t?this.bottomstats.push({key:"mimickedPetals",value:a[t],color:statColors.extraRange}):"shield"==t&&this.bottomstats.push({key:t,value:formatAmountHighPrecision(a[t]),color:"#ffffff"});if(isTs||(["Rose","Dust","Jolt","Blood Jolt","Shell","Dahlia","Amulet of Grace","Shard of Grace"].includes(this.type)&&this.topstats.push({key:"secondaryReload",value:.32,color:statColors.damage}),["Missile","Blade","Carrot","Fire Missile","Homing Missile","Spore","Dandelion","Peas","Blueberries","Pomegranate","Grapes","Pollen","Honey","Neutron Star","Web","Lilypad","Neurotoxin","Bloodshot Eye"].includes(this.type)&&("Missile"!=this.type&&"Fire Missile"!=this.type||16!=this.rarity?this.topstats.push({key:"secondaryReload",value:.5,color:statColors.damage}):this.topstats.push({key:"secondaryReload",value:.05,color:statColors.damage})),["Amulet of Divergence","Shard of Divergence","Amulet of Time"].includes(this.type)&&this.topstats.push({key:"secondaryReload",value:1,color:statColors.damage}),["Bud","Bloom","Thomas"].includes(this.type)&&this.topstats.push({key:"secondaryReload",value:.2,color:statColors.damage}),["Ikea"].includes(this.type)&&this.topstats.push({key:"secondaryReload",value:2,color:statColors.damage})),"Trinket of the Wild"==this.type){let t=.8;this.rarity>=14&&(t*=1.375),this.rarity>=16&&(t*=1.5);let e=6.7*Stats.rarities[this.rarity].petalDamage,s=5500*Stats.rarities[this.rarity].petalHealth;this.bottomstats.push({key:"summon",value:{rarity:a.maximumRarity,type:"Mossy Ruby",substats:{damage:e,health:s,mass:Stats.enemies.Ruby[a.maximumRarity].mass*t}},color:statColors.cooldown})}if("Trinket of the Hivemind"==this.type){let t=.8;this.rarity>=14&&(t*=1.375),this.rarity>=16&&(t*=1.5);let e=60*Stats.rarities[this.rarity].petalDamage;this.rarity>=10&&(e*=.8),this.rarity>=13&&(e*=5/6),this.rarity>=15&&(e*=5/6);let s=8e3*Stats.rarities[this.rarity].petalHealth;this.bottomstats.push({key:"summon",value:{rarity:a.maximumRarity,type:"Soldier Termite",substats:{damage:e,health:s,mass:Stats.enemies["Soldier Termite"][a.maximumRarity].mass*t}},color:statColors.cooldown})}}else{if(a=cachedStats.enemies[this.type][this.rarity],"Hexagon"==this.type&&(this.name="ӇЄҲƛƓƠƝ"),"string"==typeof this.description){let t=this.description;this.description=[],this.description.push({text:t,color:"#ffffff"})}this.topstats=[],this.bottomstats=[];for(let t in a)!isTs&&["tanksmithRadius"].includes(t)||(["xp"].includes(t)?this.topstats.push({key:t,value:a[t],color:statColors[t]}):statColors[t]?(this.bottomstats.push({key:t,value:a[t],color:statColors[t]}),"damage"==t&&"Firefly"==this.type&&this.bottomstats.push({key:"lightning",value:.125*a[t],color:statColors.lightning}),"damage"==t&&("Jellyfish"==this.type&&this.bottomstats.push({key:"lightning",value:1.5*a[t],color:statColors.lightning}),"Neuroflare"==this.type&&this.bottomstats.push({key:"lightning",value:.8*a[t],color:statColors.lightning}),"Electric Eel"!=this.type&&"Dark Electric Eel"!=this.type&&"Shiny Electric Eel"!=this.type||this.bottomstats.push({key:"lightning",value:a[t],color:statColors.lightning})),"health"==t&&("Electric Eel"!=this.type&&"Dark Electric Eel"!=this.type&&"Shiny Electric Eel"!=this.type||this.bottomstats.push({key:"lifesteal",value:.00125*a[t],color:statColors.heal})),"health"==t&&("Leech"!=this.type&&"BudLeech"!=this.type&&"Tick"!=this.type||this.bottomstats.push({key:"lifesteal",value:.0025*a[t],color:statColors.heal}))):("drops"==t&&this.bottomstats.push({key:t,value:a[t],color:"#ffffff"}),"healing"==t&&this.bottomstats.push({key:"regeneration",value:a[t]*a.health*30,color:statColors.heal})))}}generateArtifactData(){if(this.topstats=[],this.bottomstats=[],"undefined"!=typeof SKILL_TREES&&SKILL_TREES[this.type]){const t=SKILL_TREES[this.type];this.description=[{text:t.description,color:t.color||"#ffffff"}]}const t=window.specialGlobalInventory?.artifacts?.[this.type],e=t?.skillLevels||{},a=t=>{let a=0;for(const[s,i]of Object.entries(e))"number"==typeof i&&s.startsWith(t)&&(a+=i);return a};switch(this.type){case"Abyssal Artifact":const t=a("egg_hp"),e=a("egg_damage"),s=a("egg_mass");this.bottomstats.push({key:"eggHpMultiplier",value:1.4+.05*t,displayName:`Egg HP: x${(1.4+.05*t).toFixed(2)}`,color:statColors.eggHpMultiplier}),this.bottomstats.push({key:"eggDamageMultiplier",value:1.4+.05*e,displayName:`Egg Damage: x${(1.4+.05*e).toFixed(2)}`,color:statColors.eggDamageMultiplier}),this.bottomstats.push({key:"eggMassMultiplier",value:1.4+.05*s,displayName:`Egg Mass: x${(1.4+.05*s).toFixed(2)}`,color:statColors.eggMassMultiplier});break;case"Scorched Artifact":const i=a("heal_mult");this.bottomstats.push({key:"healMultiplier",value:1.2+.1*i,displayName:`Heal: x${(1.2+.1*i).toFixed(2)}`,color:statColors.healMultiplier}),this.bottomstats.push({key:"squadHealShare",value:.33,displayName:"Squad Heal: 33%",color:statColors.squadHealShare});break;case"Verdant Artifact":const o=a("dps"),l=a("ult_cd");this.bottomstats.push({key:"dpsMultiplier",value:1.5+.05*o,displayName:`DPS: x${(1.5+.05*o).toFixed(2)}`,color:statColors.dpsMultiplier}),l>0&&this.bottomstats.push({key:"cooldownReduction",value:.05*l,displayName:`Petal CD: -${(5*l).toFixed(0)}%`,color:statColors.dpsMultiplier});break;case"Cosmic Artifact":const r=a("hp_mult"),n=a("range"),h=a("knockback"),c=a("ult_cd");this.bottomstats.push({key:"hpMultiplier",value:1.2+.1*r,displayName:`HP: x${(1.2+.1*r).toFixed(2)}`,color:statColors.hpMultiplier}),this.bottomstats.push({key:"ultRange",value:500+20*n,displayName:"Ult Range: "+(500+20*n),color:statColors.hpMultiplier}),this.bottomstats.push({key:"ultBubbleLvl",value:r+c+n+h,displayName:`Bubble Lv: ${Math.min(r+c+n+h,34)}`,color:statColors.hpMultiplier}),this.bottomstats.push({key:"knockbackMult",value:1+.05*h,displayName:`Knockback: x${(1+.05*h).toFixed(2)}`,color:statColors.hpMultiplier});const f=Math.max(60+-1.5*c,10);this.bottomstats.push({key:"ultCooldown",value:f,displayName:`Ult CD: ${f}s`,color:statColors.hpMultiplier})}}stripRomanNumeral(t){return t.replace(/\s+[IVX]+$/,"")}drawArtifactTooltip(){const t=window.specialGlobalInventory,e=t?.artifacts?.[this.type],a=e?.skillLevels||{},s=SKILL_TREES?.[this.type];if(!s)return;const i=this.type,o=s.color||"#ffffff",l=s.description||"",r={};for(const t of s.nodes){if(t.isRoot||!t.statKey)continue;const e=t.id.replace(/_\d+$/,"");r[e]||(r[e]={statKey:t.statKey,baseValue:t.baseValue,valuePerLevel:t.valuePerLevel,totalLevels:0,displayName:t.name})}for(const[t,e]of Object.entries(a)){const a=t.replace(/_\d+$/,"");r[a]&&(r[a].totalLevels+=e)}let n=[];for(const[t,e]of Object.entries(r)){if(0===e.totalLevels&&0===e.baseValue)continue;let t=e.baseValue+e.totalLevels*e.valuePerLevel;"cooldownReduction"===e.statKey&&(t*=100);const a={key:this.stripRomanNumeral(e.displayName),value:t,format:this.getValueFormat(e.statKey)};n.push(a)}s.passiveEffects?.squadHealShare&&n.push({key:"Squad Heal",value:100*s.passiveEffects.squadHealShare,format:"percent"}),ctx.font="900 27px Ubuntu";const h=ctx.measureText(i).width;ctx.font="900 16.875px Ubuntu";const c=this.wrapText(l,280,16.875),f=Math.max(...c.map(t=>ctx.measureText(t).width));let m=0;for(const t of n){const e=this.formatStatValue(t);m=Math.max(m,ctx.measureText(e).width)}const p=Math.max(h+20,Math.max(f+20,m+20)),u=75+22.5*c.length+22.5*n.length+10,d=Math.min(canvas.w-5-p/2,Math.max(5,-p/2+this.x));let x;"menu"===window.state?x=Math.min(canvas.h-5-u,Math.max(5,this.y)):(x=Math.max(5,this.y),x+u>canvas.h-5&&(x=this.y+u+32.5+11.5+32.5+11.5,x=Math.min(canvas.h-5-u,Math.max(5,x)))),ctx.save(),ctx.shadowColor="#FFD700",ctx.shadowBlur=15,ctx.strokeStyle="#FFD700",ctx.lineWidth=2,ctx.fillStyle="rgba(255, 215, 0, 0.3)",ctx.beginPath(),ctx.roundRect(d,x,p,u,5),ctx.fill(),ctx.stroke(),ctx.restore(),ctx.font="900 27px Ubuntu",ctx.lineWidth=3.9,ctx.strokeStyle="#000000",ctx.fillStyle=o,ctx.textAlign="left",ctx.textBaseline="top",ctx.strokeText(i,d+10,x+10),ctx.fillText(i,d+10,x+10),ctx.font=`900 ${.7*22.5}px Ubuntu`,ctx.lineWidth=2.275,ctx.strokeStyle="#000000",ctx.fillStyle="#ffffff";let y=x+50;for(const t of c)ctx.strokeText(t,d+10,y),ctx.fillText(t,d+10,y),y+=22.5;let g=y+5;const v=["#FF6B6B","#4ECDC4","#FFE66D","#95E1D3","#F38181"];for(let t=0;t<n.length;t++){const e=n[t],a=v[t%v.length];let s;switch(e.format){case"multiplier":s="x"+e.value.toFixed(2);break;case"percent":s=e.value.toFixed(0)+"%";break;case"negative_percent":s="-"+e.value.toFixed(0)+"%";break;case"time":s=e.value.toFixed(1)+"s";break;default:s=e.value.toFixed(2)}const i=e.key+":";ctx.fillStyle=a,ctx.strokeStyle="#000000",ctx.strokeText(i,d+10,g),ctx.fillText(i,d+10,g);const o=ctx.measureText(i).width;ctx.fillStyle="#ffffff",ctx.strokeText(" "+s,d+10+o,g),ctx.fillText(" "+s,d+10+o,g),g+=22.5}}getValueFormat(t){return t?.includes("Multiplier")||"healMultiplier"===t||"dpsMultiplier"===t||"hpMultiplier"===t?"multiplier":"cooldownReduction"===t?"negative_percent":"cooldown"===t?"time":"number"}formatStatValue(t){let e;switch(t.format){case"multiplier":e="x"+t.value.toFixed(2);break;case"percent":e=t.value.toFixed(0)+"%";break;case"negative_percent":e="-"+t.value.toFixed(0)+"%";break;case"time":e=t.value.toFixed(1)+"s";break;default:e=t.value.toFixed(2)}return`${t.key}: ${e}`}wrapText(t,e,a){ctx.font=`900 ${a}px Ubuntu`;const s=t.split(" "),i=[];let o="";for(const t of s){const a=o+(o?" ":"")+t;ctx.measureText(a).width>e&&o?(i.push(o),o=t):o=a}return o&&i.push(o),i.length>0?i:[t]}draw(){if(["Abyssal Artifact","Scorched Artifact","Verdant Artifact","Cosmic Artifact"].includes(this.type))this.drawArtifactTooltip();else{if(this.image)ctx.drawImage(this.image,Math.min(canvas.w-5-this.w/2,Math.max(5,-this.w/2+this.x)),Math.min(canvas.h-5-this.h,Math.max(5,this.y)));else{let t=this.generateDesc(300,500);this.w=t.width,this.h=117.5+t.height;for(let t of this.bottomstats){if((0!==t.value||t.value[0]&&0!==t.value[0])&&!("enemies"==this.mode&&"detectionDistance"==t.key&&isNaN(t.value))&&(this.h+=17.5),"summon"==t.key&&(this.h+=17.5*("Jellyfish Egg"==this.type||"Neuroflare Egg"==this.type?5:"Bubble"==this.type&&this.rarity>=13?4:3)),"drops"==t.key){let e=0,a=0;for(let s in t.value){if(!Array.isArray(t.value[s])){a++;continue}let i=0;for(let e of t.value[s])e>0&&i++;e=Math.max(e,i),0==i&&a++}this.w=Math.max(25+67.5*e,this.w),this.h+=85*(Object.keys(t.value).length-a)+17.5}if(["slowdown","killBossUnder","attractionRadius"].includes(t.key)&&t.value[0]){let e=t.value[0],a=0;for(let s of t.value)s<1||null==s||s!=e&&(a++,e=s);this.h+=17.5*a}}this.image="petals"==this.mode?this.genPcBox():this.genEcBox(),this.isTs=isTs}this.isTs!==isTs&&(delete this.image,this.generateData(this.mode,this.type,this.stats))}}genPcBox(){const t=new OffscreenCanvas(this.w,this.h),e=t.getContext("2d"),a=ctx;ctx=e,ctx.lineCap="round",ctx.lineJoin="round",ctx.fillStyle="#000000",ctx.globalAlpha*=.5,ctx.beginPath(),ctx.roundRect(0,0,this.w,this.h,5),ctx.fill(),ctx.closePath(),ctx.globalAlpha/=.5,ctx.strokeStyle="#000000",ctx.fillStyle="#ffffff",ctx.lineWidth=2,ctx.font="900 20.25px Ubuntu",ctx.textAlign="right",ctx.textBaseline="top",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=.9*3.25,ctx.translate(this.w-35,10),ctx.save(),ctx.beginPath(),ctx.arc(12.5,12.5,10,0,2*Math.PI),ctx.strokeStyle="#4CAF50",ctx.lineWidth=2.5,ctx.stroke(),ctx.beginPath(),ctx.arc(12.5,12.5,6,-.5,1.5),ctx.strokeStyle="#4CAF50",ctx.lineWidth=2,ctx.stroke(),ctx.beginPath(),ctx.moveTo(17.5,8),ctx.lineTo(20,11),ctx.lineTo(15.5,12),ctx.strokeStyle="#4CAF50",ctx.stroke(),ctx.restore();let s="",i=1;for(let t of this.topstats)"reload"==t.key||"shootCd"==t.key||"lifespan"==t.key||"hatchTime"==t.key||"timeToPop"==t.key?s+=formatAmountHighPrecision(t.value)+"s":"spawnSystem"==t.key?s+=formatAmountHighPrecision(t.value)[1]+"s":s+=formatAmountHighPrecision(t.value),this.topstats.length>1&&i!==this.topstats.length&&(s+=" + "),i++;if(ctx.strokeText(s,-5,2.5),ctx.fillText(s,-5,2.5),ctx.translate(35-this.w,0),ctx.font="900 27px Ubuntu",ctx.lineWidth=3.9,ctx.textAlign="left",ctx.translate(10,0),ctx.strokeText(this.name,0,0),ctx.fillText(this.name,0,0),this.amount>1){let t=ctx.measureText(this.name).width+7.5;ctx.translate(t,4),ctx.font="900 16.875px Ubuntu",ctx.lineWidth=2.4375,ctx.strokeText("x"+this.amount.toLocaleString(),0,4),ctx.fillText("x"+this.amount.toLocaleString(),0,4),ctx.translate(-t,-4)}ctx.font="900 16.875px Ubuntu",ctx.lineWidth=2.4375;let o=!1;if("Shattered Relic of Wrath"!==this.type&&"Reinforced Relic of Wrath"!==this.type&&"Subset Relic of the Guardian"!==this.type&&"Division Relic of the Guardian"!==this.type&&"Guard Relic of the Guardian"!==this.type&&"Knight Relic of the Guardian"!==this.type&&"Aid Relic of Serenity"!==this.type&&"Subliminal Relic of Serenity"!==this.type&&"Barrier Relic of Serenity"!==this.type&&"Token"!==this.type||0!=this.rarity||(o=!0),ctx.fillStyle=1==o?"#000000":Colors.rarities[this.rarity].color,ctx.translate(0,30),"Hexagon"==this.type){let t=Colors.rarities[this.rarity].name,e="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),a="ƛƁƇƊЄƑƓӇƖʆƘԼMƝƠƤƢƦƧƬƲƔƜҲƳȤ".split("");t=t.toUpperCase();let s="";for(let i of t)s+=a[e.indexOf(i)]?a[e.indexOf(i)]:i;t=s,ctx.strokeText(t,0,0),ctx.fillText(t,0,0)}else ctx.strokeText(1==o?"???":Colors.rarities[this.rarity].name,0,0),ctx.fillText(1==o?"???":Colors.rarities[this.rarity].name,0,0);ctx.font=`900 ${.7*22.5}px Ubuntu`,ctx.lineWidth=2.275,ctx.translate(0,45);for(let t of this.finalDesc){let e=0;for(let a of t)ctx.fillStyle=a.color,ctx.strokeText(a.text,0,0),ctx.fillText(a.text,0,0),ctx.translate(a.written,0),e+=a.written;ctx.translate(-e,22.5)}ctx.translate(0,22.5);for(let t of this.bottomstats){if(0==t.value)continue;ctx.fillStyle=t.color;let e=t.displayName||this.formatName(t.key)+": ",a=ctx.measureText(e).width;if("Hexagon"==this.type){let e=this.formatName(t.key)+": ",s="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),i="ƛƁƇƊЄƑƓӇƖʆƘԼMƝƠƤƢƦƧƬƲƔƜҲƳȤ".split("");e=e.toUpperCase();let o="";for(let t of e)o+=i[s.indexOf(t)]?i[s.indexOf(t)]:t;e=o,ctx.strokeText(e,0,0),ctx.fillText(e,0,0),a=ctx.measureText(e).width}else ctx.strokeText(e,0,0),ctx.fillText(e,0,0);if(ctx.translate(a,0),t.displayName){ctx.translate(-a,17.5);continue}ctx.fillStyle="#ffffff";let s=formatAmountHighPrecision(t.value);if(["poison","flowerBodyPoison","summonBodyPoison"].includes(t.key))s="Shiny Iris"==this.type?`${formatAmountHighPrecision(t.value[0])} (${formatAmountHighPrecision(t.value[1])}/s, total ${Math.round(t.value[0]/t.value[1]*100)/100}s per enemy)`:`${formatAmountHighPrecision(t.value[0])} (${formatAmountHighPrecision(t.value[1])}/s, total ${Math.round(t.value[0]/t.value[1]*100)/100}s)`;else if(["cooldown","duration","timeLimit","passiveHealingStackDuration","period","shadowTime","unrevivable","timeToPop","petLifespan","slowdownTime","teleportCooldown"].includes(t.key))s+="s";else if(["overhealConversion","inflation","damagePercent","collectDupeChance","armorPercent","radiusChange","healthNerf","speedBuff"].includes(t.key))s+="%";else if("waveSpeedBoost"===t.key)s="+"+Math.round(100*(t.value-1))+"%";else if("speedReduction"===t.key)s=Math.round(100*t.value)+"%/wave";else if("ratedWave"===t.key)s="wave "+t.value;else if(["damageIncrease"].includes(t.key)){ctx.strokeText(`${t.value}% (${1.25*t.value}% on `,0,0),ctx.fillText(`${t.value}% (${1.25*t.value}% on `,0,0);let e=ctx.measureText(`${t.value}% (${1.25*t.value}% on `).width;ctx.translate(e,0),ctx.fillStyle="#ff0000",ctx.strokeText("Blood Petals",0,0),ctx.fillText("Blood Petals",0,0);let a=ctx.measureText("Blood Petals").width;ctx.translate(a,0),ctx.fillStyle="#ffffff",ctx.strokeText(")",0,0),ctx.fillText(")",0,0);const i=ctx.measureText(")").width+7.5,o=-6,l=7;ctx.save(),ctx.beginPath(),ctx.arc(i+l,o+l,l,0,2*Math.PI),ctx.strokeStyle="#ff4444",ctx.lineWidth=2,ctx.stroke(),ctx.beginPath(),ctx.moveTo(i+l-.7*l,o+l-.7*l),ctx.lineTo(i+l+.7*l,o+l+.7*l),ctx.stroke(),ctx.restore(),ctx.translate(-(e+a),0),s=""}else if(["flowerHeal"].includes(t.key)){ctx.strokeText(`${formatAmountHighPrecision(t.value)} /s`,0,0),ctx.fillText(`${formatAmountHighPrecision(t.value)} /s`,0,0);let e=ctx.measureText(`${formatAmountHighPrecision(t.value)} /s`).width;ctx.translate(e,0);const a=ctx.measureText(")").width+7.5,i=-6,o=7;ctx.save(),ctx.beginPath(),ctx.arc(a+o,i+o,o,0,2*Math.PI),ctx.strokeStyle="#ff4444",ctx.lineWidth=2,ctx.stroke(),ctx.beginPath(),ctx.moveTo(a+o-.7*o,i+o-.7*o),ctx.lineTo(a+o+.7*o,i+o+.7*o),ctx.stroke(),ctx.restore(),ctx.translate(-e,0),s=""}else if(["reviveHealth","healingBoost","healthBuffBoost","weatherChanceBoost"].includes(t.key))s=formatAmountHighPrecision(100*t.value)+"%";else if(["passiveDamagePerKill","passiveHealingBuff","petHeal"].includes(t.key))s+="/s","Starfish"!=this.type&&"Brisingida"!=this.type||(s+=" (under 70% hp)");else if(["lightning"].includes(t.key))"Shiny Lightning"==this.type&&(s="+"+s),s+="/bounce";else if(["summon"].includes(t.key)){if(t.value.rarity>-1){let e=Colors.rarities[t.value.rarity].name+" ";if(s=t.value.type,t.value.amount&&(s+=" x"+t.value.amount),"Hexagon"==this.type){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),a="ƛƁƇƊЄƑƓӇƖʆƘԼMƝƠƤƢƦƧƬƲƔƜҲƳȤ".split("");e=e.toUpperCase();let i="";for(let s of e)i+=a[t.indexOf(s)]?a[t.indexOf(s)]:s;e=i,s=s.toUpperCase(),i="";for(let e of s)i+=a[t.indexOf(e)]?a[t.indexOf(e)]:e;s=i}let i=ctx.measureText(e).width;ctx.fillStyle=Colors.rarities[t.value.rarity].color,ctx.strokeText(e,0,0),ctx.fillText(e,0,0),ctx.translate(i,0),ctx.fillStyle="#ffffff",ctx.strokeText(s,0,0),ctx.fillText(s,0,0),ctx.translate(-a-i,17.5)}else ctx.translate(-a,17.5);for(let e in t.value.substats){let a=t.value.substats[e],s=" - Summon "+this.formatName(e)+": ";if("Hexagon"==this.type){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),e="ƛƁƇƊЄƑƓӇƖʆƘԼMƝƠƤƢƦƧƬƲƔƜҲƳȤ".split("");s=s.toUpperCase();let a="";for(let i of s)a+=e[t.indexOf(i)]?e[t.indexOf(i)]:i;s=a}let i=ctx.measureText(s).width;ctx.fillStyle=statColors[e],ctx.strokeText(s,0,0),ctx.fillText(s,0,0),ctx.translate(i,0);let o=formatAmountHighPrecision(a);"Shiny Ruby"==this.type&&"damage"==e&&(o="+"+o+" (per summon)"),Array.isArray(o)&&(o=`${formatAmountHighPrecision(a[0])}~${formatAmountHighPrecision(a[1])}`),ctx.fillStyle="#ffffff",ctx.strokeText(o,0,0),ctx.fillText(o,0,0),ctx.translate(-i,17.5)}ctx.translate(0,-17.5),s="",a=0}else if(["slowdown","killBossUnder","attractionRadius"].includes(t.key)&&t.value[0]){ctx.translate(-a,17.5);let e=t.value[0],i=-1;for(let a of t.value){if(i++,a<1||null==a)continue;if(a==e)continue;e=a;let o=Colors.rarities[i];o||(o=Colors.rarities[0]);let l=ctx.measureText(`- ${this.formatName(o.name)} ${this.formatName(t.key)}: `).width;ctx.fillStyle=o.color,ctx.strokeText(`- ${this.formatName(o.name)} ${this.formatName(t.key)}: `,0,0),ctx.fillText(`- ${this.formatName(o.name)} ${this.formatName(t.key)}: `,0,0),ctx.translate(l,0),s=formatAmountHighPrecision(t.value[i]),"attractionRadius"!==t.key&&(s+="%"),ctx.fillStyle="#ffffff",ctx.strokeText(s,0,0),ctx.fillText(s,0,0),ctx.translate(-l,17.5)}ctx.translate(0,-17.5),s="",a=0}else"Plank"==this.type&&"damage"==t.key?(ctx.strokeText(`${formatAmountHighPrecision(t.value)} (${formatAmountHighPrecision(1e3*t.value)} against projectiles)`,0,0),ctx.fillText(`${formatAmountHighPrecision(t.value)} (${formatAmountHighPrecision(1e3*t.value)} against projectiles)`,0,0)):["rotateSpeedBuff"].includes(t.key)?s+=" radians/s":["maxSkip"].includes(t.key)?s+=" waves":["healMultiplier","eggHpMultiplier","eggMassMultiplier","eggDamageMultiplier","dpsMultiplier","hpMultiplier"].includes(t.key)?(s="x"+s,ctx.strokeText(s,0,0),ctx.fillText(s,0,0)):(ctx.strokeText(formatAmountHighPrecision(t.value),0,0),ctx.fillText(formatAmountHighPrecision(t.value),0,0));if(""!==s&&(ctx.strokeText(s,0,0),ctx.fillText(s,0,0)),t.unstackable&&""!==s){const t=ctx.measureText(s).width+7.5,e=-6,a=7;ctx.save(),ctx.beginPath(),ctx.arc(t+a,e+a,a,0,2*Math.PI),ctx.strokeStyle="#ff4444",ctx.lineWidth=2,ctx.stroke(),ctx.beginPath(),ctx.moveTo(t+a-.7*a,e+a-.7*a),ctx.lineTo(t+a+.7*a,e+a+.7*a),ctx.stroke(),ctx.restore()}ctx.translate(-a,17.5)}return ctx=a,t}genEcBox(){const t=new OffscreenCanvas(this.w,this.h),e=t.getContext("2d"),a=ctx;ctx=e,ctx.lineCap="round",ctx.lineJoin="round",ctx.fillStyle="#000000",ctx.globalAlpha*=.5,ctx.beginPath(),ctx.roundRect(0,0,this.w,this.h,5),ctx.fill(),ctx.closePath(),ctx.globalAlpha/=.5,ctx.strokeStyle="#000000",ctx.fillStyle="#ffffff",ctx.lineWidth=2,ctx.font="900 20.25px Ubuntu",ctx.textAlign="right",ctx.textBaseline="top",ctx.fillStyle="white",ctx.strokeStyle="black",ctx.lineWidth=.9*3.25,ctx.translate(this.w-35,10),ctx.save(),ctx.beginPath();for(let t=0;t<5;t++){const e=4*t*Math.PI/5-Math.PI/2,a=12.5+10*Math.cos(e),s=12.5+10*Math.sin(e);0===t?ctx.moveTo(a,s):ctx.lineTo(a,s);const i=4*t*Math.PI/5+2*Math.PI/5-Math.PI/2,o=12.5+4*Math.cos(i),l=12.5+4*Math.sin(i);ctx.lineTo(o,l)}ctx.closePath(),ctx.fillStyle="#FFD700",ctx.fill(),ctx.strokeStyle="#B8860B",ctx.lineWidth=1.5,ctx.stroke(),ctx.restore();let s="",i=1;for(let t of this.topstats)"temp"==t.key?s+=t.value[1]+"s":s+=formatAmountHighPrecision(t.value),this.topstats.length>1&&i!==this.topstats.length&&(s+=" + "),i++;if(ctx.strokeText(s,-5,2.5),ctx.fillText(s,-5,2.5),ctx.translate(35-this.w,0),ctx.font="900 27px Ubuntu",ctx.lineWidth=3.9,ctx.textAlign="left",ctx.translate(10,0),ctx.strokeText(this.name,0,0),ctx.fillText(this.name,0,0),ctx.font="900 16.875px Ubuntu",ctx.lineWidth=2.4375,ctx.fillStyle=Colors.rarities[this.rarity].color,ctx.translate(0,30),"Hexagon"==this.type){let t=Colors.rarities[this.rarity].name,e="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),a="ƛƁƇƊЄƑƓӇƖʆƘԼMƝƠƤƢƦƧƬƲƔƜҲƳȤ".split("");t=t.toUpperCase();let s="";for(let i of t)s+=a[e.indexOf(i)]?a[e.indexOf(i)]:i;t=s,ctx.strokeText(t,0,0),ctx.fillText(t,0,0)}else ctx.strokeText(Colors.rarities[this.rarity].name,0,0),ctx.fillText(Colors.rarities[this.rarity].name,0,0);ctx.font=`900 ${.7*22.5}px Ubuntu`,ctx.lineWidth=2.275,ctx.translate(0,45);for(let t of this.finalDesc){let e=0;for(let a of t)ctx.fillStyle=a.color,ctx.strokeText(a.text,0,0),ctx.fillText(a.text,0,0),ctx.translate(a.written,0),e+=a.written;ctx.translate(-e,22.5)}ctx.translate(0,22.5);for(let t of this.bottomstats)if("drops"!==t.key){if(0==t.value||"detectionDistance"==t.key&&isNaN(t.value))continue;if(ctx.fillStyle=t.color,t.displayName){ctx.strokeText(t.displayName,0,0),ctx.fillText(t.displayName,0,0);continue}let e=ctx.measureText(this.formatName(t.key)+": ").width;if("Hexagon"==this.type){let a=this.formatName(t.key)+": ",s="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),i="ƛƁƇƊЄƑƓӇƖʆƘԼMƝƠƤƢƦƧƬƲƔƜҲƳȤ".split("");a=a.toUpperCase();let o="";for(let t of a)o+=i[s.indexOf(t)]?i[s.indexOf(t)]:t;a=o,ctx.strokeText(a,0,0),ctx.fillText(a,0,0),e=ctx.measureText(a).width}else ctx.strokeText(this.formatName(t.key)+": ",0,0),ctx.fillText(this.formatName(t.key)+": ",0,0);ctx.translate(e,0),ctx.fillStyle="#ffffff";let a=formatAmountHighPrecision(t.value);["lightning"].includes(t.key)?a+="Electric Eel"==this.type||"Dark Electric Eel"==this.type||"Shiny Electric Eel"==this.type?"/s":"/bounce":["healingReduction"].includes(t.key)?a=100*t.value+"%/hit":["regeneration","lifesteal"].includes(t.key)?a+="/s":["poison","flowerBodyPoison","summonBodyPoison"].includes(t.key)?a=`${formatAmountHighPrecision(t.value[0])} (${formatAmountHighPrecision(t.value[1])}/s, total ${Math.round(t.value[0]/t.value[1]*100)/100}s)`:"waveSpeedBoost"===t.key?a="+"+Math.round(100*(t.value-1))+"%":"speedReduction"===t.key?a=Math.round(100*t.value)+"%/wave":"ratedWave"===t.key?a="wave "+t.value:["healMultiplier","eggHpMultiplier","eggMassMultiplier","eggDamageMultiplier","dpsMultiplier","hpMultiplier"].includes(t.key)?(a="x"+a,ctx.strokeText(a,0,0),ctx.fillText(a,0,0)):(ctx.strokeText(formatAmountHighPrecision(t.value),0,0),ctx.fillText(formatAmountHighPrecision(t.value),0,0)),""!==a&&(ctx.strokeText(a,0,0),ctx.fillText(a,0,0)),ctx.translate(-e,17.5)}else for(let e in t.value){let a=t.value[e],s=0,i=0;for(let t in a){let o=a[t];if(0==o)continue;i++;let l=new Petal({type:e}),r=new PetalContainer([l],{x:27.5,y:42.5,w:50,h:50,toOscillate:!1},0,1,0);if(r.render.w=50,r.spawnAnimation=1,r.rarity=t,Stats.specialRarityDrops[this.rarity])for(let t of Stats.specialRarityDrops[this.rarity])r.rarity!=t.originalRarity||r.modified||(t.replaceRarity&&(r.rarity=t.replaceRarity),r.amount=t.amount,r.modified=!0);ctx.font=`900 ${.7*22.5}px Ubuntu`,ctx.lineWidth=2.275,ctx.fillStyle="white",ctx.strokeStyle="black",ctx.textAlign="center",ctx.textBaseline="middle",o<.01||(o=formatAmountHighPrecision(o)),ctx.strokeText(o+"%",27.5,85),ctx.fillText(o+"%",27.5,85),r.draw(),ctx.translate(67.5,0),s+=67.5}i>0&&ctx.translate(-s,85)}return ctx=a,t}generateDesc(t,e){ctx.font=`900 ${.7*22.5}px Ubuntu`,"petal"==this.mode&&(this.amount>1&&(e+=ctx.measureText(this.amount.toLocaleString()).width+7.5),t+=ctx.measureText(this.amount.toLocaleString()).width+7.5);let a=[],s=[],i={current:0,max:0,writing:0},o=0,l={text:"",color:"#ffffff"},r=0;for(let t of this.description){let e=t.text.split(" ");for(let s of e)a.push({text:s,color:t.color})}for(let t of a){let n=ctx.measureText(t.text+" ").width;i.current+n>e-15&&(s[o].push({text:l.text,color:l.color,written:i.writing}),o++,i.current=0,i.writing=0,l={text:"",color:t.color}),s[o]||(s[o]=[]),l.color!==t.color&&(s[o].push({text:l.text,color:l.color,written:i.writing}),i.writing=0,l={text:"",color:t.color}),r!==a.length-1?l.text+=t.text+" ":(l.text+=t.text,s[o].push({text:l.text,color:l.color,written:i.writing})),i.current+=n,i.writing+=n,i.max=Math.max(i.max,i.current),r++}return this.finalDesc=s,{width:Math.max(t,i.max)+15,height:22.5*s.length}}formatName(t){t.length>1&&(t=t[0].toUpperCase()+t.slice(1));for(let e=0;e<t.length;e++)t[e].toUpperCase()===t[e]&&(t=0==e?t.slice(0,e)+t[e].toUpperCase()+t.slice(e+1):t.slice(0,e)+" "+t[e].toUpperCase()+t.slice(e+1),e+=2);return t}}const statColors={damage:"#ff4444",health:"#44ff44",reload:"#44ddff",cooldown:"#67dbad",tanksmithRechargeTime:"#44ddff",shootCooldown:"#44ddff",speed:"#44ddff",tanksmithRadius:"#e044ff",tanksmithHealth:"#44ff44",poison:"#e644ff",summonBodyPoison:"#ec73ff",flowerBodyPoison:"#b33fc5",attractionRadius:"#baa052",salt:"#ff4444",bodyDamage:"#de3380",weatherChanceBoost:"#f5e042",maxDamage:"#ff4444",slowdown:"#777777",slowdownTime:"#b172cf",armor:"#838383",mass:"#696969",duration:"#ff44ee",heal:"#ff94c9",petHeal:"#c96d9b",flowerHeal:"#fc65b0",xp:"#f9ff44",detectionDistance:"#ffb144",extraRange:"#1585b5",wingExtraRange:"#1585b5",enemyKnockback:"#de823f",healAmount:"#44ff44",healDelay:"#44ff44",range:"#e00030",period:"#e3c59d",damagePercent:"#e3c59d",bounces:"#a7faef",healthNerf:"#eb7faf",overhealConversion:"#dae09f",hatchTime:"#9fd49f",extraDamage:"#ffbb00",criticalDamage:"#dd0000",flowerArmor:"#a3a3a3",maxEnemyBoost:"#33dd33",petLifespan:"#999999",lifespan:"#499999",reviveHealth:"#944994",maximumWave:"#009930",timeToPop:"#ffeeaa",shadowTime:"#333333",unrevivable:"#555555",damageConversion:"#aaaaaa",maximumMobs:"#9055cf",healingReduction:"#dddddd",useLimit:"#4d7896",wavesSentBack:"#445396",effect:"#b0b0b0",passiveDamagePerKill:"#ff3344",radiusChange:"#4986e3",passiveHealingStack:"#35de3e",passiveHealingStackDuration:"#659c68",killsRequired:"#ff1234",timeLimit:"#3582ab",failDamage:"#bf245b",blastRadius:"#56269e",armorPercent:"#7d9c7b",finalHitDamage:"#ff5900",hitBlastRadius:"#e4aa40ff",hitBlastDamage:"#cf601fff",collectDupeChance:"#af56cb",teleportCooldown:"#70bcd4",inflation:"#d4d4d4",shootCooldownBuff:"#ff9944",projectileSpeedBuff:"#ff9944",speedBuff:"#fafafa",knockbackMass:"#d4d4d4",bodyKnockback:"#d4d4d4",mana:"#ffffff",waveSpawningSpeed:"#a4ffa4",healingBoost:"#f8464d",healthBuff:"#35de3e",healthBuffBoost:"#4eb648ff",waveHealthBoost:"#35de3e",killBossUnder:"#dd4433",passiveHealingBuff:"#ff94c9",lightning:"#29f2e5",teleportCooldown:"#70bcd4",damageIncrease:"#8b3ae0",rotateSpeedBuff:"#9cee56",maxWave:"#df3a83",maxSkip:"#d6709d",waveSpeedBoost:"#c5628dff",ratedWave:"#62c5a8ff",speedReduction:"#c56262ff",healMultiplier:"#99ff99",squadHealShare:"#ffcc66",eggHpMultiplier:"#ff9999",eggMassMultiplier:"#99ccff",eggDamageMultiplier:"#ff6666",dpsMultiplier:"#ff6666",hpMultiplier:"#ff9999"};for(let t in Colors.rarities)statColors[Colors.rarities[t].name]=Colors.rarities[t].color;const enemyRarityScalars=[{name:"Basic",health:1,damage:1,radius:1,mass:1,petalDamage:1,petalHealth:1,petalHeal:1,petalMass:1,detectionDistance:1,xp:1},{name:"Uncommon",health:2,damage:1.2,radius:1.1,mass:1.52,petalDamage:1.4,petalHealth:1.2,petalHeal:1.51,petalMass:1.52,detectionDistance:1.1,xp:3},{name:"Scarce",health:4,damage:1.5,radius:1.3,mass:2.5,petalDamage:2,petalHealth:1.5,petalHeal:2.2,petalMass:2.5,detectionDistance:1.2,xp:9},{name:"Exceptional",health:7.5,damage:1.9,radius:1.72,mass:5.6,petalDamage:2.9,petalHealth:1.9,petalHeal:3.2,petalMass:5.7,detectionDistance:1.3,xp:27},{name:"Mythical",health:50,damage:2.7,radius:3,mass:18,petalDamage:4.8,petalHealth:2.8,petalHeal:5,petalMass:18,detectionDistance:1.7,xp:81},{name:"Phantasmal",health:110,damage:4.2,radius:5,mass:43,petalDamage:9.5,petalHealth:4.2,petalHeal:10,petalMass:43,detectionDistance:2.1,xp:243},{name:"Ultimate",health:310,damage:8.5,radius:7,mass:100,petalDamage:23,petalHealth:8.5,petalHeal:21.5,petalMass:100,detectionDistance:2.5,xp:729},{name:"Paramount",health:1350,damage:17,radius:9.5,mass:216,petalDamage:90,petalHealth:17,petalHeal:40,petalMass:216,detectionDistance:2.5,xp:2187},{name:"Alpha",health:4800,damage:35,radius:13,mass:500,petalDamage:320,petalHealth:35,petalHeal:74,petalMass:500,detectionDistance:2.5,xp:6561},{name:"Doomed",health:18e3,damage:70,radius:18,mass:1200,petalDamage:1100,petalHealth:70,petalHeal:140,petalMass:1200,detectionDistance:2.5,xp:4e4},{name:"Sacred",health:65e3,damage:138,radius:24,mass:3200,petalDamage:3850,petalHealth:138,petalHeal:268,petalMass:3200,detectionDistance:2.5,xp:3e5},{name:"Imperial",health:25e4,damage:275,radius:33,mass:9500,petalDamage:13500,petalHealth:275,petalHeal:500,petalMass:9500,detectionDistance:2.5,xp:3e6},{name:"Absolute",health:98e4,damage:550,radius:45,mass:33e3,petalDamage:47500,petalHealth:550,petalHeal:950,petalMass:33e3,detectionDistance:2.5,xp:3e7},{name:"Stellar",health:5e6,damage:1150,radius:62,mass:194400,petalDamage:27e4,petalHealth:1650,petalHeal:2889,petalMass:194400,detectionDistance:2.5,xp:5e8},{name:"Empyrean",health:98e5,damage:1650,radius:71,mass:388800,petalDamage:25e5,petalHealth:9800,petalHeal:9600,petalMass:23e5,detectionDistance:2.5,xp:1e10},{name:"Seraphic",health:2e7,damage:2500,radius:81,mass:777600,petalDamage:27e6,petalHealth:6e4,petalHeal:58e3,petalMass:276e5,detectionDistance:2.5,xp:3e11},{name:"Ascended",health:6e7,damage:4950,radius:103,mass:23e5,petalDamage:20945e4,petalHealth:207300,petalHeal:21e4,petalMass:384e6,detectionDistance:3.25,xp:9e12},{name:"Ethereal",health:12e7,damage:7500,radius:118,mass:46e5,petalDamage:9e8,petalHealth:45e5,petalHeal:2e5,petalMass:4608e6,detectionDistance:3.25,xp:27e13},{name:"Cosmic",health:36e7,damage:15e3,radius:135,mass:138e5,petalDamage:7232178928,petalHealth:1689600,petalHeal:516560.652,petalMass:55296e6,detectionDistance:3.25,xp:81e14},{name:"Timeless",health:7e8,damage:2e4,radius:154,mass:276e5,petalDamage:17113926136,petalHealth:70400,petalHeal:86030,petalMass:48e5,detectionDistance:3.25,xp:243e15},{name:"Godlike",health:14e8,damage:3e4,radius:175,mass:552e5,petalDamage:535815e3,petalHealth:140800,petalHeal:16e4,petalMass:96e5,detectionDistance:3.25,xp:7e18},{name:"Abyssal",health:448e7,damage:6e4,radius:200,mass:16e7,petalDamage:187e7,petalHealth:281600,petalHeal:32e4,petalMass:192e5,detectionDistance:3.3,xp:2e20},{name:"Noble",health:85e8,damage:9e4,radius:228,mass:32e7,petalDamage:36e8,petalHealth:563200,petalHeal:64e4,petalMass:384e6,detectionDistance:3.35,xp:6e21},{name:"Entropic",health:172e8,damage:13e4,radius:258,mass:64e7,petalDamage:72e8,petalHealth:1126400,petalHeal:128e4,petalMass:768e5,detectionDistance:3.4,xp:18e22},{name:"Apocalyptic",health:45e9,damage:265e3,radius:295,mass:2e9,petalDamage:144e8,petalHealth:2252800,petalHeal:256e4,petalMass:1536e5,detectionDistance:3.45,xp:6e24},{name:"Hollow",health:11e10,damage:53e4,radius:335,mass:6e9,petalDamage:288e8,petalHealth:4505600,petalHeal:512e4,petalMass:46e7,detectionDistance:3.5,xp:18e25},{name:"Overshadowed",health:21e10,damage:1e6,radius:380,mass:12e9,petalDamage:288e8,petalHealth:4505600,petalHeal:512e4,petalMass:46e7,detectionDistance:3.5,xp:54e26},{name:"Luminous",health:45e10,damage:16e5,radius:431,mass:24e9,petalDamage:288e8,petalHealth:4505600,petalHeal:512e4,petalMass:46e7,detectionDistance:3.5,xp:162e27},{name:"Banished",health:112e10,damage:32e5,radius:489,mass:72e9,petalDamage:288e8,petalHealth:4505600,petalHeal:512e4,petalMass:46e7,detectionDistance:3.5,xp:4.86e30},{name:"Iridescent",health:3e12,damage:65e5,radius:555,mass:144e9,petalDamage:288e8,petalHealth:4505600,petalHeal:512e4,petalMass:46e7,detectionDistance:3.5,xp:1458e29},{name:"Spectral",health:6e12,damage:96e5,radius:630,mass:288e9,petalDamage:288e8,petalHealth:4505600,petalHeal:512e4,petalMass:46e7,detectionDistance:3.5,xp:4376e30},{name:"Mystical",health:142e11,damage:19e6,radius:715,mass:864e9,petalDamage:288e8,petalHealth:4505600,petalHeal:512e4,petalMass:46e7,detectionDistance:3.5,xp:13e34},{name:"Arcane",health:34e12,damage:385e5,radius:811,mass:1788e9,petalDamage:288e8,petalHealth:4505600,petalHeal:512e4,petalMass:46e7,detectionDistance:3.5,xp:39e35},{name:"Occult",health:68e12,damage:58e6,radius:921,mass:3576e9,petalDamage:288e8,petalHealth:4505600,petalHeal:512e4,petalMass:46e7,detectionDistance:3.5,xp:117e36},{name:"Origin",health:156e12,damage:118e6,radius:1046,mass:10728e9,petalDamage:1e15,petalHealth:1e12,petalHeal:1e12,petalMass:1e15,detectionDistance:3.5,xp:351e37}];