const playerSpeed=1,petalRotateSpeed=2.5/30,neutralPetalDistance=70,attackPetalDistance=133.7,defendPetalDistance=42,flowerSpeed=1/9,serverTickLength=1e3/30,flowerInterpolateKeys=["headX","headY","radius","hp","baseX","baseY","petalDistance","beforeStreakHp","shield","isPoisoned","healingReduction"],flowerInterpolateMagnitudes=[.14,.14,.44,.22,.14,.14,.2,.22,.22,.088,.088],flowerPackKeys=["id","hp","maxHp","shield","headX","headY","radius","petalRotation","petalRotateSpeed","angle","isPoisoned","petalDistance"];class Flower{constructor(t){this.id=t,this.x=0,this.y=0,this.baseX=0,this.baseY=0,this.healingReduction=1,this.headX=0,this.headY=0,this.radius=25,this.xv=0,this.yv=0,this.friction=.3,this.movementType="mouse",this.angle=0,this.magnitude=0,this.maxHp=100,this.hp=100,this.shield=0,this.isPoisoned=0,this.name="",this.beforeStreakHp=this.maxHp,this.ticksSinceLastDamaged=1001,this.input={up:!1,down:!1,right:!1,left:!1},this.eyeOffsetX=0,this.eyeOffsetY=0,this.petals=[],this.petalRotateSpeed=petalRotateSpeed,this.petalRotation=0,this.petalLag=0,this.petalDistance=70,this.attacking=!1,this.defending=!1,this.middleState=!1,this.render={};for(let t=0;t<flowerInterpolateKeys.length;t++)this.render[flowerInterpolateKeys[t]]=this[flowerInterpolateKeys[t]];this.render.angle=this.angle,this.render.fastPetalDistance=this.petalDistance,this.render.x=this.render.baseX,this.render.y=this.render.baseY,this.projectiles=[],this.pets=[],this.deadProjectiles=[],this.deadPets=[],this.character="flower",this.score=0}init(t){if(t.id==selfId&&t.equippedArtifacts&&t.equippedArtifacts.length>0&&"undefined"!=typeof menuInventory){const e=t.equippedArtifacts[0];if(e&&"undefined"!=typeof specialGlobalInventory){const t=specialGlobalInventory.artifacts[e];t&&t.petalContainer&&(menuInventory.artifactContainer=t.petalContainer,menuInventory.artifactContainer.x=menuInventory.artifactSlot.x,menuInventory.artifactContainer.y=menuInventory.artifactSlot.y,menuInventory.artifactContainer.w=menuInventory.artifactSlot.size,menuInventory.artifactContainer.h=menuInventory.artifactSlot.size,"undefined"!=typeof inventory&&(inventory.artifactContainer=t.petalContainer,inventory.artifactContainer.x=inventory.artifactSlot.x,inventory.artifactContainer.y=inventory.artifactSlot.y,inventory.artifactContainer.w=inventory.artifactSlot.size,inventory.artifactContainer.h=inventory.artifactSlot.size))}}t.id,selfId;for(let e in t)if("petals"!==e)if("projectiles"===e)for(let e=0;e<t.projectiles.length;e++)this.projectiles[e]=new Petal(t.projectiles[e]),this.projectiles[e].isProjectile=!0;else if("pets"===e)for(let e=0;e<t.pets.length;e++)this.pets[e]=new Enemy(t.pets[e]);else this[e]=t[e];else for(let e in t.petals)this.petals[e]=new Petal(t.petals[e])}update(t,e){t[e+1]<this.hp&&this.updateRenderDamage(t.hp);for(let i=e;i<flowerPackKeys.length+e;i++)i===e+9&&this.id===window.selfId||(this[flowerPackKeys[i-e]]=t[i]);this.x=this.headX,this.y=this.headY,this.baseX=interpolate(this.baseX,this.headX,.4),this.baseY=interpolate(this.baseY,this.headY,.4);for(let i=0;i<this.petals.length;i++){const a=t[e+flowerPackKeys.length+i];let s=Math.floor(100*a)/100,l=Math.round(1e3*(a-s));if(a<=0)this.petals[i].update({takeDamage:!0,hp:-s},this);else if(1!==l){if(a>=.002&&a<.003){const t=(a-.002)/1e-4;if(!this.petals[i].maxHp){const t=Stats.petals?.[this.petals[i].type]?.[this.petals[i].rarity];this.petals[i].maxHp=t?.health||100}if(this.petals[i].hp=this.petals[i].maxHp*Math.max(0,Math.min(1,t)),this.petals[i].render.hp=this.petals[i].hp,!this.petals[i].reloadBase){const t=Stats.petals?.[this.petals[i].type]?.[this.petals[i].rarity];this.petals[i].reloadBase=t?.reload||3}this.petals[i].maxReload||(this.petals[i].maxReload=1e3*this.petals[i].reloadBase),this.petals[i].reload=this.petals[i].maxReload,this.petals[i].render.reload=this.petals[i].reload,!1!==this.petals[i].dead&&this.petals[i].update({dead:!1},this);continue}if(3!==l){if(4===l){const t=(a-.004)/1e-4;if(!this.petals[i].maxReload){const t=Stats.petals?.[this.petals[i].type]?.[this.petals[i].rarity];this.petals[i].reloadBase=t?.reload||3,this.petals[i].maxReload=1e3*this.petals[i].reloadBase}this.petals[i].reload=this.petals[i].maxReload*Math.max(0,Math.min(1,t)),this.petals[i].render.reload=this.petals[i].reload,!0!==this.petals[i].dead&&this.petals[i].update({dead:!0},this);continue}if(5!==l);else if(!0!==this.petals[i].dying){const t=this.petals[i].render?.x??this.petals[i].x,e=this.petals[i].render?.y??this.petals[i].y;this.petals[i].update({dead:!0,dying:!0,reload:s,deadPosition:{x:t,y:e}},this)}else this.petals[i].update({reload:s},this)}else this.petals[i].update({distance:s},this)}else!1!==this.petals[i].dead&&this.petals[i].update({dead:!1},this)}if(0!==this.projectiles.length){const i=e+flowerPackKeys.length+this.petals.length;for(let e=0;e<this.projectiles.length;e++){if(!this.projectiles[e])continue;const a=[t[i+2*e],t[i+2*e+1]];-6.5===a[0]?this.projectiles[e].update({dead:!0},this):this.projectiles[e].update({x:a[0],y:a[1]},this)}}if(0!==this.pets.length){const i=e+flowerPackKeys.length+this.petals.length+2*this.projectiles.length;for(let e=0;e<this.pets.length;e++){const a=i+e*enemyPackKeys.length;this.pets[e].update(t,a)}}}updateRenderDamage(){this.ticksSinceLastDamaged=0}updatePetsAndProjectiles(){for(let t=0;t<this.deadProjectiles.length;t++)this.deadProjectiles[t].deadAnimationTimer>166&&(this.deadProjectiles[t].toRemove=!0);this.deadProjectiles=this.deadProjectiles.filter(t=>!0!==t.toRemove);for(let t=0;t<this.deadPets.length;t++)this.deadPets[t].deadAnimationTimer>166&&(this.deadPets[t].toRemove=!0);this.deadPets=this.deadPets.filter(t=>!0!==t.toRemove)}calculatePetalLag(){return 1.08695652174*this.petalRotateSpeed}updateInterpolate(){if(window.Perf&&window.Perf.mark("Flower.updateInterpolate"),window.isEditor&&void 0!==this.extraRange&&this.petalDistance>70){var t=this.petalDistance;this.petalDistance/=this.extraRange}for(let t=0;t<flowerInterpolateKeys.length;t++)this.render[flowerInterpolateKeys[t]]=interpolate(this.render[flowerInterpolateKeys[t]],this[flowerInterpolateKeys[t]],flowerInterpolateMagnitudes[t]*dt/16.66);this.render.angle=interpolateDirection(this.render.angle,this.angle,.2*dt/16.66),this.render.fastPetalDistance=interpolate(this.render.fastPetalDistance,this.petalDistance,.4*dt/16.66);for(let t=0;t<this.petals.length;t++)this.petals[t].updateInterpolate(this);for(let t=0;t<this.projectiles.length;t++)this.projectiles[t]&&(void 0!==this.projectiles[t].updateInterpolate?this.projectiles[t].updateInterpolate(this):this.projectiles[t]=new Petal(this.projectiles[t]));this.render.x=this.render.baseX,this.render.y=this.render.baseY,window.isEditor&&void 0!==this.extraRange&&this.petalDistance>70&&(this.petalDistance=t),window.Perf&&window.Perf.end("Flower.updateInterpolate")}drawProjectiles(){if(0!==this.projectiles.length&&(!0===window.renderSquadPetals||this.id===window.selfId))for(let t=0;t<this.projectiles.length;t++)this.projectiles[t]&&(!0===toRender({x:this.projectiles[t].x,y:this.projectiles[t].y,radius:this.projectiles[t].radius},window.camera)&&this.projectiles[t].draw(),this.projectiles[t].updateTimer())}drawPets(){for(let t=0;t<this.pets.length;t++)void 0!==this.pets[t]?.render?.x&&!0===toRender({x:this.pets[t].x,y:this.pets[t].y,radius:4*this.pets[t].radius},window.camera)&&this.pets[t].draw();for(let t=0;t<this.deadPets.length;t++)void 0!==this.deadPets[t]?.render?.x&&!0===toRender({x:this.deadPets[t].x,y:this.deadPets[t].y,radius:4*this.deadPets[t].radius},window.camera)&&this.deadPets[t].draw()}draw(){window.Perf&&window.Perf.mark("Flower.draw"),this.id!==window.selfId&&this.updateInterpolate(),this.updatePetsAndProjectiles();for(let t=0;t<this.deadProjectiles.length;t++)!this.deadProjectiles[t]||!0!==window.renderSquadPetals&&this.id!==window.selfId||(!0===toRender({x:this.deadProjectiles[t].x,y:this.deadProjectiles[t].y,radius:this.deadProjectiles[t].radius},window.camera)&&this.deadProjectiles[t].draw(),this.deadProjectiles[t].updateTimer());if(this.ticksSinceLastDamaged+=dt,this.ticksSinceLastDamaged>666&&(this.beforeStreakHp=this.hp),renderHpBar({x:this.render.headX,y:this.render.headY-this.render.radius/3,radius:this.render.radius,hp:this.render.hp,maxHp:this.maxHp,shield:this.render.shield,beforeStreakHp:this.render.beforeStreakHp,flowerName:this.name,flowerUsername:this.username},this),void 0!==this.petalAlpha&&(ctx.globalAlpha=this.petalAlpha),this.id==window.selfId&&(petalReloadData={},petalHpData={}),!0===window.renderSquadPetals||this.id===window.selfId)if("Tanksmith"===this.character&&"menu"===state){let t=1;for(let e=0;e<this.petals.length;e++){let i=this.petals[e];if(!0===toRender({x:i.x,y:i.y,radius:i.radius},window.camera)){if(0!==i.subStackedId){t++;continue}ctx.translate(i.render.x,i.render.y);let e="Normal";["Rose","Dahlia","Leaf","Starfish","Shell"].includes(i.type)?e="Heal":["Yucca"].includes(i.type)?e="TankHeal":"Bud"===i.type?e="Bud":"Bloom"===i.type?e="Bloom":"Magnet"===i.type?e="Magnet":"Egg"!==i.type&&"Jellyfish Egg"!==i.type&&"Neuroflare Egg"!==i.type||(e="Egg"),enemyRenderMap.Tanksmith({render:{radius:i.radius*Math.sqrt(t),angle:i.render.angle},barrelNum:t,tsRenderType:e,ticksSinceLastDamaged:1001,lastTicksSinceLastDamaged:1001}),ctx.translate(-i.render.x,-i.render.y),t=1}i.updateTimer()}}else{let t=!1,e=1;if(window.verdantUltimateEffects&&window.verdantUltimateEffects[this.id]){const i=window.verdantUltimateEffects[this.id],a=performance.now();a<i.endTime&&(t=!0,e=Math.min((a-i.startTime)/300,1))}for(let i=0;i<this.petals.length;i++){let a=this.petals[i];if(!0===toRender({x:a.x,y:a.y,radius:a.radius},window.camera)&&a.draw(t,e),this.id==window.selfId){let t=a.petalContainerId;petalReloadData[t]?petalReloadData[t].reload<a.render.reload/a.maxReload&&(a.dead||a.dying)&&(petalReloadData[t].reload=a.render.reload/a.maxReload):(a.dead||a.dying)&&(petalReloadData[t]={reload:a.render.reload/a.maxReload}),petalHpData[t]?a.dead||(petalHpData[t].hp=(petalHpData[t].count*petalHpData[t].hp+a.render.hp/a.maxHp)/(petalHpData[t].count+1),petalHpData[t].count++):a.dead||(petalHpData[t]={hp:a.render.hp/a.maxHp,count:1})}a.updateTimer()}}if(ctx.globalAlpha=1,!0===toRender({x:this.headX,y:this.headY,radius:this.radius},window.camera)&&this.drawFlower(this.render.headX,this.render.headY,this.radius,this.character),(!0===window.renderSquadPetals||this.id===window.selfId)&&this.lightnings&&this.lightnings.length>0){this.lightnings=this.lightnings.filter(t=>time<t.time+600);let t=null;for(let e of this.lightnings){e.type!==t&&(ctx.strokeStyle=["#97f0ea","#f0ee97","#00fca4","#a82d2d"][e.type],t=e.type),e.rarity>=13?ctx.lineWidth=9*(2-(time-e.time)/700):ctx.lineWidth=5*(2-(time-e.time)/700),ctx.globalAlpha=1-(time-e.time)/700,ctx.beginPath();for(let t=0;t<e.renderData.length;t++)ctx.lineTo(e.renderData[t].x,e.renderData[t].y);ctx.stroke(),e.rarity>=13&&(ctx.lineWidth=18*(2-(time-e.time)/700),ctx.stroke()),ctx.closePath()}ctx.globalAlpha=1}if((!0===window.renderSquadPetals||this.id===window.selfId)&&this.blasts&&this.blasts.length>0){this.blasts=this.blasts.filter(t=>time<t.time+600);for(let t of this.blasts)0==t.type?(ctx.fillStyle="#581e75",ctx.globalAlpha=.115385-(time-t.time)/5200):1==t.type&&(ctx.fillStyle="#e68612",ctx.globalAlpha=.0555555-(time-t.time)/10800),ctx.beginPath(),ctx.arc(t.x,t.y,t.radius+this.radius,0,2*Math.PI),ctx.fill(),ctx.closePath();ctx.globalAlpha=1}if(this.thunderstruck&&time<this.thunderstruck){const t=this.thunderstruck-time,e=Math.min(1,t/2e3);ctx.save(),ctx.translate(this.render.headX,this.render.headY),ctx.strokeStyle=`rgba(100, 200, 255, ${.8*e})`,ctx.lineWidth=2,ctx.shadowColor="#00ffff",ctx.shadowBlur=10;const i=5;for(let t=0;t<i;t++){const e=(time/200+t*(2*Math.PI/i))%(2*Math.PI),a=1.3*this.render.radius,s=1.8*this.render.radius,l=Math.PI/3;ctx.beginPath();for(let t=0;t<=10;t++){const i=t/10,r=a+(s-a)*Math.random(),n=e+(i-.5)*l+.3*(Math.random()-.5),o=Math.cos(n)*r,h=Math.sin(n)*r;0===t?ctx.moveTo(o,h):ctx.lineTo(o,h)}ctx.stroke()}if(Math.random()<.3){const t=Math.random()*Math.PI*2,i=this.render.radius*(.5+.5*Math.random());ctx.strokeStyle=`rgba(200, 220, 255, ${e})`,ctx.lineWidth=1,ctx.beginPath(),ctx.moveTo(Math.cos(t)*this.render.radius,Math.sin(t)*this.render.radius),ctx.lineTo(Math.cos(t)*(this.render.radius+i),Math.sin(t)*(this.render.radius+i)),ctx.stroke()}ctx.restore()}window.Perf&&window.Perf.end("Flower.draw")}drawFlower(t,e,i,a="flower"){if(!this.dead)if(this.dev){if("Tanksmith"===a?(ctx.fillStyle=blendColor("#790000","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#550000","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.lineWidth=4):(ctx.fillStyle=blendColor("#ffe763","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#cebb50","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.lineWidth=i/8),ctx.fillStyle=blendColor(ctx.fillStyle,"#ce76da",Math.max(0,this.render.isPoisoned)),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#ab63b3",Math.max(0,this.render.isPoisoned)),ctx.fillStyle=blendColor(ctx.fillStyle,"#ce76da",Math.max(0,this.render.isPoisoned)),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#ab63b3",Math.max(0,this.render.isPoisoned)),this.render.healingReduction<.999&&(ctx.fillStyle=blendColor(ctx.fillStyle,"#ffffff",Math.max(0,1-this.render.healingReduction)),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#ffffff",Math.max(0,1-this.render.healingReduction))),this.undead?(ctx.fillStyle="#222222",ctx.strokeStyle="#000000"):this.rage&&(ctx.fillStyle="#9900ff",ctx.strokeStyle="#6b00b3"),ctx.beginPath(),ctx.lineTo(t+1.03*i,e+-.02*i),ctx.quadraticCurveTo(t+.78*i,e+1.06*i,t+.27*i,e+1.14*i),ctx.quadraticCurveTo(t+-.8*i,e+.75*i,t+-.94*i,e+.36*i),ctx.quadraticCurveTo(t+-1.18*i,e+-.29*i,t+-.83*i,e+-.95*i),ctx.quadraticCurveTo(t+-.45*i,e+-1.3*i,t+-.06*i,e+-1.06*i),ctx.quadraticCurveTo(t+.85*i,e+-1.04*i,t+1.03*i,e+-.02*i),ctx.fill(),ctx.stroke(),ctx.closePath(),"Tanksmith"===a){ctx.translate(t,e),ctx.rotate(this.render.angle),ctx.lineWidth=5,ctx.fillStyle=blendColor("#bfbfbf","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#868686","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166));for(let t=0;t<8;t++)ctx.beginPath(),ctx.roundRect(0,.23*-i,1.3*i,.23*i*2,2),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.rotate(2*Math.PI/8);return ctx.beginPath(),ctx.arc(0,0,i/2,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.rotate(-this.render.angle),void ctx.translate(-t,-e)}let s;ctx.fillStyle="#212219",ctx.beginPath(),ctx.ellipse(t+i/2.5+.05*i,e+5*i/13.5,3*i/23.5*1.1,5.85*i/23.5*1.1,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.ellipse(t-i/2.5,e-5*i/23.5+-.15*i,3*i/23.5*1.1,5.85*i/23.5*1.1,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.strokeStyle=ctx.fillStyle,ctx.lineWidth=i/15,ctx.lineCap="round",s=this.attacking||this.defending?1:0,this.render.isPoisoned&&(s=this.render.isPoisoned),ctx.beginPath(),ctx.moveTo(t-.3*i+i/4,e+.025*i+9.5*i/23.5),ctx.quadraticCurveTo(t-.4*i,e-.1*i+1.07*i*(5.5+9.5*(1-s))/23.5*61.1/70,t-.275*i-i/4,e-.25*i+9.5*i/23.5),ctx.stroke(),ctx.save(),ctx.beginPath(),ctx.ellipse(t+i/2.5+.05*i,e+5*i/13.5,2.5*i/23.5*1.1,5*i/23.5*1.1,0,0,2*Math.PI),ctx.clip();const l={x:Math.cos(this.render.angle)*i*2/23,y:Math.sin(this.render.angle)*i*3.5/23};ctx.fillStyle="#eeeeee",ctx.beginPath(),ctx.ellipse(t+i/2.5+l.x+.05*i,e+5*i/13.5+l.y,2.92*i/23.5*1.1,2.92*i/23.5*1.1,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore(),ctx.save(),ctx.beginPath(),ctx.ellipse(t-i/2.5,e-5*i/23.5+-.15*i,2.5*+i/23.5*1.1,5*i/23.5*1.1,0,0,2*Math.PI),ctx.clip(),ctx.fillStyle="#eeeeee",ctx.beginPath(),ctx.ellipse(t-i/2.5-l.x,e-5*i/23.5-l.y+-.15*i,3*i/23.5*1.1,3*i/23.5*1.1,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore()}else{if("Tanksmith"===a?(ctx.fillStyle=blendColor("#790000","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#550000","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.lineWidth=4):(ctx.fillStyle=blendColor("#ffe763","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#cebb50","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.lineWidth=i/8),ctx.fillStyle=blendColor(ctx.fillStyle,"#ce76da",Math.max(0,this.render.isPoisoned)),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#ab63b3",Math.max(0,this.render.isPoisoned)),this.render.healingReduction<.999&&(ctx.fillStyle=blendColor(ctx.fillStyle,"#ffffff",Math.max(0,1-this.render.healingReduction)),ctx.strokeStyle=blendColor(ctx.strokeStyle,"#ffffff",Math.max(0,1-this.render.healingReduction))),this.undead?(ctx.fillStyle="#222222",ctx.strokeStyle="#000000"):this.rage&&(ctx.fillStyle="#9900ff",ctx.strokeStyle="#6b00b3"),ctx.beginPath(),ctx.arc(t,e,i,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),"Tanksmith"===a){ctx.translate(t,e),ctx.rotate(this.render.angle),ctx.lineWidth=5,ctx.fillStyle=blendColor("#bfbfbf","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.strokeStyle=blendColor("#868686","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166));for(let t=0;t<8;t++)ctx.beginPath(),ctx.roundRect(0,.23*-i,1.3*i,.23*i*2,2),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.rotate(2*Math.PI/8);return ctx.beginPath(),ctx.arc(0,0,i/2,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.rotate(-this.render.angle),void ctx.translate(-t,-e)}let s;ctx.fillStyle="#212219",ctx.beginPath(),ctx.ellipse(t-i/3.5,e-5*i/23.5,3*i/23.5,5.85*i/23.5,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.ellipse(t+i/3.5,e-5*i/23.5,3*i/23.5,5.85*i/23.5,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.strokeStyle=ctx.fillStyle,ctx.lineWidth=i/15,ctx.lineCap="round",s=this.attacking||this.defending?1:0,this.render.isPoisoned>.001&&(s=Math.max(this.render.isPoisoned,s)),ctx.beginPath(),ctx.moveTo(t+i/4,e+9.5*i/23.5),ctx.quadraticCurveTo(t,e+1.07*i*(5.5+9.5*(1-s))/23.5*61.1/70,t-i/4,e+9.5*i/23.5),ctx.stroke(),ctx.save(),ctx.beginPath(),ctx.ellipse(t+i/3.5,e-5*i/23.5,2.5*i/23.5,5*i/23.5,0,0,2*Math.PI),ctx.clip();const l={x:Math.cos(this.render.angle)*i*2/23,y:Math.sin(this.render.angle)*i*3.5/23};let r;ctx.fillStyle="#eeeeee",ctx.beginPath(),ctx.ellipse(t+i/3.5+l.x,e-5*i/23.5+l.y,2.92*i/23.5,2.92*i/23.5,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore(),ctx.save(),ctx.beginPath(),ctx.ellipse(t-i/3.5,e-5*i/23.5,2.5*i/23.5,5*i/23.5,0,0,2*Math.PI),ctx.clip(),ctx.fillStyle="#eeeeee",ctx.beginPath(),ctx.ellipse(t-i/3.5+l.x,e-5*i/23.5+l.y,3*i/23.5,3*i/23.5,0,0,2*Math.PI),ctx.fill(),ctx.closePath(),ctx.restore(),r=this.attacking||this.defending?(133.7-7-126)/35*i/25:-1.8*i/25,ctx.fillStyle=blendColor("#ffe763","#FF0000",Math.max(0,1-this.ticksSinceLastDamaged/166)),ctx.fillStyle=blendColor(ctx.fillStyle,"#ce76da",Math.max(0,this.render.isPoisoned)),this.undead?(ctx.fillStyle="#222222",ctx.strokeStyle="#000000"):this.rage&&(ctx.fillStyle="#9900ff",ctx.strokeStyle="#6b00b3"),ctx.beginPath(),ctx.moveTo(t-i/3.5*2,e-14*i/23.5+r),ctx.lineTo(t+i/3.5*2,e-14*i/23.5+r),ctx.lineTo(t,e-5*i/23.5+r),ctx.fill(),ctx.closePath()}}static drawDeadFlower(t,e,i){if(this.dev){ctx.fillStyle="#ffe763",ctx.strokeStyle="#cebb50",ctx.lineWidth=i/8,ctx.beginPath(),ctx.lineTo(t+1.03*i,e+-.02*i),ctx.quadraticCurveTo(t+.78*i,e+1.06*i,t+.27*i,e+1.14*i),ctx.quadraticCurveTo(t+-.8*i,e+.75*i,t+-.94*i,e+.36*i),ctx.quadraticCurveTo(t+-1.18*i,e+-.29*i,t+-.83*i,e+-.95*i),ctx.quadraticCurveTo(t+-.45*i,e+-1.3*i,t+-.06*i,e+-1.06*i),ctx.quadraticCurveTo(t+.85*i,e+-1.04*i,t+1.03*i,e+-.02*i),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.fillStyle="#212219",ctx.strokeStyle=ctx.fillStyle,ctx.lineWidth=i/15,ctx.lineCap="round";let a=1;ctx.beginPath(),ctx.moveTo(t-.3*i+i/4,e+.025*i+9.5*i/23.5),ctx.quadraticCurveTo(t-.4*i,e-.1*i+1.07*i*(5.5+9.5*(1-a))/23.5*61.1/70,t-.275*i-i/4,e-.25*i+9.5*i/23.5),ctx.stroke(),ctx.lineWidth=i/8,ctx.lineCap="round";let s={x:t+i/2.5+.05*i,y:e+5*i/13.5};ctx.beginPath(),ctx.moveTo(s.x+4*i/23.5,s.y+4*i/23.5),ctx.lineTo(s.x-4*i/23.5,s.y-4*i/23.5),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(s.x+4*i/23.5,s.y-4*i/23.5),ctx.lineTo(s.x-4*i/23.5,s.y+4*i/23.5),ctx.stroke(),ctx.closePath(),s={x:t-i/2.5,y:e-5*i/23.5+-.15*i},ctx.beginPath(),ctx.moveTo(s.x+4*i/23.5,s.y+4*i/23.5),ctx.lineTo(s.x-4*i/23.5,s.y-4*i/23.5),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(s.x+4*i/23.5,s.y-4*i/23.5),ctx.lineTo(s.x-4*i/23.5,s.y+4*i/23.5),ctx.stroke(),ctx.closePath()}else{ctx.fillStyle="#ffe763",ctx.strokeStyle="#cebb50",ctx.lineWidth=i/8,ctx.beginPath(),ctx.arc(t,e,i,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.fillStyle="#212219",ctx.strokeStyle=ctx.fillStyle,ctx.lineWidth=i/8,ctx.lineCap="round";let a={x:t-i/3.5,y:e-5*i/23.5};ctx.beginPath(),ctx.moveTo(a.x+4*i/23.5,a.y+4*i/23.5),ctx.lineTo(a.x-4*i/23.5,a.y-4*i/23.5),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(a.x+4*i/23.5,a.y-4*i/23.5),ctx.lineTo(a.x-4*i/23.5,a.y+4*i/23.5),ctx.stroke(),ctx.closePath(),a={x:t+i/3.5,y:e-5*i/23.5},ctx.beginPath(),ctx.moveTo(a.x+4*i/23.5,a.y+4*i/23.5),ctx.lineTo(a.x-4*i/23.5,a.y-4*i/23.5),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(a.x+4*i/23.5,a.y-4*i/23.5),ctx.lineTo(a.x-4*i/23.5,a.y+4*i/23.5),ctx.stroke(),ctx.closePath(),ctx.strokeStyle=ctx.fillStyle,ctx.lineWidth=i/15,ctx.lineCap="round";let s=1;ctx.beginPath(),ctx.moveTo(t+i/4,e+9.5*i/23.5),ctx.quadraticCurveTo(t,e+1.07*i*(5.5+9.5*(1-s))/23.5*61.1/70,t-i/4,e+9.5*i/23.5),ctx.stroke()}}pack(){return{movementType:this.movementType,input:this.input}}}function interpolate(t,e,i){return t+(e-t)*Math.max(0,Math.min(1,i))}function shortAngleDist(t,e){const i=2*Math.PI,a=(e-t)%i;return 2*a%i-a}function interpolateDirection(t,e,i){return t+shortAngleDist(t,e)*i}function toRender(t,e={x:0,y:0}){return"pass"===t.x||!0===e.disableCulling||!(t.x-t.radius>e.x+canvas.w/2/renderFov||t.x+t.radius<e.x-canvas.w/2/renderFov)&&!(t.y-t.radius>e.y+canvas.h/2/renderFov||t.y+t.radius<e.y-canvas.h/2/renderFov)}